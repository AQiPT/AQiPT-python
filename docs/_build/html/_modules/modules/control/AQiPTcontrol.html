


<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>modules.control.AQiPTcontrol &mdash; AQiPT: Atomic Quantum information Processing Toolbox  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css?v=7f9a90b1" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #34495e" >

          
          
          <a href="../../../index.html">
            
              <img src="../../../_static/logo_icon.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../prerequisites.html">Pre-requisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developers.html">Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../versions.html">Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../structure.html">Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notebooks.html">Notebooks</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #34495e" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">AQiPT: Atomic Quantum information Processing Toolbox</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">modules.control.AQiPTcontrol</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for modules.control.AQiPTcontrol</h1><div class="highlight"><pre>
<span></span><span class="c1">#Atomic Quantum information Processing Tool (AQIPT - /ɪˈkwɪpt/) - Control module</span>

<span class="c1"># Author(s): Manuel Morgado. Universite de Strasbourg. Laboratory of Exotic Quantum Matter - CESQ</span>
<span class="c1">#                            Universitaet Stuttgart. 5. Physikalisches Institut - QRydDemo</span>
<span class="c1"># Contributor(s): S.Whitlock. Universite de Strasbourg. Laboratory of Exotic Quantum Matter - CESQ</span>
<span class="c1"># Created: 2021-04-08</span>
<span class="c1"># Last update: 2024-12-14</span>


<span class="c1">#libs</span>
<span class="kn">import</span> <span class="nn">warnings</span><span class="c1">#, os</span>
<span class="kn">import</span> <span class="nn">datetime</span><span class="o">,</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">copy</span>

<span class="kn">import</span> <span class="nn">ctypes</span>

<span class="kn">from</span> <span class="nn">inspect</span> <span class="kn">import</span> <span class="n">isclass</span>
<span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">modules</span><span class="p">,</span> <span class="n">version_info</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">remove</span>

<span class="kn">from</span> <span class="nn">sched</span> <span class="kn">import</span> <span class="n">scheduler</span>
<span class="c1"># import inspect, queue</span>

<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>

<span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">mt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">np</span><span class="o">.</span><span class="n">seterr</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.animation</span> <span class="kn">import</span> <span class="n">FuncAnimation</span><span class="p">,</span> <span class="n">PillowWriter</span>

<span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">plty</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>

<span class="kn">import</span> <span class="nn">imageio</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">hexalattice.hexalattice</span> <span class="kn">import</span> <span class="o">*</span>

<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>
<span class="kn">import</span> <span class="nn">scipy.signal</span> <span class="k">as</span> <span class="nn">signal</span>
<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <span class="n">chirp</span><span class="p">,</span> <span class="n">resample</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">CubicSpline</span><span class="p">,</span> <span class="n">interp1d</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">multivariate_normal</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">minimize</span><span class="p">,</span> <span class="n">linear_sum_assignment</span>
<span class="kn">from</span> <span class="nn">scipy.spatial.distance</span> <span class="kn">import</span> <span class="n">cdist</span>

<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">combinations</span>

<span class="kn">from</span> <span class="nn">AQiPT</span> <span class="kn">import</span> <span class="n">AQiPTcore</span> <span class="k">as</span> <span class="n">aqipt</span>
<span class="kn">import</span> <span class="nn">AQiPT.modules.kernel.AQiPTkernel</span> <span class="k">as</span> <span class="nn">kernel</span>

<span class="kn">from</span> <span class="nn">AQiPT.modules.directory</span> <span class="kn">import</span> <span class="n">AQiPTdirectory</span> <span class="k">as</span> <span class="n">dirPath</span>

<span class="n">directory</span> <span class="o">=</span> <span class="n">aqipt</span><span class="o">.</span><span class="n">directory</span><span class="p">;</span>


<span class="c1">#for functions</span>
<span class="n">INTERPOLATION_METHODS</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="s1">&#39;nearest-up&#39;</span><span class="p">,</span> 
                          <span class="s1">&#39;zero&#39;</span><span class="p">,</span> <span class="s1">&#39;slinear&#39;</span><span class="p">,</span> <span class="s1">&#39;quadratic&#39;</span><span class="p">,</span> <span class="s1">&#39;cubic&#39;</span><span class="p">,</span> 
                          <span class="s1">&#39;previous&#39;</span><span class="p">,</span> <span class="s1">&#39;next&#39;</span><span class="p">,</span> <span class="s1">&#39;zero&#39;</span><span class="p">,</span> <span class="s1">&#39;slinear&#39;</span><span class="p">,</span> <span class="s1">&#39;quadratic&#39;</span><span class="p">,</span> <span class="s1">&#39;cubic&#39;</span> <span class="p">];</span>

<span class="c1">#for IAC</span>
<span class="n">TEMP_GIF_STORE_FILES</span> <span class="o">=</span> <span class="s1">&#39;/frames/temp&#39;</span>

<span class="c1">#for NCOs</span>
<span class="n">INITIAL_AMPLITUDE_NCOS</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">]</span>
<span class="n">INITIAL_FREQUENCY_NCOS</span> <span class="o">=</span> <span class="p">[</span><span class="mf">50e6</span><span class="p">]</span>
<span class="n">INITIAL_PHASE_NCOS</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">PYTHON_VERSION</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{VERSION}</span><span class="s1">.</span><span class="si">{MINOR}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">VERSION</span><span class="o">=</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">MINOR</span><span class="o">=</span><span class="n">version_info</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="c1">#####################################################################################################</span>
<span class="c1">#Util functions</span>
<span class="c1">#####################################################################################################</span>
<span class="k">def</span> <span class="nf">info</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns a list of all classes defined in the library.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">current_module</span> <span class="o">=</span> <span class="n">modules</span><span class="p">[</span><span class="vm">__name__</span><span class="p">]</span> <span class="c1">#get the current module (your library)</span>
    <span class="n">classes</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="n">current_module</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">isclass</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="ow">and</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__module__</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">current_module</span><span class="o">.</span><span class="vm">__name__</span><span class="p">):</span> <span class="c1">#find classes in this module</span>
            <span class="n">classes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;AQiPT control: </span><span class="se">\n</span><span class="s2"> Classes: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">classes</span><span class="p">)</span><span class="si">}</span><span class="s2">&gt; </span><span class="se">\n</span><span class="s2"> Last update: 2024-12-14 </span><span class="se">\n</span><span class="s2"> Author(s): Manuel Morgado S.Whitlock </span><span class="se">\n</span><span class="s2"> Website: https://github.com/AQiPT&quot;</span>

<span class="k">def</span> <span class="nf">_resample</span><span class="p">(</span><span class="n">tbase</span><span class="p">,</span> <span class="n">_array</span><span class="p">,</span> <span class="n">nSamples</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">interpolation</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
        <span class="n">_new_array</span> <span class="o">=</span> <span class="n">resample</span><span class="p">(</span><span class="n">_array</span><span class="p">,</span> <span class="n">nSamples</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_new_array</span>

    <span class="k">elif</span> <span class="n">interpolation</span><span class="o">!=</span><span class="kc">None</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">interpolation</span> <span class="ow">in</span> <span class="n">INTERPOLATION_METHODS</span><span class="p">:</span>
            <span class="n">_interp</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">tbase</span><span class="p">,</span> <span class="n">_array</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">interpolation</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">_interp</span>

<span class="k">def</span> <span class="nf">_area_under_curve_arbitrary</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span> <span class="n">y_data</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">simps</span><span class="p">(</span><span class="n">y_data</span><span class="p">,</span> <span class="n">x_data</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_xquare</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">_coef</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]):</span>
    <span class="k">return</span> <span class="n">_coef</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">var</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">_coef</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="o">+</span> <span class="n">_coef</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">_constant</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">var</span><span class="p">))</span><span class="o">*</span><span class="n">value</span>

<span class="k">def</span> <span class="nf">_noisify</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">noise_level</span><span class="p">):</span> <span class="c1">#background noise</span>

    <span class="n">image_shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">image</span><span class="p">);</span>
    <span class="n">image</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="n">image_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">image_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span><span class="o">*</span><span class="n">noise_level</span><span class="p">;</span>

    <span class="k">return</span> <span class="n">image</span> 

<span class="c1">###################################################################################################</span>
<span class="c1">#######################                 Frontend Control                  #########################</span>
<span class="c1">###################################################################################################</span>


<span class="c1">###################################################################################################</span>
<span class="c1">#######################                 Middleware Control                  #######################</span>
<span class="c1">###################################################################################################</span>


<span class="c1">#####################################################################################################</span>
<span class="c1">#Function AQiPT class</span>
<span class="c1">#####################################################################################################</span>
<div class="viewcode-block" id="function">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.function">[docs]</a>
<span class="k">class</span> <span class="nc">function</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        A class for representing easy function objects, such as square pulses, </span>
<span class="sd">        sine, gaussian pulses etc.</span>

<span class="sd">        The function class is the AQiPT representation of functions for create waveforms.</span>
<span class="sd">        This class also show plots in matplotlib, as well as export the functions to numpy arrays.</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        times : numpy.array</span>
<span class="sd">            Values of the time interval where the function is evaluated.</span>
<span class="sd">        args : dict</span>
<span class="sd">            Dictionary with all arguments required by the function.</span>
<span class="sd">        area : int</span>
<span class="sd">            Area under the function i.e., integral of the function.</span>
<span class="sd">        </span>

<span class="sd">        Attributes</span>
<span class="sd">        ----------</span>
<span class="sd">        tbase : array_like</span>
<span class="sd">            Values of the time interval where the function is evaluated. </span>
<span class="sd">        _res : type</span>
<span class="sd">            Resolution of the waveform.</span>
<span class="sd">        arg : dict</span>
<span class="sd">            Dictionary with all the arguments required.</span>
<span class="sd">        waveform : numpy.array</span>
<span class="sd">            Values of the signal or waveform of the function object.</span>
<span class="sd">        area : int</span>
<span class="sd">            Area under the function i.e., integral of the function.</span>

<span class="sd">        </span>
<span class="sd">        Methods</span>
<span class="sd">        -------</span>

<span class="sd">        resample(nSample)</span>
<span class="sd">            Resample the array to nSample number of points.</span>
<span class="sd">        setArea(area)</span>
<span class="sd">            Set area of the function. NOT IMPLEMENTED.</span>
<span class="sd">        getFunction()</span>
<span class="sd">            Returns the value of the waveform of the function object.</span>
<span class="sd">        step()</span>
<span class="sd">            Define a step() function $f(t) = \text{H}(t+t_{o})-\text{H}(t_{o}-t) $</span>
<span class="sd">        ramp()</span>
<span class="sd">            Define a ramp function $f(t) = m\dot t + b$</span>
<span class="sd">        parabola()</span>
<span class="sd">            Define a parabola function $f(t) = a\dot t^{2} + b\dot t + c$</span>
<span class="sd">        sinusoidal()</span>
<span class="sd">            Define a sinusoidal function $f(t) = A \dot sin(\omega \dot t + \phi)$</span>
<span class="sd">        gaussian()</span>
<span class="sd">            Define a gaussian function $f(t) = A \dot exp(((t-t_{o})/(\sigma))^2)</span>
<span class="sd">        triangular()</span>
<span class="sd">            Define a periodical triangular function.</span>
<span class="sd">        sawtooth()</span>
<span class="sd">            Define a cutted-triangular or sawtooth periodical function.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">area</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        
        <span class="c1">#(times=None, args=None, area=np.pi)</span>
        <span class="c1">#atributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tbase</span> <span class="o">=</span> <span class="n">times</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_res</span> <span class="o">=</span> <span class="nb">type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">waveform</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plot</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span>

<div class="viewcode-block" id="function.resample">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.function.resample">[docs]</a>
    <span class="k">def</span> <span class="nf">resample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nSamples</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">waveform</span> <span class="o">=</span> <span class="n">_resample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">waveform</span><span class="p">,</span> <span class="n">nSamples</span><span class="p">);</span></div>


<div class="viewcode-block" id="function.setArea">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.function.setArea">[docs]</a>
    <span class="k">def</span> <span class="nf">setArea</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">area</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Set area of the function (integral) e.g., $\pi$, $\pi/2$ etc</span>

<span class="sd">            Input:</span>
<span class="sd">            ------</span>

<span class="sd">            area : int</span>
<span class="sd">                Area of the pulse.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="function.getFunction">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.function.getFunction">[docs]</a>
    <span class="k">def</span> <span class="nf">getFunction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Get value of the waveform of the function.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">waveform</span></div>

        
<div class="viewcode-block" id="function.step">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.function.step">[docs]</a>
    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plotON</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Basic step function</span>

<span class="sd">            INPUTS:</span>
<span class="sd">                args : dict</span>
<span class="sd">                    Via function instance. </span>

<span class="sd">                    {&#39;amp&#39;: &lt;&lt;float&gt;&gt;, &#39;t_o&#39;: &lt;&lt;float&gt;&gt;, &#39;width&#39;: &lt;&lt;float&gt;&gt;, &#39;tp_window&#39;: &lt;&lt;float&gt;&gt;, &#39;name&#39;: &lt;&lt;str&gt;&gt;, &#39;color&#39;: &lt;&lt;str&gt;&gt;, &#39;type&#39;: &lt;&lt;str&gt;&gt;}</span>


<span class="sd">            OUTPUTS:</span>
<span class="sd">                function : AQiPT.control.function</span>
<span class="sd">                    AQiPT function control-class</span>
<span class="sd">                fig : matplotlib.figure</span>
<span class="sd">                    Plot of function waveform</span>

<span class="sd">            \Example:</span>

<span class="sd">                times = np.linspace(0, 1, 100)</span>

<span class="sd">                to = 0.2;</span>
<span class="sd">                fwidth = 0.1;</span>
<span class="sd">                args = {&#39;amp&#39;: Amp, &#39;t_o&#39;:to, &#39;width&#39;: fwidth};</span>

<span class="sd">                plt.plot(times, step(times, args))</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;amp&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;t_o&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;offset&#39;</span><span class="p">];</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;amp&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;t_o&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">]);</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">waveform</span> <span class="o">=</span> <span class="n">function</span><span class="p">;</span>

        <span class="k">if</span> <span class="n">plotON</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>

            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">();</span>
            <span class="n">function_plot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotFunction</span><span class="p">(</span><span class="n">Hunits</span><span class="o">=</span><span class="s1">&#39;[$\mu s$]&#39;</span><span class="p">,</span> <span class="n">Vunits</span><span class="o">=</span><span class="s1">&#39;[V]&#39;</span><span class="p">);</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_plot</span> <span class="o">=</span> <span class="n">function_plot</span><span class="p">;</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">waveform</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot</span>
        <span class="k">else</span><span class="p">:</span>            
            <span class="k">return</span> <span class="n">function</span><span class="p">,</span> <span class="kc">None</span></div>

    
<div class="viewcode-block" id="function.ramp">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.function.ramp">[docs]</a>
    <span class="k">def</span> <span class="nf">ramp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plotON</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Basic ramp function</span>

<span class="sd">            INPUTS</span>
<span class="sd">                t (array): time domain of function</span>
<span class="sd">                args (dict): width of step function (i.e., start time, step width)</span>
<span class="sd">                plotON (bool): shows (True) or not (False) plot</span>

<span class="sd">            OUTPUTS</span>
<span class="sd">                function: function ready for aqipt.waveform()</span>
<span class="sd">                fig: plot of function</span>

<span class="sd">            \Example:</span>

<span class="sd">                    times = np.linspace(0, 1, 100)</span>

<span class="sd">                    to = 0.2;</span>
<span class="sd">                    fwidth = 0.1;</span>
<span class="sd">                    args = {&#39;t_o&#39;:to, &#39;width&#39;: fwidth};</span>

<span class="sd">                    plt.plot(times, step(times, args))</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">tbase</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">];</span>



        <span class="k">if</span> <span class="n">plotON</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>

            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">();</span>
            <span class="n">function_plot</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">);</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">function_plot</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">waveform</span> <span class="o">=</span> <span class="n">function</span><span class="p">;</span>
            <span class="k">return</span> <span class="n">function</span><span class="p">,</span> <span class="n">function_plot</span>
    
        <span class="k">else</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">waveform</span> <span class="o">=</span> <span class="n">function</span><span class="p">;</span>
            <span class="k">return</span> <span class="n">function</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">,</span> <span class="n">function</span><span class="p">)</span></div>


<div class="viewcode-block" id="function.parabola">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.function.parabola">[docs]</a>
    <span class="k">def</span> <span class="nf">parabola</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plotON</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Basic Parabola function</span>

<span class="sd">            INPUTS</span>
<span class="sd">                t (array): time domain of function</span>
<span class="sd">                args (dict): width of step function (i.e., polynomia coefficients, shift)</span>
<span class="sd">                plotON (bool): shows (True) or not (False) plot</span>

<span class="sd">            OUTPUTS</span>
<span class="sd">                function: function ready for aqipt.waveform()</span>
<span class="sd">                fig: plot of function</span>

<span class="sd">            \Example:</span>

<span class="sd">                times = np.linspace(-75, 75, 500); #time domain function</span>

<span class="sd">                args = {&#39;a&#39;:1, &#39;b&#39;: 0, &#39;c&#39;:0, &#39;shift&#39;:0}; #arguments for function</span>

<span class="sd">                f, fplot = parabola(times, args);</span>
<span class="sd">                plt.show(fplot)</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;shift&#39;</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>



        <span class="k">if</span> <span class="n">plotON</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>

            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">();</span>
            <span class="n">function_plot</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">);</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">function_plot</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">waveform</span> <span class="o">=</span> <span class="n">function</span><span class="p">;</span>
            <span class="k">return</span> <span class="n">function</span><span class="p">,</span> <span class="n">function_plot</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">waveform</span> <span class="o">=</span> <span class="n">function</span><span class="p">;</span>
            <span class="k">return</span> <span class="n">function</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">,</span> <span class="n">function</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="function.sinusoidal">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.function.sinusoidal">[docs]</a>
    <span class="k">def</span> <span class="nf">sinusoidal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plotON</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Basic sinusoidal function</span>

<span class="sd">            INPUTS</span>
<span class="sd">                t (array): time domain of function</span>
<span class="sd">                args (dict): width of step function (i.e., amplitude, frequency, phase)</span>
<span class="sd">                plotON (bool): shows (True) or not (False) plot</span>

<span class="sd">            OUTPUTS</span>
<span class="sd">                function: function ready for aqipt.waveform()</span>
<span class="sd">                fig: plot of function</span>

<span class="sd">            \Example:</span>

<span class="sd">                times = np.linspace(0, 1, 500); #time domain function</span>

<span class="sd">                args = {&#39;Amp&#39;:1, &#39;freq&#39;:5, &#39;phase&#39;:0}; #arguments for function</span>

<span class="sd">                f, fplot = sinusoidal(times, args);</span>
<span class="sd">                plt.show(fplot)</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;Amp&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">tbase</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;phase&#39;</span><span class="p">]);</span>



        <span class="k">if</span> <span class="n">plotON</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>

            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">();</span>
            <span class="n">function_plot</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">);</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">function_plot</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">waveform</span> <span class="o">=</span> <span class="n">function</span><span class="p">;</span>
            <span class="k">return</span> <span class="n">function</span><span class="p">,</span> <span class="n">function_plot</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">waveform</span> <span class="o">=</span> <span class="n">function</span><span class="p">;</span>
            <span class="k">return</span> <span class="n">function</span></div>


<div class="viewcode-block" id="function.chirp">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.function.chirp">[docs]</a>
    <span class="k">def</span> <span class="nf">chirp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plotON</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Frequency chirp function (sinusoid with frequency ramp modulation)</span>

<span class="sd">            INPUTS</span>
<span class="sd">                t (array): time domain of function</span>
<span class="sd">                args (dict): width of step function (i.e., amplitude, frequency, phase)</span>
<span class="sd">                plotON (bool): shows (True) or not (False) plot</span>

<span class="sd">            OUTPUTS</span>
<span class="sd">                function: function ready for aqipt.waveform()</span>
<span class="sd">                fig: plot of function</span>

<span class="sd">            \Example:</span>

<span class="sd">                times = np.linspace(0, 1, 500); #time domain function</span>

<span class="sd">                args = {&#39;Amp&#39;:1, &#39;freq&#39;:5, &#39;phase&#39;:0}; #arguments for function</span>

<span class="sd">                f, fplot = sinusoidal(times, args);</span>
<span class="sd">                plt.show(fplot)</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span>
            <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;amp&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;f_start&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;f_end&#39;</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;f_start&#39;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;duration&#39;</span><span class="p">]))</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;quadratic&#39;</span><span class="p">:</span>
            <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;amp&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">chirp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">,</span> <span class="n">f0</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;f_start&#39;</span><span class="p">],</span> <span class="n">f1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;f_end&#39;</span><span class="p">],</span> <span class="n">t1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;duration&#39;</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;logarithmic&#39;</span><span class="p">:</span>
            <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;amp&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">chirp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">,</span> <span class="n">f0</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;f_start&#39;</span><span class="p">],</span> <span class="n">f1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;f_end&#39;</span><span class="p">],</span> <span class="n">t1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;duration&#39;</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;exponential&#39;</span><span class="p">:</span>
            <span class="n">function</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;amp&#39;</span><span class="p">]</span><span class="o">*</span> <span class="n">chirp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">,</span> <span class="n">f0</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;f_start&#39;</span><span class="p">],</span> <span class="n">f1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;f_end&#39;</span><span class="p">],</span> <span class="n">t1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;duration&#39;</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">])</span>



        <span class="k">if</span> <span class="n">plotON</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>

            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">();</span>
            <span class="n">function_plot</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">);</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">function_plot</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">waveform</span> <span class="o">=</span> <span class="n">function</span><span class="p">;</span>
            <span class="k">return</span> <span class="n">function</span><span class="p">,</span> <span class="n">function_plot</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">waveform</span> <span class="o">=</span> <span class="n">function</span><span class="p">;</span>
            <span class="k">return</span> <span class="n">function</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">,</span> <span class="n">function</span><span class="p">)</span></div>


<div class="viewcode-block" id="function.chirplet">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.function.chirplet">[docs]</a>
    <span class="k">def</span> <span class="nf">chirplet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plotON</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Frequency chirplet function (sinusoid with double frequency ramp modulation)</span>

<span class="sd">            INPUTS</span>
<span class="sd">                t (array): time domain of function</span>
<span class="sd">                args (dict): width of step function (i.e., amplitude, frequency, phase)</span>
<span class="sd">                plotON (bool): shows (True) or not (False) plot</span>

<span class="sd">            OUTPUTS</span>
<span class="sd">                function: function ready for aqipt.waveform()</span>
<span class="sd">                fig: plot of function</span>

<span class="sd">            \Example:</span>

<span class="sd">                times = np.linspace(0, 1, 500); #time domain function</span>

<span class="sd">                args = {&#39;Amp&#39;:1, &#39;freq&#39;:5, &#39;phase&#39;:0}; #arguments for function</span>

<span class="sd">                f, fplot = sinusoidal(times, args);</span>
<span class="sd">                plt.show(fplot)</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span>
            <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;amp&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;f_start&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;f_end&#39;</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;f_start&#39;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;duration&#39;</span><span class="p">]))</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="o">**</span><span class="mi">2</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;f_end&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;f_start&#39;</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;f_end&#39;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;duration&#39;</span><span class="p">]))</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="o">**</span><span class="mi">2</span><span class="p">))),</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;quadratic&#39;</span><span class="p">:</span>
            <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;amp&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">chirp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">,</span> <span class="n">f0</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;f_start&#39;</span><span class="p">],</span> <span class="n">f1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;f_end&#39;</span><span class="p">],</span> <span class="n">t1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;duration&#39;</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;logarithmic&#39;</span><span class="p">:</span>
            <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;amp&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">chirp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">,</span> <span class="n">f0</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;f_start&#39;</span><span class="p">],</span> <span class="n">f1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;f_end&#39;</span><span class="p">],</span> <span class="n">t1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;duration&#39;</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;exponential&#39;</span><span class="p">:</span>
            <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;amp&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">chirp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">,</span> <span class="n">f0</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;f_start&#39;</span><span class="p">],</span> <span class="n">f1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;f_end&#39;</span><span class="p">],</span> <span class="n">t1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;duration&#39;</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tbase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">);</span>


        <span class="k">if</span> <span class="n">plotON</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>

            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">();</span>
            <span class="n">function_plot</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">);</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">function_plot</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">waveform</span> <span class="o">=</span> <span class="n">function</span><span class="p">;</span>
            <span class="k">return</span> <span class="n">function</span><span class="p">,</span> <span class="n">function_plot</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">waveform</span> <span class="o">=</span> <span class="n">function</span><span class="p">;</span>
            <span class="k">return</span> <span class="n">function</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">,</span> <span class="n">function</span><span class="p">)</span></div>


<div class="viewcode-block" id="function.gaussian_chirplet">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.function.gaussian_chirplet">[docs]</a>
    <span class="k">def</span> <span class="nf">gaussian_chirplet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plotON</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Frequency chirp function (sinusoid with double frequency ramp modulation and gaussian amplitude modulation)</span>

<span class="sd">            INPUTS</span>
<span class="sd">                t (array): time domain of function</span>
<span class="sd">                args (dict): width of step function (i.e., amplitude, frequency, phase)</span>
<span class="sd">                plotON (bool): shows (True) or not (False) plot</span>

<span class="sd">            OUTPUTS</span>
<span class="sd">                function: function ready for aqipt.waveform()</span>
<span class="sd">                fig: plot of function</span>

<span class="sd">            \Example:</span>

<span class="sd">                times = np.linspace(0, 1, 500); #time domain function</span>

<span class="sd">                args = {&#39;Amp&#39;:1, &#39;freq&#39;:5, &#39;phase&#39;:0}; #arguments for function</span>

<span class="sd">                f, fplot = sinusoidal(times, args);</span>
<span class="sd">                plt.show(fplot)</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span>
            <span class="n">function</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;f_start&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;f_end&#39;</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;f_start&#39;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;duration&#39;</span><span class="p">]))</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="o">**</span><span class="mi">2</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;f_end&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;f_start&#39;</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;f_end&#39;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;duration&#39;</span><span class="p">]))</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="o">**</span><span class="mi">2</span><span class="p">))),</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">function</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;amp&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;sigma&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;g_center&#39;</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;g_std&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="n">function</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;quadratic&#39;</span><span class="p">:</span>
            <span class="n">function</span> <span class="o">=</span> <span class="n">chirp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">,</span> <span class="n">f0</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;f_start&#39;</span><span class="p">],</span> <span class="n">f1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;f_end&#39;</span><span class="p">],</span> <span class="n">t1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;duration&#39;</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;logarithmic&#39;</span><span class="p">:</span>
            <span class="n">function</span> <span class="o">=</span> <span class="n">chirp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">,</span> <span class="n">f0</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;f_start&#39;</span><span class="p">],</span> <span class="n">f1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;f_end&#39;</span><span class="p">],</span> <span class="n">t1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;duration&#39;</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;exponential&#39;</span><span class="p">:</span>
            <span class="n">function</span> <span class="o">=</span> <span class="n">chirp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">,</span> <span class="n">f0</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;f_start&#39;</span><span class="p">],</span> <span class="n">f1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;f_end&#39;</span><span class="p">],</span> <span class="n">t1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;duration&#39;</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">])</span>


        <span class="k">if</span> <span class="n">plotON</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>

            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">();</span>
            <span class="n">function_plot</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">);</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">function_plot</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">waveform</span> <span class="o">=</span> <span class="n">function</span><span class="p">;</span>
            <span class="k">return</span> <span class="n">function</span><span class="p">,</span> <span class="n">function_plot</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">waveform</span> <span class="o">=</span> <span class="n">function</span><span class="p">;</span>
            <span class="k">return</span> <span class="n">function</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">,</span> <span class="n">function</span><span class="p">)</span></div>


<div class="viewcode-block" id="function.gaussian">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.function.gaussian">[docs]</a>
    <span class="k">def</span> <span class="nf">gaussian</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plotON</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Basic Gaussian function</span>

<span class="sd">            INPUTS:</span>
<span class="sd">            ------</span>
<span class="sd">                t (array): time domain of function</span>
<span class="sd">                args (dict): width of gaussian function (i.e., amplitude, center, standar deviation)</span>
<span class="sd">                plotON (bool): shows (True) or not (False) plot</span>

<span class="sd">            OUTPUT:</span>
<span class="sd">            ------</span>
<span class="sd">                function: function ready for aqipt.waveform()</span>
<span class="sd">                fig: plot of function</span>

<span class="sd">            \Example:</span>

<span class="sd">                    times = np.linspace(0, 1, 100)</span>

<span class="sd">                    amp = 1.0; #gaussian amplitude</span>
<span class="sd">                    center = 0.0; #gaussian center</span>
<span class="sd">                    std = 0.1; #standard deviation</span>
<span class="sd">                    args = {&#39;g_Amp&#39;:amp, &#39;g_center&#39;: center, &#39;g_std&#39;:std}; #arguments for function</span>

<span class="sd">                    plt.plot(times, gauss(times, args))</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;g_Amp&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="o">-</span><span class="p">(</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;g_center&#39;</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;g_std&#39;</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="p">));</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">waveform</span> <span class="o">=</span> <span class="n">function</span><span class="p">;</span>


        <span class="k">if</span> <span class="n">plotON</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>

            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">();</span>
            <span class="n">function_plot</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">);</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_plot</span> <span class="o">=</span> <span class="n">function_plot</span><span class="p">;</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">waveform</span><span class="p">,</span>  <span class="bp">self</span><span class="o">.</span><span class="n">_plot</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="k">return</span> <span class="n">function</span><span class="p">,</span> <span class="kc">None</span></div>

    
<div class="viewcode-block" id="function.blackman">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.function.blackman">[docs]</a>
    <span class="k">def</span> <span class="nf">blackman</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">v_start</span><span class="p">,</span> <span class="n">v_end</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>

<span class="sd">            Basic Blackmand pulse, which reduces spectral leakage..</span>

<span class="sd">            INPUTS:</span>
<span class="sd">            ------</span>
<span class="sd">                t (array): time domain of function</span>
<span class="sd">                args (dict): width of blackman function (i.e., amplitude, center, standar deviation)</span>
<span class="sd">                plotON (bool): shows (True) or not (False) plot</span>

<span class="sd">            OUTPUT:</span>
<span class="sd">            ------</span>
<span class="sd">                function: function ready for aqipt.waveform()</span>
<span class="sd">                fig: plot of function</span>

<span class="sd">            \Example:</span>

<span class="sd">                    </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">_dt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">)</span>
        <span class="n">function</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;Ampi&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;Ampf&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;Ampf&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;Ampi&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.42</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">tbase</span> <span class="o">/</span> <span class="n">_dt</span><span class="p">)</span><span class="o">+</span> <span class="mf">0.08</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">tbase</span> <span class="o">/</span> <span class="n">_dt</span><span class="p">)))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">waveform</span> <span class="o">=</span> <span class="n">function</span><span class="p">;</span>


        <span class="k">if</span> <span class="n">plotON</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>

            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">();</span>
            <span class="n">function_plot</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">);</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_plot</span> <span class="o">=</span> <span class="n">function_plot</span><span class="p">;</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">waveform</span><span class="p">,</span>  <span class="bp">self</span><span class="o">.</span><span class="n">_plot</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="k">return</span> <span class="n">function</span><span class="p">,</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="function.supergaussian">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.function.supergaussian">[docs]</a>
    <span class="k">def</span> <span class="nf">supergaussian</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plotON</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Supergaussian Gaussian function</span>
<span class="sd">    </span>
<span class="sd">            f(x, sigma, n) = y0 + A*exp(-(abs(x-x0) / sigma)^n)</span>

<span class="sd">            INPUTS</span>
<span class="sd">                t (array): time domain of function</span>
<span class="sd">                args (dict): width of step function (i.e., amplitude, center, standar deviation)</span>
<span class="sd">                plotON (bool): shows (True) or not (False) plot</span>

<span class="sd">            OUTPUTS</span>
<span class="sd">                function: function ready for aqipt.waveform()</span>
<span class="sd">                fig: plot of function</span>

<span class="sd">            \Example:</span>

<span class="sd">                    </span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">function</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;yoffset&#39;</span><span class="p">]</span><span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;amp&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;xoffset&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">])</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;n_param&#39;</span><span class="p">]));</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">waveform</span> <span class="o">=</span> <span class="n">function</span><span class="p">;</span>


        <span class="k">if</span> <span class="n">plotON</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>

            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">();</span>
            <span class="n">function_plot</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">);</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_plot</span> <span class="o">=</span> <span class="n">function_plot</span><span class="p">;</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">waveform</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="k">return</span> <span class="n">function</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot</span></div>


<div class="viewcode-block" id="function.triangular">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.function.triangular">[docs]</a>
    <span class="k">def</span> <span class="nf">triangular</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plotON</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Basic triangular function</span>

<span class="sd">        INPUTS</span>
<span class="sd">            t (array): time domain of function</span>
<span class="sd">            args (dict): width of step function (i.e., amplitude, center, standar deviation)</span>
<span class="sd">            plotON (bool): shows (True) or not (False) plot</span>

<span class="sd">        OUTPUTS</span>
<span class="sd">            function: function ready for aqipt.waveform()</span>
<span class="sd">            fig: plot of function</span>

<span class="sd">        \Example:</span>

<span class="sd">            times = np.linspace(0, 3, 500); #time domain function</span>

<span class="sd">            tri_amp = 0; #gaussian amplitude</span>
<span class="sd">            tri_freq = 2; #gaussian center</span>
<span class="sd">            tri_phase = 0; #standard deviation</span>
<span class="sd">            args = {&#39;tri_amp&#39;:tri_amp, &#39;tri_freq&#39;:tri_freq, &#39;tri_phase&#39;:tri_phase}; #arguments for function</span>


<span class="sd">            f, fplot = triangular(times, args)</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;tri_amp&#39;</span><span class="p">]</span> <span class="o">*</span><span class="n">signal</span><span class="o">.</span><span class="n">sawtooth</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;tri_freq&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">tbase</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;tri_phase&#39;</span><span class="p">],</span> <span class="mf">0.5</span><span class="p">);</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">waveform</span> <span class="o">=</span> <span class="n">function</span><span class="p">;</span>

        <span class="k">if</span> <span class="n">plotON</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>

            <span class="n">function_plot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotFunction</span><span class="p">(</span><span class="n">Hunits</span><span class="o">=</span><span class="s1">&#39;[$\mu s$]&#39;</span><span class="p">,</span> <span class="n">Vunits</span><span class="o">=</span><span class="s1">&#39;[V]&#39;</span><span class="p">);</span>
    
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">waveform</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="k">return</span> <span class="n">function</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot</span></div>

    
<div class="viewcode-block" id="function.sawtooth">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.function.sawtooth">[docs]</a>
    <span class="k">def</span> <span class="nf">sawtooth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plotON</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Basic sawtooth function</span>

<span class="sd">        INPUTS</span>
<span class="sd">            t (array): time domain of function</span>
<span class="sd">            args (dict): width of step function (i.e., amplitude, center, standar deviation)</span>
<span class="sd">            plotON (bool): shows (True) or not (False) plot</span>

<span class="sd">        OUTPUTS</span>
<span class="sd">            function: function ready for aqipt.waveform()</span>
<span class="sd">            fig: plot of function</span>

<span class="sd">        \Example:</span>

<span class="sd">            times = np.linspace(0, 3, 500); #time domain function</span>

<span class="sd">            tri_amp = 0; #gaussian amplitude</span>
<span class="sd">            tri_freq = 2; #gaussian center</span>
<span class="sd">            tri_phase = 0; #standard deviation</span>
<span class="sd">            args = {&#39;tri_amp&#39;:tri_amp, &#39;tri_freq&#39;:tri_freq, &#39;tri_phase&#39;:tri_phase}; #arguments for function</span>


<span class="sd">            f, fplot = sawtooth(times, args)</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;tri_amp&#39;</span><span class="p">]</span> <span class="o">*</span><span class="n">signal</span><span class="o">.</span><span class="n">sawtooth</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;tri_freq&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">tbase</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;tri_phase&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">);</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">waveform</span> <span class="o">=</span> <span class="n">function</span><span class="p">;</span>

        <span class="k">if</span> <span class="n">plotON</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>

            
            <span class="n">function_plot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotFunction</span><span class="p">(</span><span class="n">Hunits</span><span class="o">=</span><span class="s1">&#39;[$\mu s$]&#39;</span><span class="p">,</span> <span class="n">Vunits</span><span class="o">=</span><span class="s1">&#39;[V]&#39;</span><span class="p">);</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_plot</span> <span class="o">=</span> <span class="n">function_plot</span><span class="p">;</span>

            
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">waveform</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot</span>
        <span class="k">else</span><span class="p">:</span>

            
            <span class="k">return</span> <span class="n">function</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot</span></div>


<div class="viewcode-block" id="function.cspline">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.function.cspline">[docs]</a>
    <span class="k">def</span> <span class="nf">cspline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plotON</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Cubic spline function</span>

<span class="sd">            INPUTS</span>
<span class="sd">                t (array): time domain of function</span>
<span class="sd">                args (dict): width of step function (i.e., amplitude, frequency, phase)</span>
<span class="sd">                plotON (bool): shows (True) or not (False) plot</span>

<span class="sd">            OUTPUTS</span>
<span class="sd">                function: function ready for aqipt.waveform()</span>
<span class="sd">                fig: plot of function</span>

<span class="sd">            \Example:</span>

<span class="sd">                times = np.linspace(0, 1, 500); #time domain function</span>

<span class="sd">                args = {&#39;Amp&#39;:1, &#39;freq&#39;:5, &#39;phase&#39;:0}; #arguments for function</span>

<span class="sd">                f, fplot = sinusoidal(times, args);</span>
<span class="sd">                plt.show(fplot)</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">_cs</span> <span class="o">=</span> <span class="n">CubicSpline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]);</span>
        <span class="n">_xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">),</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">)</span><span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">))</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">));</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">function</span> <span class="o">=</span> <span class="n">_cs</span><span class="p">(</span><span class="n">_xs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">]);</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">function</span> <span class="o">=</span> <span class="n">_cs</span><span class="p">(</span><span class="n">_xs</span><span class="p">);</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tbase</span> <span class="o">=</span> <span class="n">_xs</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">waveform</span> <span class="o">=</span> <span class="n">function</span><span class="p">;</span>

        <span class="k">if</span> <span class="n">plotON</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>

            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">();</span>
            <span class="n">function_plot</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">_xs</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">);</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">function_plot</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">function</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">_xs</span><span class="p">,</span> <span class="n">function</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="k">return</span> <span class="n">function</span><span class="p">,</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="function.quadrature">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.function.quadrature">[docs]</a>
    <span class="k">def</span> <span class="nf">quadrature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plotON</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Quadrature signal function</span>

<span class="sd">        INPUTS</span>
<span class="sd">            t (array): time domain of function</span>
<span class="sd">            args (dict): width of step function (i.e., amplitude, center, standar deviation)</span>
<span class="sd">            plotON (bool): shows (True) or not (False) plot</span>

<span class="sd">        OUTPUTS</span>
<span class="sd">            function: function ready for aqipt.waveform()</span>
<span class="sd">            fig: plot of function</span>

<span class="sd">        \Example:</span>

<span class="sd">            times = np.linspace(0, 3, 500); #time domain function</span>

<span class="sd">            tri_amp = 0; #gaussian amplitude</span>
<span class="sd">            tri_freq = 2; #gaussian center</span>
<span class="sd">            tri_phase = 0; #standard deviation</span>
<span class="sd">            args = {&#39;tri_amp&#39;:tri_amp, &#39;tri_freq&#39;:tri_freq, &#39;tri_phase&#39;:tri_phase}; #arguments for function</span>


<span class="sd">            f, fplot = sawtooth(times, args)</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;amp&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;phase&#39;</span><span class="p">]));</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">waveform</span> <span class="o">=</span> <span class="n">function</span><span class="p">;</span>

        <span class="k">if</span> <span class="n">plotON</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>

            
            <span class="n">function_plot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotFunction</span><span class="p">(</span><span class="n">Hunits</span><span class="o">=</span><span class="s1">&#39;[$\mu s$]&#39;</span><span class="p">,</span> <span class="n">Vunits</span><span class="o">=</span><span class="s1">&#39;[V]&#39;</span><span class="p">);</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_plot</span> <span class="o">=</span> <span class="n">function_plot</span><span class="p">;</span>

            
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">waveform</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot</span>
        <span class="k">else</span><span class="p">:</span>

            
            <span class="k">return</span> <span class="n">function</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plot</span></div>


    <span class="k">global</span> <span class="n">_opt_hist</span>
    <span class="n">_opt_hist</span><span class="o">=</span><span class="p">[]</span>
<div class="viewcode-block" id="function.multitone">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.function.multitone">[docs]</a>
    <span class="k">def</span> <span class="nf">multitone</span><span class="p">(</span><span class="n">tones</span><span class="p">:</span><span class="nb">dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">frequencies</span><span class="o">=</span><span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">250</span><span class="p">],</span> <span class="n">amplitudes</span><span class="o">=</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="n">phases</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">sampling_rate</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">duration</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
<span class="w">       </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">         Generate a multi-tone signal with given frequencies, amplitudes, and phases.</span>

<span class="sd">         INPUTS:</span>
<span class="sd">         -------</span>

<span class="sd">         - frequencies: list of frequencies (in Hz) for the tones.</span>
<span class="sd">         - amplitudes: list of amplitudes corresponding to each frequency.</span>
<span class="sd">         - phases: list of phases (in radians) corresponding to each frequency.</span>
<span class="sd">         - sampling_rate: number of samples per second.</span>

<span class="sd">         OUTPUTS:</span>
<span class="sd">         --------</span>

<span class="sd">         - time: time axis for the generated signal.</span>
<span class="sd">         - time_signal: multi-tone signal in the time domain.</span>
<span class="sd">       &#39;&#39;&#39;</span>

       <span class="k">if</span> <span class="n">tones</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

          <span class="c1">#define parameters</span>
          <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sampling_rate</span> <span class="o">*</span> <span class="n">duration</span><span class="p">)</span>  <span class="c1">#total number of samples</span>

          <span class="c1">#check if the number of amplitudes and phases matches the number of frequencies</span>
          <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">amplitudes</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">frequencies</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">phases</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">frequencies</span><span class="p">):</span>
             <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The number of amplitudes and phases must match the number of frequencies.&quot;</span><span class="p">)</span>

          <span class="c1">#generate the frequency domain representation (FFT spectrum)</span>
          <span class="n">spectrum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>  <span class="c1">#initialize with zeros</span>

          <span class="c1">#set the frequency components (positive frequencies) with amplitudes and phases</span>
          <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">frequencies</span><span class="p">):</span>
             <span class="n">idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">f</span> <span class="o">*</span> <span class="n">duration</span><span class="p">)</span>  <span class="c1">#convert frequency to index in FFT</span>
             <span class="c1">#set the magnitude and phase (complex exponential with amplitude and phase)</span>
             <span class="n">spectrum</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">amplitudes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">phases</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>  <span class="c1">#amplitude and phase</span>

          <span class="c1">#create the conjugate symmetric part for negative frequencies (for real signal)</span>
          <span class="n">spectrum</span><span class="p">[</span><span class="o">-</span><span class="p">(</span><span class="n">n</span><span class="o">//</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">spectrum</span><span class="p">[</span><span class="mi">1</span><span class="p">:(</span><span class="n">n</span><span class="o">//</span><span class="mi">2</span><span class="p">)][::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

          <span class="c1">#compute the inverse FFT to get the time-domain signal</span>
          <span class="n">time_signal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="n">spectrum</span><span class="p">)</span>

          <span class="c1">#extract the real part (since we&#39;re creating a real signal)</span>
          <span class="n">time_signal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">time_signal</span><span class="p">)</span>

          <span class="c1">#generate the time axis for plotting</span>
          <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

          <span class="k">return</span> <span class="n">time</span><span class="p">,</span> <span class="n">time_signal</span>

       <span class="k">else</span><span class="p">:</span>

          <span class="n">frequencies</span> <span class="o">=</span> <span class="p">[</span> <span class="n">tones</span><span class="p">[</span><span class="n">_tone_idx</span><span class="p">][</span><span class="s1">&#39;frequency&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">_tone_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tones</span><span class="p">))</span> <span class="p">]</span>
          <span class="n">amplitudes</span> <span class="o">=</span> <span class="p">[</span> <span class="n">tones</span><span class="p">[</span><span class="n">_tone_idx</span><span class="p">][</span><span class="s1">&#39;amplitude&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">_tone_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tones</span><span class="p">))</span> <span class="p">]</span>
          <span class="n">phases</span> <span class="o">=</span> <span class="p">[</span> <span class="n">tones</span><span class="p">[</span><span class="n">_tone_idx</span><span class="p">][</span><span class="s1">&#39;phase&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">_tone_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tones</span><span class="p">))</span> <span class="p">]</span>

          <span class="c1">#define parameters</span>
          <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sampling_rate</span> <span class="o">*</span> <span class="n">duration</span><span class="p">)</span>  <span class="c1"># Total number of samples</span>

          <span class="c1">#check if the number of amplitudes and phases matches the number of frequencies</span>
          <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">amplitudes</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">frequencies</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">phases</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">frequencies</span><span class="p">):</span>
             <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The number of amplitudes and phases must match the number of frequencies.&quot;</span><span class="p">)</span>

          <span class="c1">#generate the frequency domain representation (FFT spectrum)</span>
          <span class="n">spectrum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>  <span class="c1">#initialize with zeros</span>

          <span class="c1">#set the frequency components (positive frequencies) with amplitudes and phases</span>
          <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">frequencies</span><span class="p">):</span>
             <span class="n">idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">f</span> <span class="o">*</span> <span class="n">duration</span><span class="p">)</span>  <span class="c1">#convert frequency to index in FFT</span>
             <span class="c1">#set the magnitude and phase (complex exponential with amplitude and phase)</span>
             <span class="n">spectrum</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">amplitudes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">phases</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>  <span class="c1">#amplitude and phase</span>

          <span class="c1">#create the conjugate symmetric part for negative frequencies (for real signal)</span>
          <span class="n">spectrum</span><span class="p">[</span><span class="o">-</span><span class="p">(</span><span class="n">n</span><span class="o">//</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">spectrum</span><span class="p">[</span><span class="mi">1</span><span class="p">:(</span><span class="n">n</span><span class="o">//</span><span class="mi">2</span><span class="p">)][::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

          <span class="c1">#compute the inverse FFT to get the time-domain signal</span>
          <span class="n">time_signal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="n">spectrum</span><span class="p">)</span>

          <span class="c1">#extract the real part (since we&#39;re creating a real signal)</span>
          <span class="n">time_signal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">time_signal</span><span class="p">)</span>

          <span class="c1">#generate the time axis for plotting</span>
          <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

          <span class="k">return</span> <span class="n">time</span><span class="p">,</span> <span class="n">time_signal</span></div>


<div class="viewcode-block" id="function.add_tones">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.function.add_tones">[docs]</a>
    <span class="k">def</span> <span class="nf">add_tones</span><span class="p">(</span><span class="n">tones</span><span class="p">,</span> <span class="n">nr_tones</span><span class="p">,</span> <span class="n">sampling_rate</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">frequency_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">frequencies</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">amplitudes</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">phases</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">plotON</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

       <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tones</span><span class="p">)</span> <span class="c1">#initial number of tones</span>

       <span class="c1">#check input for frequencies, if list or range</span>
       <span class="k">if</span> <span class="n">frequency_range</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">frequencies</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
          <span class="n">freq_new_ideal_tones</span> <span class="o">=</span> <span class="n">frequencies</span>

       <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">frequency_range</span><span class="p">,</span><span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="n">frequencies</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
          <span class="n">freq_new_ideal_tones</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">frequency_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">frequency_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">nr_tones</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

       <span class="k">else</span><span class="p">:</span>

          <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Frequency specification does not match.&#39;</span><span class="p">)</span>


       <span class="c1">#check inputs for amplitudes and phases (all combis)</span>
       <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">amplitudes</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">phases</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>

          <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nr_tones</span><span class="p">):</span>

             <span class="n">tones</span><span class="p">[</span><span class="n">_</span><span class="o">+</span><span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;frequency&#39;</span><span class="p">:</span> <span class="n">freq_new_ideal_tones</span><span class="p">[</span><span class="n">_</span><span class="p">],</span> <span class="s1">&#39;amplitude&#39;</span><span class="p">:</span> <span class="n">amplitudes</span><span class="p">[</span><span class="n">_</span><span class="p">],</span> <span class="s1">&#39;phase&#39;</span><span class="p">:</span><span class="n">phases</span> <span class="p">}</span>

       <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">amplitudes</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span>  <span class="nb">isinstance</span><span class="p">(</span><span class="n">phases</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>

          <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nr_tones</span><span class="p">):</span>

             <span class="n">tones</span><span class="p">[</span><span class="n">_</span><span class="o">+</span><span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;frequency&#39;</span><span class="p">:</span> <span class="n">freq_new_ideal_tones</span><span class="p">[</span><span class="n">_</span><span class="p">],</span> <span class="s1">&#39;amplitude&#39;</span><span class="p">:</span> <span class="n">amplitudes</span><span class="p">[</span><span class="n">_</span><span class="p">],</span> <span class="s1">&#39;phase&#39;</span><span class="p">:</span><span class="n">phases</span><span class="p">[</span><span class="n">_</span><span class="p">]</span> <span class="p">}</span>

       <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">amplitudes</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span>  <span class="nb">isinstance</span><span class="p">(</span><span class="n">phases</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>

          <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nr_tones</span><span class="p">):</span>

             <span class="n">tones</span><span class="p">[</span><span class="n">_</span><span class="o">+</span><span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;frequency&#39;</span><span class="p">:</span> <span class="n">freq_new_ideal_tones</span><span class="p">[</span><span class="n">_</span><span class="p">],</span> <span class="s1">&#39;amplitude&#39;</span><span class="p">:</span> <span class="n">amplitudes</span><span class="p">,</span> <span class="s1">&#39;phase&#39;</span><span class="p">:</span><span class="n">phases</span><span class="p">[</span><span class="n">_</span><span class="p">]</span> <span class="p">}</span>

       <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">amplitudes</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span>  <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">phases</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>

          <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nr_tones</span><span class="p">):</span>

             <span class="n">tones</span><span class="p">[</span><span class="n">_</span><span class="o">+</span><span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;frequency&#39;</span><span class="p">:</span> <span class="n">freq_new_ideal_tones</span><span class="p">[</span><span class="n">_</span><span class="p">],</span> <span class="s1">&#39;amplitude&#39;</span><span class="p">:</span> <span class="n">amplitudes</span><span class="p">,</span> <span class="s1">&#39;phase&#39;</span><span class="p">:</span><span class="n">phases</span> <span class="p">}</span>

       <span class="k">else</span><span class="p">:</span>

          <span class="n">ValueErro</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Amplitudes or phases specifications does not match.&#39;</span><span class="p">)</span>


       <span class="c1">#generates mt signal</span>
       <span class="n">_signal_time</span><span class="p">,</span> <span class="n">_signal</span> <span class="o">=</span> <span class="n">multitone</span><span class="p">(</span><span class="n">tones</span> <span class="o">=</span> <span class="n">tones</span><span class="p">,</span>
                                         <span class="n">sampling_rate</span> <span class="o">=</span> <span class="n">sampling_rate</span><span class="p">,</span> 
                                         <span class="n">duration</span> <span class="o">=</span> <span class="n">duration</span><span class="p">);</span>

       <span class="c1">#generates the fft and plot it (if so)</span>
       <span class="n">_domain_fft</span><span class="p">,</span> <span class="n">_signal_fft</span> <span class="o">=</span> <span class="n">aqipt</span><span class="o">.</span><span class="n">get_fft</span><span class="p">(</span><span class="n">_signal</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">sampling_rate</span><span class="p">,</span> <span class="n">plotON</span><span class="o">=</span><span class="n">plotON</span><span class="p">);</span>

       <span class="k">return</span> <span class="n">tones</span><span class="p">,</span> <span class="n">_signal_time</span><span class="p">,</span> <span class="n">_signal</span><span class="p">,</span> <span class="n">_domain_fft</span><span class="p">,</span> <span class="n">_signal_fft</span></div>


<div class="viewcode-block" id="function.intermodulate_pairs">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.function.intermodulate_pairs">[docs]</a>
    <span class="k">def</span> <span class="nf">intermodulate_pairs</span><span class="p">(</span><span class="n">tbase</span><span class="p">,</span> <span class="n">tone_1</span><span class="p">,</span> <span class="n">tone_2</span><span class="p">,</span> <span class="n">nonLinear_coef</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;a1&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;a2&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;a3&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">}):</span>

       <span class="n">a1</span> <span class="o">=</span> <span class="n">nonLinear_coef</span><span class="p">[</span><span class="s1">&#39;a1&#39;</span><span class="p">];</span> <span class="n">a2</span> <span class="o">=</span> <span class="n">nonLinear_coef</span><span class="p">[</span><span class="s1">&#39;a2&#39;</span><span class="p">];</span> <span class="n">a3</span> <span class="o">=</span> <span class="n">nonLinear_coef</span><span class="p">[</span><span class="s1">&#39;a3&#39;</span><span class="p">];</span>

       <span class="n">freq_1</span> <span class="o">=</span> <span class="n">tone_1</span><span class="p">[</span><span class="s1">&#39;frequency&#39;</span><span class="p">];</span> <span class="n">freq_2</span> <span class="o">=</span> <span class="n">tone_2</span><span class="p">[</span><span class="s1">&#39;frequency&#39;</span><span class="p">];</span>
       <span class="n">amp_1</span> <span class="o">=</span> <span class="n">tone_1</span><span class="p">[</span><span class="s1">&#39;amplitude&#39;</span><span class="p">];</span> <span class="n">amp_2</span> <span class="o">=</span> <span class="n">tone_2</span><span class="p">[</span><span class="s1">&#39;amplitude&#39;</span><span class="p">];</span>
       <span class="n">phase_1</span> <span class="o">=</span> <span class="n">tone_1</span><span class="p">[</span><span class="s1">&#39;phase&#39;</span><span class="p">];</span> <span class="n">phase_2</span> <span class="o">=</span> <span class="n">tone_2</span><span class="p">[</span><span class="s1">&#39;phase&#39;</span><span class="p">];</span>

       <span class="n">_intermodulation_freq_list</span> <span class="o">=</span> <span class="p">[];</span>
       <span class="n">_intermodulation_amp_list</span> <span class="o">=</span> <span class="p">[];</span>

       <span class="n">_intermodulation_freq_list</span><span class="o">+=</span><span class="p">[</span><span class="n">freq_1</span><span class="p">,</span> <span class="n">freq_2</span><span class="p">,</span>                                                     <span class="c1">#1st order (no intermod)</span>
                                    <span class="n">freq_2</span><span class="o">-</span><span class="n">freq_1</span><span class="p">,</span> <span class="n">freq_1</span><span class="o">+</span><span class="n">freq_2</span><span class="p">,</span>                                       <span class="c1">#intermod 2nd order</span>
                                    <span class="mi">2</span><span class="o">*</span><span class="n">freq_1</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">freq_2</span><span class="p">,</span>                                                 <span class="c1">#harmonics 2nd order</span>
                                    <span class="mi">2</span><span class="o">*</span><span class="n">freq_1</span><span class="o">-</span><span class="n">freq_2</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">freq_2</span><span class="o">-</span><span class="n">freq_1</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">freq_1</span><span class="o">+</span><span class="n">freq_2</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">freq_2</span><span class="o">+</span><span class="n">freq_1</span><span class="p">,</span>  <span class="c1">#intermod 3rd order</span>
                                    <span class="mi">3</span><span class="o">*</span><span class="n">freq_1</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="n">freq_2</span>                                                  <span class="c1">#harmonics 3rd order</span>
                                    <span class="p">];</span>
       <span class="n">_intermodulation_amp_list</span><span class="o">+=</span><span class="p">[</span><span class="n">a1</span><span class="o">*</span><span class="n">amp_1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">phase_1</span><span class="p">)</span><span class="o">+</span><span class="mf">0.75</span><span class="o">*</span><span class="n">a3</span><span class="o">*</span><span class="p">(</span><span class="n">amp_1</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="mi">3</span><span class="o">*</span><span class="n">phase_1</span><span class="p">)</span><span class="o">+</span><span class="mf">1.5</span><span class="o">*</span><span class="n">a3</span><span class="o">*</span><span class="n">amp_1</span><span class="o">*</span><span class="p">(</span><span class="n">amp_2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="n">phase_1</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">phase_2</span><span class="p">)),</span>
                                   <span class="n">a1</span><span class="o">*</span><span class="n">amp_2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">phase_2</span><span class="p">)</span><span class="o">+</span><span class="mf">0.75</span><span class="o">*</span><span class="n">a3</span><span class="o">*</span><span class="p">(</span><span class="n">amp_2</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="mi">3</span><span class="o">*</span><span class="n">phase_2</span><span class="p">)</span><span class="o">+</span><span class="mf">1.5</span><span class="o">*</span><span class="n">a3</span><span class="o">*</span><span class="n">amp_2</span><span class="o">*</span><span class="p">(</span><span class="n">amp_1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="n">phase_2</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">phase_1</span><span class="p">)),</span> <span class="c1">#1st order (no intermod)</span>
                                   <span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">amp_1</span><span class="o">*</span><span class="n">amp_2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="n">phase_1</span><span class="o">-</span><span class="n">phase_2</span><span class="p">)),</span>
                                   <span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">amp_1</span><span class="o">*</span><span class="n">amp_2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="n">phase_1</span><span class="o">+</span><span class="n">phase_2</span><span class="p">)),</span> <span class="c1">#intermod 2nd order</span>
                                   <span class="n">a2</span><span class="o">*</span><span class="p">(</span><span class="n">amp_1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">phase_1</span><span class="p">),</span>
                                   <span class="n">a2</span><span class="o">*</span><span class="p">(</span><span class="n">amp_2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">phase_2</span><span class="p">),</span> <span class="c1">#harmonics 2nd order</span>
                                   <span class="mi">3</span><span class="o">*</span><span class="n">a3</span><span class="o">*</span><span class="p">(</span><span class="n">amp_1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">amp_2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">phase_1</span><span class="o">-</span><span class="n">phase_2</span><span class="p">)),</span>
                                   <span class="mi">3</span><span class="o">*</span><span class="n">a3</span><span class="o">*</span><span class="n">amp_1</span><span class="o">*</span><span class="p">(</span><span class="n">amp_2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">phase_2</span><span class="o">-</span><span class="n">phase_1</span><span class="p">)),</span>
                                   <span class="mi">3</span><span class="o">*</span><span class="n">a3</span><span class="o">*</span><span class="p">(</span><span class="n">amp_1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">amp_2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">phase_1</span><span class="o">+</span><span class="n">phase_2</span><span class="p">)),</span>
                                   <span class="mi">3</span><span class="o">*</span><span class="n">a3</span><span class="o">*</span><span class="n">amp_1</span><span class="o">*</span><span class="p">(</span><span class="n">amp_2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">phase_2</span><span class="o">+</span><span class="n">phase_1</span><span class="p">)),</span> <span class="c1">#intermod 3rd order</span>
                                   <span class="n">a3</span><span class="o">*</span><span class="p">(</span><span class="n">amp_1</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="mi">3</span><span class="o">*</span><span class="n">phase_1</span><span class="p">),</span>
                                   <span class="n">a3</span><span class="o">*</span><span class="p">(</span><span class="n">amp_2</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="mi">3</span><span class="o">*</span><span class="n">phase_2</span><span class="p">)</span> <span class="c1">#harmonics 3rd order</span>
                                  <span class="p">];</span>
       <span class="n">_signal</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
       <span class="k">for</span> <span class="n">_freq</span><span class="p">,</span> <span class="n">_amp</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">_intermodulation_freq_list</span><span class="p">,</span> <span class="n">_intermodulation_amp_list</span><span class="p">):</span>
          <span class="n">_signal</span> <span class="o">+=</span> <span class="n">_amp</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">_freq</span><span class="o">*</span><span class="n">tbase</span><span class="p">);</span>

       <span class="k">return</span> <span class="n">_signal</span></div>


<div class="viewcode-block" id="function.intermodulate_multitone">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.function.intermodulate_multitone">[docs]</a>
    <span class="k">def</span> <span class="nf">intermodulate_multitone</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">tones</span><span class="p">):</span>

       <span class="n">_signal</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
       <span class="n">num_elements</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tones</span><span class="p">)</span>

       <span class="k">for</span> <span class="n">_tone1_idx</span><span class="p">,</span> <span class="n">_tone2_idx</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">(</span><span class="n">tones</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="mi">2</span><span class="p">):</span>

          <span class="k">if</span> <span class="n">tones</span><span class="p">[</span><span class="n">_tone1_idx</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">tones</span><span class="p">[</span><span class="n">_tone2_idx</span><span class="p">]</span> <span class="o">==</span> <span class="n">num_elements</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
             <span class="k">continue</span>

          <span class="n">_signal</span> <span class="o">+=</span> <span class="n">intermodulate_pairs</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">tones</span><span class="p">[</span><span class="n">_tone1_idx</span><span class="p">],</span> <span class="n">tones</span><span class="p">[</span><span class="n">_tone2_idx</span><span class="p">])</span>

       <span class="k">return</span> <span class="n">_signal</span></div>


<div class="viewcode-block" id="function.multitone_variance">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.function.multitone_variance">[docs]</a>
    <span class="k">def</span> <span class="nf">multitone_variance</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>

<span class="w">       </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">          Calculates the variance of the multitone frequency tones by pairs, following the expression:</span>
<span class="sd">          E^- = Σ_i,j A_ij^- * exp{i(phi_i - phi_j)} * exp{i(omega_i - omega_j)t}</span>

<span class="sd">       &#39;&#39;&#39;</span>

       <span class="n">frequencies</span> <span class="o">=</span> <span class="n">args</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
       <span class="n">time</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
       <span class="n">_multitone</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">time</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>

       <span class="n">amplitudes</span> <span class="o">=</span> <span class="n">params</span><span class="p">[:</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)]</span>
       <span class="n">phases</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">):]</span>

       <span class="k">for</span> <span class="n">idx_freq_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">frequencies</span><span class="p">)):</span>

          <span class="k">for</span> <span class="n">idx_freq_j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">frequencies</span><span class="p">)):</span>

             <span class="k">if</span> <span class="n">idx_freq_i</span><span class="o">!=</span><span class="n">idx_freq_j</span> <span class="ow">and</span> <span class="n">idx_freq_j</span><span class="o">&gt;</span><span class="n">idx_freq_i</span><span class="p">:</span>
                <span class="n">_multitone</span> <span class="o">+=</span> <span class="n">amplitudes</span><span class="p">[</span><span class="n">idx_freq_i</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="n">phases</span><span class="p">[</span><span class="n">idx_freq_i</span><span class="p">]</span><span class="o">-</span><span class="n">phases</span><span class="p">[</span><span class="n">idx_freq_j</span><span class="p">]))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">frequencies</span><span class="p">[</span><span class="n">idx_freq_i</span><span class="p">]</span><span class="o">-</span><span class="n">frequencies</span><span class="p">[</span><span class="n">idx_freq_j</span><span class="p">])</span><span class="o">*</span><span class="n">time</span><span class="p">)</span> <span class="c1">#calculation of the sum terms</span>

       <span class="n">_opt_hist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">_multitone</span><span class="p">))</span>
       <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">_multitone</span><span class="p">)</span></div>


<div class="viewcode-block" id="function.equalization">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.function.equalization">[docs]</a>
    <span class="k">def</span> <span class="nf">equalization</span><span class="p">(</span><span class="n">tones</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">min_func</span><span class="o">=</span><span class="n">multitone_variance</span><span class="p">):</span>
<span class="w">       </span>
<span class="w">       </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">          Unpack tones and minimize a given function (multitone_variance as default), yielding the new amplitudes and phases</span>
<span class="sd">          of eac hmaitone.</span>

<span class="sd">          Tones are given as a dictionary structure, for example:</span>

<span class="sd">          tones = { &lt;idx&gt; : {&#39;Frequency&#39;: &lt;val&gt;, &#39;phase&#39;: &lt;val&gt;, &#39;amplitude&#39;: &lt;val&gt;} }</span>
<span class="sd">       &#39;&#39;&#39;</span>

       <span class="c1">#unpacking fpa values</span>
       <span class="n">frequencies</span><span class="o">=</span><span class="p">[];</span> <span class="n">phases</span><span class="o">=</span><span class="p">[];</span> <span class="n">amplitudes</span><span class="o">=</span><span class="p">[];</span>
       <span class="k">for</span> <span class="n">_idx</span><span class="p">,</span><span class="n">tone</span> <span class="ow">in</span> <span class="n">tones</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

          <span class="n">frequencies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tone</span><span class="p">[</span><span class="s1">&#39;frequency&#39;</span><span class="p">])</span>
          <span class="n">phases</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tone</span><span class="p">[</span><span class="s1">&#39;phase&#39;</span><span class="p">])</span>
          <span class="n">amplitudes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tone</span><span class="p">[</span><span class="s1">&#39;amplitude&#39;</span><span class="p">])</span>

       <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="n">phases</span><span class="p">:</span>
          <span class="n">phases</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">frequencies</span><span class="p">))</span> <span class="c1">#generating phases if not defined</span>

       <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="n">amplitudes</span><span class="p">:</span>
          <span class="n">amplitudes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">frequencies</span><span class="p">)</span> <span class="c1">#generating amplitudes if not defined</span>

       
       <span class="n">opt_params</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">min_func</span><span class="p">,</span> 
                             <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">amplitudes</span><span class="o">+</span><span class="n">phases</span><span class="p">),</span> 
                             <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">frequencies</span><span class="p">,</span> <span class="n">time</span><span class="p">),</span> 
                             <span class="n">bounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span> <span class="p">(((</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">frequencies</span><span class="p">),</span> <span class="p">((</span><span class="mf">0.8</span><span class="p">,</span> <span class="mi">1</span><span class="p">),)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">frequencies</span><span class="p">)),</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">frequencies</span><span class="p">),</span><span class="mi">2</span><span class="p">)),</span> 
                             <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;return_all&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">},</span> 
                             <span class="n">method</span><span class="o">=</span><span class="s1">&#39;COBYLA&#39;</span><span class="p">,</span>
                             <span class="n">tol</span><span class="o">=</span><span class="mf">1e-2</span> <span class="p">)</span> <span class="c1">#optimization step</span>

       <span class="k">return</span> <span class="n">opt_params</span><span class="p">,</span> <span class="n">_opt_hist</span> </div>


<div class="viewcode-block" id="function.plotFunction">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.function.plotFunction">[docs]</a>
    <span class="k">def</span> <span class="nf">plotFunction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Hunits</span><span class="o">=</span><span class="s1">&#39;[$\mu s$]&#39;</span><span class="p">,</span> <span class="n">Vunits</span><span class="o">=</span><span class="s1">&#39;[V]&#39;</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">();</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">waveform</span><span class="p">);</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Time&#39;</span> <span class="o">+</span> <span class="n">Hunits</span> <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Amplitude &#39;</span> <span class="o">+</span> <span class="n">Vunits</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">waveform</span><span class="p">),</span> <span class="n">s</span><span class="o">=</span><span class="s1">&#39;function: &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                 <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span><span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span>
                 <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">&quot;round&quot;</span><span class="p">,</span>
                           <span class="n">ec</span><span class="o">=</span><span class="p">(</span><span class="mf">.0</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span>
                           <span class="n">fc</span><span class="o">=</span><span class="p">(</span><span class="mf">.0</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),)</span> <span class="p">)</span></div>
</div>


<span class="c1">#####################################################################################################</span>
<span class="c1">#Pulse AQiPT class</span>
<span class="c1">#####################################################################################################</span>
<div class="viewcode-block" id="pulse">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.pulse">[docs]</a>
<span class="k">class</span> <span class="nc">pulse</span><span class="p">:</span> <span class="c1">#pulse(function)</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        A class for building pulses shapes in time domain starting from AQiPT functions() for later</span>
<span class="sd">        build the AQiPT tracks() that can be assigned to AQiPT producers() via AQiPT instructions().</span>

<span class="sd">        The pulse class is the AQiPT representation of shaped pulse for create tracks.</span>
<span class="sd">        This class also show plots in matplotlib, as well as export the pulses as numpy arrays.</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tbase : array_like</span>
<span class="sd">            Data for vector/matrix representation of the quantum object.</span>
<span class="sd">        res : list</span>
<span class="sd">            Dimensions of object used for tensor products.</span>
<span class="sd">        args : list</span>
<span class="sd">            Shape of underlying data structure (matrix shape).</span>

<span class="sd">        Attributes</span>
<span class="sd">        ----------</span>
<span class="sd">        function : array_like</span>
<span class="sd">            Sparse matrix characterizing the quantum object.</span>
<span class="sd">        function_plot : list</span>
<span class="sd">            List of dimensions keeping track of the tensor structure.</span>

<span class="sd">        Methods</span>
<span class="sd">        -------</span>
<span class="sd">        step()</span>
<span class="sd">            Conjugate of quantum object.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pulse_label</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="n">function_list</span><span class="o">=</span><span class="p">[],</span> <span class="n">timeFlags</span><span class="o">=</span><span class="p">[]):</span>
        
        <span class="c1">#atributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tbase</span> <span class="o">=</span> <span class="n">times</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_res</span> <span class="o">=</span> <span class="nb">type</span><span class="p">;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">pulse_label</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_compiled</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_digitized</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">waveform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="o">.</span><span class="n">shape</span><span class="p">);</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="o">.</span><span class="n">shape</span><span class="p">);</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_functionsLST</span> <span class="o">=</span> <span class="n">function_list</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_combfunctionLST</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;t_idx&#39;</span><span class="p">:[],</span> <span class="s1">&#39;function&#39;</span><span class="p">:[]};</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timeFlags</span> <span class="o">=</span> <span class="p">[</span><span class="n">aqipt</span><span class="o">.</span><span class="n">time2index</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">)</span> <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">timeFlags</span><span class="p">];</span> <span class="c1">#timeFlags;</span>
    
<div class="viewcode-block" id="pulse.resample">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.pulse.resample">[docs]</a>
    <span class="k">def</span> <span class="nf">resample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nSamples</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Method that resample the waveform reducing the number of points in the array. It can work</span>
<span class="sd">            with a basic resampling or using interpolation methods.</span>

<span class="sd">            NOTE:</span>
<span class="sd">            -----</span>

<span class="sd">            Resampling can work with resampling the number of points without considerations of the </span>
<span class="sd">            t-domain, this lead to defects in the waveform, but realistic for undersampled waveforms. </span>
<span class="sd">            Better quality waveforms can be obtained from using the interpolation method of SciPy that</span>
<span class="sd">            take into account the t-domain.</span>

<span class="sd">            INPUTS</span>
<span class="sd">                nSamples (int) : number of samples desired in the new waveform</span>
<span class="sd">                interpolation (str) : type of interpolation used to resample the waveform from the list of </span>
<span class="sd">                                      SciPy: [ &#39;linear&#39;, &#39;nearest&#39;, &#39;nearest-up&#39;, </span>
<span class="sd">                                               &#39;zero&#39;, &#39;slinear&#39;, &#39;quadratic&#39;, &#39;cubic&#39;, </span>
<span class="sd">                                               &#39;previous&#39;, &#39;next&#39;. &#39;zero&#39;, &#39;slinear&#39;, &#39;quadratic&#39;, &#39;cubic&#39; ]</span>
<span class="sd">        </span>
<span class="sd">            OUTPUTS</span>
<span class="sd">                self.waveform (array) : resampled waveform of the pulse class</span>
<span class="sd">                self.tbase (array) : resampled waveform of the pulse class</span>
<span class="sd">                self.digiwaveform (arra) : resampled digitized waveform of the pulse class</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">interpolation</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">waveform</span> <span class="o">=</span> <span class="n">_resample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">waveform</span><span class="p">,</span> <span class="n">nSamples</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="n">interpolation</span><span class="p">);</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_digitized</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span> <span class="o">=</span> <span class="n">_resample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span><span class="p">,</span> <span class="n">nSamples</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="n">interpolation</span><span class="p">);</span> <span class="c1">#TODO: check if this works fine. Otherwise re-digitalize the waveform</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">tbase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">),</span> <span class="n">nSamples</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="n">_tbase</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tbase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">),</span> <span class="n">nSamples</span><span class="p">)</span>
            
            <span class="n">_interpolation</span> <span class="o">=</span> <span class="n">_resample</span><span class="p">(</span><span class="n">_tbase</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">waveform</span><span class="p">,</span> <span class="n">nSamples</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="n">interpolation</span><span class="p">);</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">waveform</span> <span class="o">=</span> <span class="n">_interpolation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_digitized</span><span class="p">:</span>
                <span class="n">_dinterpolation</span> <span class="o">=</span> <span class="n">_resample</span><span class="p">(</span><span class="n">_tbase</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span><span class="p">,</span> <span class="n">nSamples</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="n">interpolation</span><span class="p">);</span> <span class="c1">#TODO: check if this works fine. Otherwise re-digitalize the waveform</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span> <span class="o">=</span> <span class="n">_dinterpolation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">)</span></div>


<div class="viewcode-block" id="pulse.overwriteFunction">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.pulse.overwriteFunction">[docs]</a>
    <span class="k">def</span> <span class="nf">overwriteFunction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tstart_index</span><span class="p">,</span> <span class="n">function</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Basic step function</span>

<span class="sd">            INPUTS</span>
<span class="sd">                t (array): time domain of function</span>
<span class="sd">                args (dict): width of step function (i.e., start time, step width)</span>
<span class="sd">                plotON (bool): shows (True) or not (False) plot</span>

<span class="sd">            OUTPUTS</span>
<span class="sd">                function: function ready for aqipt.waveform()</span>
<span class="sd">                fig: plot of function</span>

<span class="sd">            \Example:</span>

<span class="sd">                times = np.linspace(0, 1, 100)</span>

<span class="sd">                to = 0.2;</span>
<span class="sd">                fwidth = 0.1;</span>
<span class="sd">                args = {&#39;t_o&#39;:to, &#39;width&#39;: fwidth};</span>

<span class="sd">                plt.plot(times, step(times, args))</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">waveform</span><span class="p">);</span>
        <span class="n">func</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
        <span class="c1"># result[:function.shape[0]] = function</span>
        <span class="n">replace</span><span class="o">=</span><span class="k">lambda</span> <span class="n">result</span><span class="p">,</span><span class="n">func</span><span class="p">,</span><span class="n">s</span><span class="p">:</span><span class="n">result</span><span class="p">[:</span><span class="n">s</span><span class="p">]</span><span class="o">+</span> <span class="n">func</span> <span class="o">+</span> <span class="n">result</span><span class="p">[</span><span class="n">s</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">func</span><span class="p">):];</span> <span class="c1">#replace function the waveform of function in the tbase at i-point</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">waveform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">replace</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">tstart_index</span><span class="p">)));</span> <span class="c1">#replacing waveform of function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">waveform</span><span class="p">[</span><span class="n">tstart_index</span><span class="p">]</span><span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">waveform</span><span class="p">[</span><span class="n">tstart_index</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">waveform</span><span class="p">[</span><span class="n">tstart_index</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span> <span class="c1">#fixing point in 0 to the average of the i-1 th and i+1 th point</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_compiled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">waveform</span></div>

    
<div class="viewcode-block" id="pulse.add2Pulse">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.pulse.add2Pulse">[docs]</a>
    <span class="k">def</span> <span class="nf">add2Pulse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tstart_index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">_fromCompiler</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="n">_fromCompiler</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span> <span class="c1">#TODO: fix the real+imag when run from compiler</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">_compiled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">;</span>

            <span class="n">function_real</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">function</span><span class="o">.</span><span class="n">getFunction</span><span class="p">());</span>
            <span class="n">function_imag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">function</span><span class="o">.</span><span class="n">getFunction</span><span class="p">());</span>

            <span class="n">wf_real</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">waveform</span><span class="p">));</span>
            <span class="n">wf_imag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">waveform</span><span class="p">));</span>

            <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;Carrier&#39;</span><span class="p">:</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">function_real</span><span class="p">)):</span>
                    <span class="n">wf_real</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">tstart_index</span><span class="p">)]</span> <span class="o">=</span> <span class="n">function_real</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
                    <span class="n">wf_imag</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">tstart_index</span><span class="p">)]</span> <span class="o">=</span> <span class="n">function_imag</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">function_real</span><span class="p">)):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">function_real</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;=</span><span class="n">wf_real</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">tstart_index</span><span class="p">)]:</span>
                            <span class="n">wf_real</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">tstart_index</span><span class="p">)]</span> <span class="o">=</span> <span class="n">function_real</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
                            <span class="n">wf_imag</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">tstart_index</span><span class="p">)]</span> <span class="o">=</span> <span class="n">function_imag</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
                        <span class="k">if</span> <span class="n">function_real</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&lt;</span><span class="n">wf_real</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">tstart_index</span><span class="p">)]:</span>
                            <span class="n">wf_real</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">tstart_index</span><span class="p">)]</span> <span class="o">=</span> <span class="n">wf_real</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">tstart_index</span><span class="p">)]</span><span class="o">+</span><span class="n">function_real</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
                            <span class="n">wf_imag</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">tstart_index</span><span class="p">)]</span> <span class="o">=</span> <span class="n">wf_imag</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">tstart_index</span><span class="p">)]</span><span class="o">+</span><span class="n">function_imag</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">pass</span>


        <span class="k">else</span><span class="p">:</span>
            <span class="n">function_real</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">function</span><span class="o">.</span><span class="n">waveform</span><span class="p">);</span>
            <span class="n">function_imag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">function</span><span class="o">.</span><span class="n">waveform</span><span class="p">);</span>

            <span class="n">wf_real</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">waveform</span><span class="p">));</span>
            <span class="n">wf_imag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">waveform</span><span class="p">));</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_functionsLST</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">function</span><span class="p">);</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_timeFlags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tstart_index</span><span class="p">);</span>

            <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;Carrier&#39;</span><span class="p">:</span>
            
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">function_real</span><span class="p">)):</span>
                    <span class="n">wf_real</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">tstart_index</span><span class="p">)]</span> <span class="o">=</span> <span class="n">function_real</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
                    <span class="n">wf_imag</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">tstart_index</span><span class="p">)]</span> <span class="o">=</span> <span class="n">function_imag</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">function_real</span><span class="p">)):</span>
                
                    <span class="k">if</span> <span class="n">function_real</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;=</span><span class="n">wf_real</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">tstart_index</span><span class="p">)]:</span>
                        <span class="n">wf_real</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">tstart_index</span><span class="p">)]</span> <span class="o">=</span> <span class="n">function_real</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
                        <span class="n">wf_imag</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">tstart_index</span><span class="p">)]</span> <span class="o">=</span> <span class="n">function_imag</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
                    <span class="k">if</span> <span class="n">function_real</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&lt;</span><span class="n">wf_real</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">tstart_index</span><span class="p">)]:</span>
                        <span class="n">wf_real</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">tstart_index</span><span class="p">)]</span> <span class="o">=</span> <span class="n">wf_real</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">tstart_index</span><span class="p">)]</span><span class="o">+</span><span class="n">function_real</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
                        <span class="n">wf_imag</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">tstart_index</span><span class="p">)]</span> <span class="o">=</span> <span class="n">wf_imag</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">tstart_index</span><span class="p">)]</span><span class="o">+</span><span class="n">function_imag</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
                       

        <span class="bp">self</span><span class="o">.</span><span class="n">waveform</span> <span class="o">=</span> <span class="n">wf_real</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">wf_imag</span><span class="p">;</span> <span class="c1">#/max(wf);</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_compiled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">waveform</span></div>

    
<div class="viewcode-block" id="pulse.removeFunction">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.pulse.removeFunction">[docs]</a>
    <span class="k">def</span> <span class="nf">removeFunction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="p">):</span>
        <span class="n">f_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_functionsLST</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">function</span><span class="p">);</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_functionsLST</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">function</span><span class="p">);</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timeFlags</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">f_idx</span><span class="p">);</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">waveform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="o">.</span><span class="n">shape</span><span class="p">);</span>
        <span class="nb">print</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">function</span><span class="p">)),</span><span class="s1">&#39;AQiPT function succesfully removed from pulse.&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">compilePulse</span><span class="p">();</span></div>


<div class="viewcode-block" id="pulse.sumFunction">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.pulse.sumFunction">[docs]</a>
    <span class="k">def</span> <span class="nf">sumFunction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tstart_index</span><span class="p">,</span> <span class="n">function</span><span class="p">):</span>

        <span class="n">l</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">waveform</span><span class="p">,</span> <span class="n">function</span><span class="o">.</span><span class="n">waveform</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">);</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">();</span>
        <span class="n">c</span><span class="p">[</span><span class="n">tstart_index</span><span class="p">:</span><span class="n">tstart_index</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span> <span class="o">+=</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">waveform</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_compiled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">waveform</span></div>


<div class="viewcode-block" id="pulse.combineFunction">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.pulse.combineFunction">[docs]</a>
    <span class="k">def</span> <span class="nf">combineFunction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tstart_index</span><span class="p">,</span> <span class="n">function</span><span class="p">):</span>
 
        <span class="n">l</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">waveform</span><span class="p">,</span> <span class="n">function</span><span class="o">.</span><span class="n">waveform</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">);</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">();</span> 
        <span class="n">c</span><span class="p">[</span><span class="n">tstart_index</span><span class="p">:</span><span class="n">tstart_index</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span> <span class="o">*=</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_combfunctionLST</span><span class="p">[</span><span class="s1">&#39;t_idx&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tstart_index</span><span class="p">);</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_combfunctionLST</span><span class="p">[</span><span class="s1">&#39;function&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">function</span><span class="p">);</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_compiled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">waveform</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span></div>


<div class="viewcode-block" id="pulse.combinePulses">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.pulse.combinePulses">[docs]</a>
    <span class="k">def</span> <span class="nf">combinePulses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PulseLST</span><span class="p">):</span>
        
        <span class="n">_nlabel</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

        <span class="k">for</span> <span class="n">_newpulse</span> <span class="ow">in</span> <span class="n">PulseLST</span><span class="p">:</span>
            <span class="c1">#concatenate waveforms</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">waveform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">waveform</span><span class="p">,</span> <span class="n">_newpulse</span><span class="o">.</span><span class="n">waveform</span><span class="p">));</span>

            <span class="c1">#concatenate digiwaveforms</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span><span class="p">,</span> <span class="n">_newpulse</span><span class="o">.</span><span class="n">digiWaveform</span><span class="p">));</span>

            <span class="c1">#joint func lists</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_functionsLST</span><span class="o">+=</span> <span class="n">_newpulse</span><span class="o">.</span><span class="n">_functionsLST</span><span class="p">;</span>

            <span class="c1">#joint func dict</span>
            <span class="k">for</span> <span class="n">_idx</span><span class="p">,</span> <span class="n">_function</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">_newpulse</span><span class="o">.</span><span class="n">_combfunctionLST</span><span class="p">[</span><span class="s1">&#39;t_idx&#39;</span><span class="p">],</span> <span class="n">_newpulse</span><span class="o">.</span><span class="n">_combfunctionLST</span><span class="p">[</span><span class="s1">&#39;function&#39;</span><span class="p">]):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_combfunctionLST</span><span class="p">[</span><span class="s1">&#39;t_idx&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_idx</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">));</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_combfunctionLST</span><span class="p">[</span><span class="s1">&#39;function&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_function</span><span class="p">);</span>

            <span class="c1">#extend timeflags</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_timeFlags</span><span class="o">+=</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">)</span><span class="o">+</span><span class="n">_flag</span> <span class="k">for</span> <span class="n">_flag</span> <span class="ow">in</span> <span class="n">_newpulse</span><span class="o">.</span><span class="n">_timeFlags</span><span class="p">]</span>

            <span class="c1">#extend tbase</span>
            <span class="n">_newMIN</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">);</span>
            <span class="n">_newMAX</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">)</span> <span class="o">+</span> <span class="nb">max</span><span class="p">(</span><span class="n">_newpulse</span><span class="o">.</span><span class="n">tbase</span><span class="p">);</span>
            <span class="n">_newSTEPS</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">_newpulse</span><span class="o">.</span><span class="n">tbase</span><span class="p">);</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">tbase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">_newMIN</span><span class="p">,</span> <span class="n">_newMAX</span><span class="p">,</span> <span class="n">_newSTEPS</span><span class="p">);</span>

            <span class="c1">#fix label</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="o">==</span><span class="n">_newpulse</span><span class="o">.</span><span class="n">label</span><span class="p">:</span>
                <span class="n">_nlabel</span><span class="o">+=</span><span class="mi">1</span><span class="p">;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="o">+=</span> <span class="s1">&#39; x</span><span class="si">{rep}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rep</span><span class="o">=</span><span class="n">_nlabel</span><span class="p">);</span>  
            <span class="k">else</span><span class="p">:</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="o">+=</span> <span class="s1">&#39;+&#39;</span><span class="o">+</span><span class="n">_newpulse</span><span class="o">.</span><span class="n">label</span><span class="p">;</span></div>


<div class="viewcode-block" id="pulse.mergeFunction">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.pulse.mergeFunction">[docs]</a>
    <span class="k">def</span> <span class="nf">mergeFunction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tstart_index</span><span class="p">,</span> <span class="n">function</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_functionsLST</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">function</span><span class="p">);</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timeFlags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tstart_index</span><span class="p">);</span>

        <span class="n">function</span> <span class="o">=</span> <span class="n">function</span><span class="o">.</span><span class="n">waveform</span><span class="p">;</span>

        <span class="n">l</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">waveform</span><span class="p">,</span> <span class="n">function</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">);</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">();</span>
        <span class="n">c</span><span class="p">[</span><span class="n">tstart_index</span><span class="p">:</span><span class="n">tstart_index</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">waveform</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_compiled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">waveform</span></div>

    
<div class="viewcode-block" id="pulse.getPulse">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.pulse.getPulse">[docs]</a>
    <span class="k">def</span> <span class="nf">getPulse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compiled</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Missing waveform. Please, compile pulse using: PULSENAME.compilePulse()&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span></div>

    
<div class="viewcode-block" id="pulse.getTbase">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.pulse.getTbase">[docs]</a>
    <span class="k">def</span> <span class="nf">getTbase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tbase</span></div>


<div class="viewcode-block" id="pulse.getLabel">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.pulse.getLabel">[docs]</a>
    <span class="k">def</span> <span class="nf">getLabel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span></div>


<div class="viewcode-block" id="pulse.changeLabel">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.pulse.changeLabel">[docs]</a>
    <span class="k">def</span> <span class="nf">changeLabel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newLabel</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">newLabel</span><span class="p">;</span></div>


<div class="viewcode-block" id="pulse.plotPulse">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.pulse.plotPulse">[docs]</a>
    <span class="k">def</span> <span class="nf">plotPulse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="nb">str</span><span class="p">(),</span> <span class="n">ylabel</span><span class="o">=</span><span class="nb">str</span><span class="p">(),</span> <span class="n">_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figure_size</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">4</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">axis</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figure_size</span><span class="p">);</span>
            <span class="k">if</span> <span class="n">_color</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">);</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">);</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">):</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">);</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">);</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">_color</span><span class="p">);</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">_color</span><span class="p">);</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">):</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">);</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">);</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">);</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">);</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span><span class="p">),</span> <span class="n">s</span><span class="o">=</span><span class="s1">&#39;pulse: &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">,</span>
                     <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span><span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span>
                     <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">&quot;round&quot;</span><span class="p">,</span>
                               <span class="n">ec</span><span class="o">=</span><span class="p">(</span><span class="mf">.40</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span>
                               <span class="n">fc</span><span class="o">=</span><span class="p">(</span><span class="mf">.40</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),)</span> <span class="p">)</span>

            <span class="c1">#TO-DO: add labels with correct units from AQiPTcore</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_color</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
                <span class="n">axis</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">);</span>
                <span class="n">axis</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">);</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">):</span>
                    <span class="n">axis</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">);</span>
                    <span class="n">axis</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">);</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">axis</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">_color</span><span class="p">);</span>
                <span class="n">axis</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">_color</span><span class="p">);</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">):</span>
                    <span class="n">axis</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">);</span>
                    <span class="n">axis</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tbase</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">);</span>

            <span class="n">axis</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">);</span>
            <span class="n">axis</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">);</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span><span class="p">),</span> <span class="n">s</span><span class="o">=</span><span class="s1">&#39;pulse: &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">,</span>
                     <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span><span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span>
                     <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">&quot;round&quot;</span><span class="p">,</span>
                               <span class="n">ec</span><span class="o">=</span><span class="p">(</span><span class="mf">.40</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span>
                               <span class="n">fc</span><span class="o">=</span><span class="p">(</span><span class="mf">.40</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),)</span> <span class="p">)</span></div>

            <span class="c1">#TO-DO: add labels with correct units from AQiPTcore</span>
    
<div class="viewcode-block" id="pulse.digitizeWaveform">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.pulse.digitizeWaveform">[docs]</a>
    <span class="k">def</span> <span class="nf">digitizeWaveform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bitdepth</span><span class="p">,</span> <span class="n">minSignal</span><span class="p">,</span> <span class="n">maxSignal</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_digitized</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span><span class="p">;</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_digitized</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">waveform</span><span class="p">);</span>

            <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">minSignal</span><span class="p">,</span> <span class="n">maxSignal</span><span class="p">);</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">maxSignal</span><span class="o">-</span><span class="n">minSignal</span><span class="p">;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(((</span><span class="n">d</span><span class="o">/</span><span class="n">a</span><span class="p">)</span><span class="o">-</span><span class="n">minSignal</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">bitdepth</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">bitdepth</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">minSignal</span><span class="p">)</span><span class="o">*</span><span class="n">a</span><span class="p">;</span>


            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">waveform</span><span class="p">);</span>

            <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">minSignal</span><span class="p">,</span> <span class="n">maxSignal</span><span class="p">);</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">maxSignal</span><span class="o">-</span><span class="n">minSignal</span><span class="p">;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(((</span><span class="n">d</span><span class="o">/</span><span class="n">a</span><span class="p">)</span><span class="o">-</span><span class="n">minSignal</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">bitdepth</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">bitdepth</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">minSignal</span><span class="p">)</span><span class="o">*</span><span class="n">a</span><span class="p">;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_digitized</span><span class="o">=</span><span class="kc">True</span><span class="p">;</span></div>


<div class="viewcode-block" id="pulse.compilePulse">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.pulse.compilePulse">[docs]</a>
    <span class="k">def</span> <span class="nf">compilePulse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_functionsLST</span><span class="o">==</span><span class="p">[]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timeFlags</span><span class="o">==</span><span class="p">[]:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;WARNING: Unable to compile. Missing list of functions or time-flags.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># try:</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_functionsLST</span><span class="p">)):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_functionsLST</span><span class="p">[</span><span class="n">_</span><span class="p">]</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;quadrature&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_functionsLST</span><span class="p">[</span><span class="n">_</span><span class="p">]</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;sinusoidal&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add2Pulse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_timeFlags</span><span class="p">[</span><span class="n">_</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_functionsLST</span><span class="p">[</span><span class="n">_</span><span class="p">],</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;Carrier&#39;</span><span class="p">,</span> <span class="n">_fromCompiler</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add2Pulse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_timeFlags</span><span class="p">[</span><span class="n">_</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_functionsLST</span><span class="p">[</span><span class="n">_</span><span class="p">],</span> <span class="n">kind</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">_fromCompiler</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
            <span class="c1"># except:</span>
            <span class="c1">#     warnings.warn(&#39;WARNING: Missmatch function and time-flag lists\&#39; size&#39;)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_compiled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">;</span></div>

    
<div class="viewcode-block" id="pulse.saveWaveform">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.pulse.saveWaveform">[docs]</a>
    <span class="k">def</span> <span class="nf">saveWaveform</span><span class="p">(</span><span class="n">awg_args</span><span class="p">:</span><span class="nb">dict</span><span class="p">,</span> <span class="n">wf_args_lst</span><span class="p">:</span><span class="nb">list</span><span class="p">,</span> <span class="n">waveforms_lst</span><span class="p">:</span><span class="nb">list</span><span class="p">,</span> <span class="n">fileformat</span><span class="o">=</span><span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">fileformat</span> <span class="o">==</span> <span class="s1">&#39;.csv&#39;</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">waveforms_lst</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">fname</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
                    <span class="n">metadata</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;waveformName,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">wf_args_lst</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]),</span> <span class="s2">&quot;waveformPoints,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">awg_args</span><span class="p">[</span><span class="s1">&#39;sampling&#39;</span><span class="p">]</span><span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="s2">&quot;waveformType,WAVE_ANALOG_16&quot;</span><span class="p">]</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;waveforms_files/ &quot;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">wf_args_lst</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="n">fileformat</span><span class="p">;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">metadata</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;waveformName,&quot;</span> <span class="o">+</span> <span class="n">fname</span><span class="p">,</span> <span class="s2">&quot;waveformPoints,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">awg_args</span><span class="p">[</span><span class="s1">&#39;sampling&#39;</span><span class="p">]</span><span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="s2">&quot;waveformType,WAVE_ANALOG_16&quot;</span><span class="p">]</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;waveforms_files/ &quot;</span><span class="o">+</span> <span class="n">fname</span> <span class="o">+</span> <span class="n">fileformat</span><span class="p">;</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">metadata</span><span class="p">:</span>
                        <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

                    <span class="c1"># np.savetxt(filename, (waveforms_lst[i]).astype(np.uint16) , delimiter=&quot;,&quot;)</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">waveforms_lst</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">waveforms_lst</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Saved waveforms!&#39;</span><span class="p">)</span></div>
</div>


<span class="c1">#####################################################################################################</span>
<span class="c1">#Track AQiPT class</span>
<span class="c1">#####################################################################################################</span>
<div class="viewcode-block" id="track">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.track">[docs]</a>
<span class="k">class</span> <span class="nc">track</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        A class for building full time-domain track waveforms starting from AQiPT functions() and </span>
<span class="sd">        pulse() for later construction of AQiPT sequence() and or AQiPT experiment(). It can be </span>
<span class="sd">        assigned to AQiPT producers().</span>

<span class="sd">        The track class is the AQiPT representation of shaped pulse for create assigned to hardware</span>
<span class="sd">        channels.</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tbase : array_like</span>
<span class="sd">            Data for vector/matrix representation of the quantum object.</span>
<span class="sd">        res : list</span>
<span class="sd">            Dimensions of object used for tensor products.</span>
<span class="sd">        args : list</span>
<span class="sd">            Shape of underlying data structure (matrix shape).</span>

<span class="sd">        Methods</span>
<span class="sd">        -------</span>
<span class="sd">        function : array_like</span>
<span class="sd">            Sparse matrix characterizing the quantum object.</span>
<span class="sd">        function_plot : list</span>
<span class="sd">            List of dimensions keeping track of the tensor structure.</span>
<span class="sd">        step()</span>
<span class="sd">            Conjugate of quantum object.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">track_label</span><span class="p">,</span> <span class="n">tTrack</span><span class="p">,</span> <span class="n">pulse_list</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        
        <span class="c1">#atributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_res</span> <span class="o">=</span> <span class="nb">type</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">track_label</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tTrack</span> <span class="o">=</span> <span class="n">tTrack</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pulseList</span> <span class="o">=</span> <span class="n">pulse_list</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_compiled</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span>
    
<div class="viewcode-block" id="track.compileTrack">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.track.compileTrack">[docs]</a>
    <span class="k">def</span> <span class="nf">compileTrack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_pulseLST</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">new_pulseLST</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">pulse</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pulseList</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span><span class="p">,</span> <span class="n">pulse</span><span class="o">.</span><span class="n">getPulse</span><span class="p">()));</span>
                    <span class="c1"># if self.tTrack == None:</span>
                    <span class="c1">#     _to=len(self.tTrack)*len(tTrack)</span>
                    <span class="c1">#     self.tTrack = np.linspace(0, pulse.tbase[len(pulse.tbase)-1])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_compiled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span> <span class="o">=</span> <span class="n">pulse</span><span class="o">.</span><span class="n">getPulse</span><span class="p">();</span></div>


<div class="viewcode-block" id="track.add2Track">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.track.add2Track">[docs]</a>
    <span class="k">def</span> <span class="nf">add2Track</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pulse_objs</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">pulse_objs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">);</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_compiled</span> <span class="o">=</span> <span class="kc">True</span><span class="p">;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tTrack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span> <span class="p">));</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pulseList</span> <span class="o">=</span> <span class="n">pulse_objs</span><span class="p">;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">pulse</span> <span class="ow">in</span> <span class="n">pulse_objs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span><span class="p">,</span> <span class="n">pulse</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">);</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tTrack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span> <span class="p">));</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pulseList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pulse_objs</span><span class="p">);</span></div>


<div class="viewcode-block" id="track.getTrack">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.track.getTrack">[docs]</a>
    <span class="k">def</span> <span class="nf">getTrack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span></div>


<div class="viewcode-block" id="track.getLabel">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.track.getLabel">[docs]</a>
    <span class="k">def</span> <span class="nf">getLabel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span></div>


<div class="viewcode-block" id="track.getComposition">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.track.getComposition">[docs]</a>
    <span class="k">def</span> <span class="nf">getComposition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pulseList</span></div>


<div class="viewcode-block" id="track.clearTrack">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.track.clearTrack">[docs]</a>
    <span class="k">def</span> <span class="nf">clearTrack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pulseList</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tTrack</span> <span class="o">=</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="track.plotTrack">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.track.plotTrack">[docs]</a>
    <span class="k">def</span> <span class="nf">plotTrack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="nb">str</span><span class="p">(),</span> <span class="n">ylabel</span><span class="o">=</span><span class="nb">str</span><span class="p">(),</span> <span class="n">pcolor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figureSize</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">3</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">axis</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figureSize</span><span class="p">);</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tTrack</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span> <span class="n">pcolor</span><span class="p">);</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tTrack</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span> <span class="n">pcolor</span><span class="p">);</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">);</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">);</span>

            <span class="c1">#TO-DO: add labels with correct units from AQiPTcore</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">axis</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tTrack</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span> <span class="n">pcolor</span><span class="p">);</span>
            <span class="n">axis</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tTrack</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">digiWaveform</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span> <span class="n">pcolor</span><span class="p">);</span>

            <span class="n">axis</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">);</span>
            <span class="n">axis</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">);</span></div>
</div>

            <span class="c1">#TO-DO: add labels with correct units from AQiPTcore</span>
    
<span class="c1">#####################################################################################################</span>
<span class="c1">#Sequence AQiPT class</span>
<span class="c1">#####################################################################################################</span>
<div class="viewcode-block" id="sequence">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.sequence">[docs]</a>
<span class="k">class</span> <span class="nc">sequence</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        A class for building full time-domain track waveforms starting from AQiPT functions() and </span>
<span class="sd">        pulse() for later construction of AQiPT sequence() and or AQiPT experiment(). It can be </span>
<span class="sd">        assigned to AQiPT producers().</span>

<span class="sd">        The track class is the AQiPT representation of shaped pulse for create assigned to hardware</span>
<span class="sd">        channels.</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tbase : array_like</span>
<span class="sd">            Data for vector/matrix representation of the quantum object.</span>
<span class="sd">        res : list</span>
<span class="sd">            Dimensions of object used for tensor products.</span>
<span class="sd">        args : list</span>
<span class="sd">            Shape of underlying data structure (matrix shape).</span>

<span class="sd">        Methods</span>
<span class="sd">        -------</span>
<span class="sd">        function : array_like</span>
<span class="sd">            Sparse matrix characterizing the quantum object.</span>
<span class="sd">        function_plot : list</span>
<span class="sd">            List of dimensions keeping track of the tensor structure.</span>
<span class="sd">        step()</span>
<span class="sd">            Conjugate of quantum object.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sequence_label</span><span class="p">,</span> <span class="n">tSequence</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stack</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nr_cycles</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        
        <span class="c1">#atributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_res</span> <span class="o">=</span> <span class="nb">type</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">sequence_label</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tSequence</span> <span class="o">=</span> <span class="n">tSequence</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nr_cycles</span> <span class="o">=</span> <span class="n">nr_cycles</span><span class="p">;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nr_cycles</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span> <span class="o">=</span> <span class="n">stack</span><span class="p">;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">_stack</span><span class="o">=</span><span class="p">[]</span>
                <span class="k">for</span> <span class="n">_stack_element</span> <span class="ow">in</span> <span class="n">stack</span><span class="p">:</span>
                    <span class="n">_stack_element</span><span class="o">.</span><span class="n">combinePulses</span><span class="p">([</span><span class="n">_stack_element</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nr_cycles</span><span class="o">-</span><span class="mi">2</span><span class="p">));</span>
                    <span class="n">_stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_stack_element</span><span class="p">);</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span> <span class="o">=</span> <span class="n">_stack</span><span class="p">;</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_API_sequence</span> <span class="o">=</span> <span class="p">[];</span>

        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">pulse</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">stack</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">track</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">stack</span><span class="p">):</span>
            
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tSequence</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">getPulse</span><span class="p">())</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">stack</span><span class="p">])</span> <span class="p">);</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tSequence</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">getTrack</span><span class="p">())</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">stack</span><span class="p">])</span> <span class="p">);</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">pulse</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">digiWaveformStack</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">getPulse</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">];</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_API_sequence</span> <span class="o">+=</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">stack</span><span class="p">];</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>

            <span class="k">elif</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">track</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">digiWaveformStack</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">getTrack</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">];</span>

<div class="viewcode-block" id="sequence.stack2Sequence">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.sequence.stack2Sequence">[docs]</a>
    <span class="k">def</span> <span class="nf">stack2Sequence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stack</span><span class="p">,</span> <span class="n">_IDs</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span> <span class="ow">is</span> <span class="p">[]:</span>
            
            <span class="k">if</span> <span class="n">_IDs</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">pulse</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">stack</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">track</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">stack</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span> <span class="o">=</span> <span class="n">stack</span><span class="p">;</span>
                    
                    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">pulse</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">):</span>

                        <span class="n">_stack</span><span class="o">=</span><span class="p">[];</span>
                        <span class="k">for</span> <span class="n">_stack_element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">:</span>
                            <span class="n">_stack_element</span><span class="o">.</span><span class="n">combinePulses</span><span class="p">([</span><span class="n">_stack_element</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nr_cycles</span><span class="o">-</span><span class="mi">1</span><span class="p">));</span>
                            <span class="n">_stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_stack_element</span><span class="p">);</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="o">=</span><span class="n">_stack</span><span class="p">;</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">tSequence</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">getPulse</span><span class="p">())</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">stack</span><span class="p">])</span> <span class="p">);</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">digiWaveformStack</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">getPulse</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">stack</span><span class="p">];</span>

                    <span class="k">elif</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">track</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">tSequence</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">getTrack</span><span class="p">())</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">stack</span><span class="p">])</span> <span class="p">);</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">digiWaveformStack</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">getTrack</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">];</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pulse</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">stack</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">track</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">stack</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span> <span class="o">=</span> <span class="n">stack</span><span class="p">;</span>
                    
                    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pulse</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">):</span>
                        
                        <span class="n">_stack</span><span class="o">=</span><span class="p">[];</span>
                        <span class="k">for</span> <span class="n">_stack_element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">:</span>
                            <span class="n">_stack_element</span><span class="o">.</span><span class="n">combinePulses</span><span class="p">([</span><span class="n">_stack_element</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nr_cycles</span><span class="o">-</span><span class="mi">1</span><span class="p">));</span>
                            <span class="n">_stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_stack_element</span><span class="p">);</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="o">=</span><span class="n">_stack</span><span class="p">;</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">tSequence</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getPulse</span><span class="p">())</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">stack</span><span class="p">])</span> <span class="p">);</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">digiWaveformStack</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getPulse</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">stack</span><span class="p">];</span>

                    <span class="k">elif</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">track</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">tSequence</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getTrack</span><span class="p">())</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">stack</span><span class="p">])</span> <span class="p">);</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">digiWaveformStack</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getTrack</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">];</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span> <span class="o">=</span> <span class="p">[</span><span class="n">element</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">stack</span><span class="p">];</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_API_sequence</span> <span class="o">+=</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">stack</span><span class="p">];</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">pass</span>

        <span class="k">else</span><span class="p">:</span>    
            <span class="k">if</span> <span class="n">_IDs</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">pulse</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">stack</span><span class="p">):</span>

                    <span class="n">_stack</span><span class="o">=</span><span class="p">[];</span>
                    <span class="k">for</span> <span class="n">_stack_element</span> <span class="ow">in</span> <span class="n">stack</span><span class="p">:</span>
                        <span class="n">_stack_element</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">combinePulses</span><span class="p">([</span><span class="n">_stack_element</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nr_cycles</span><span class="o">-</span><span class="mi">1</span><span class="p">));</span>
                        <span class="n">_stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_stack_element</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">digiWaveformStack</span> <span class="o">+=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">getPulse</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">_stack</span><span class="p">];</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="o">+=</span><span class="n">stack</span><span class="p">;</span>

                <span class="k">elif</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">track</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">stack</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">digiWaveformStack</span> <span class="o">+=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">getTrack</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">stack</span><span class="p">];</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="o">+=</span><span class="n">stack</span><span class="p">;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pulse</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">stack</span><span class="p">):</span>

                    <span class="n">_stack</span><span class="o">=</span><span class="p">[];</span>
                    <span class="k">for</span> <span class="n">_stack_element</span> <span class="ow">in</span> <span class="n">stack</span><span class="p">:</span>
                        <span class="n">_buf_stack_element</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">_stack_element</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
                        <span class="n">_stack_element</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">combinePulses</span><span class="p">([</span><span class="n">_buf_stack_element</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nr_cycles</span><span class="o">-</span><span class="mi">1</span><span class="p">));</span>
                        <span class="n">_stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_stack_element</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">digiWaveformStack</span> <span class="o">+=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">getPulse</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">_stack</span><span class="p">];</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="o">+=</span><span class="n">_stack</span><span class="p">;</span>

                <span class="k">elif</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">track</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">stack</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">digiWaveformStack</span> <span class="o">+=</span> <span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getTrack</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">stack</span><span class="p">];</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="o">+=</span><span class="n">stack</span><span class="p">;</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span> <span class="o">=</span> <span class="p">[</span><span class="n">element</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">stack</span><span class="p">];</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_API_sequence</span> <span class="o">+=</span> <span class="p">[[</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">stack</span><span class="p">];</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">stack</span><span class="p">];</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span></div>

                    
<div class="viewcode-block" id="sequence.getSequence">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.sequence.getSequence">[docs]</a>
    <span class="k">def</span> <span class="nf">getSequence</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span></div>


<div class="viewcode-block" id="sequence.getLabel">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.sequence.getLabel">[docs]</a>
    <span class="k">def</span> <span class="nf">getLabel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span></div>


<div class="viewcode-block" id="sequence.clearSequence">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.sequence.clearSequence">[docs]</a>
    <span class="k">def</span> <span class="nf">clearSequence</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">digiWaveformStack</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tSequence</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span></div>


<div class="viewcode-block" id="sequence.plotSequence">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.sequence.plotSequence">[docs]</a>
    <span class="k">def</span> <span class="nf">plotSequence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="nb">str</span><span class="p">(),</span> <span class="n">ylabel</span><span class="o">=</span><span class="nb">str</span><span class="p">(),</span> <span class="n">plotMode</span><span class="o">=</span><span class="s1">&#39;static&#39;</span><span class="p">,</span> <span class="n">figureSize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="n">color_sequence</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">color_text</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">dashboard</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="c1">#TO-DO: add labels with correct units from AQiPTcore</span>

        <span class="k">if</span> <span class="n">plotMode</span> <span class="o">==</span> <span class="s2">&quot;static&quot;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;lines.color&quot;</span><span class="p">:</span> <span class="n">color_text</span><span class="p">,</span>
                                <span class="s2">&quot;patch.edgecolor&quot;</span><span class="p">:</span> <span class="n">color_text</span><span class="p">,</span>
                                <span class="s2">&quot;text.color&quot;</span><span class="p">:</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;axes.facecolor&quot;</span><span class="p">:</span> <span class="n">color_text</span><span class="p">,</span>
                                <span class="s2">&quot;axes.edgecolor&quot;</span><span class="p">:</span> <span class="s2">&quot;lightgray&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;axes.labelcolor&quot;</span><span class="p">:</span> <span class="n">color_text</span><span class="p">,</span>
                                <span class="s2">&quot;xtick.color&quot;</span><span class="p">:</span> <span class="n">color_text</span><span class="p">,</span>
                                <span class="s2">&quot;ytick.color&quot;</span><span class="p">:</span> <span class="n">color_text</span><span class="p">,</span>
                                <span class="s2">&quot;grid.color&quot;</span><span class="p">:</span> <span class="s2">&quot;lightgray&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;figure.facecolor&quot;</span><span class="p">:</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;figure.edgecolor&quot;</span><span class="p">:</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;savefig.facecolor&quot;</span><span class="p">:</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;savefig.edgecolor&quot;</span><span class="p">:</span> <span class="s2">&quot;black&quot;</span><span class="p">})</span>
            
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">digiWaveformStack</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figureSize</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">color_sequence</span><span class="p">);</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">digiWaveformStack</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figureSize</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">color_sequence</span><span class="p">);</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">);</span>

            <span class="n">_</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
            <span class="k">for</span> <span class="n">wavef</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">digiWaveformStack</span><span class="p">:</span>

                <span class="n">color_i</span> <span class="o">=</span> <span class="n">aqipt</span><span class="o">.</span><span class="n">color_lst</span><span class="p">[</span><span class="n">_</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">aqipt</span><span class="o">.</span><span class="n">color_lst</span><span class="p">)];</span>

                <span class="k">if</span> <span class="n">_</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_text</span><span class="p">);</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">digiWaveformStack</span><span class="p">)</span><span class="o">!=</span><span class="mi">1</span><span class="p">:</span>
                        

                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">[</span><span class="n">_</span><span class="p">],</span> <span class="n">pulse</span><span class="p">):</span>
                            <span class="n">axs</span><span class="p">[</span><span class="n">_</span><span class="p">]</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">[</span><span class="n">_</span><span class="p">]</span><span class="o">.</span><span class="n">tbase</span><span class="p">,</span> <span class="n">wavef</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_i</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">);</span>
                            <span class="n">axs</span><span class="p">[</span><span class="n">_</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">[</span><span class="n">_</span><span class="p">]</span><span class="o">.</span><span class="n">tbase</span><span class="p">,</span> <span class="n">wavef</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_i</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="s2">&quot;mid&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">);</span>

                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">[</span><span class="n">_</span><span class="p">],</span> <span class="n">track</span><span class="p">):</span>
                            <span class="n">axs</span><span class="p">[</span><span class="n">_</span><span class="p">]</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">[</span><span class="n">_</span><span class="p">]</span><span class="o">.</span><span class="n">tTrack</span><span class="p">,</span> <span class="n">wavef</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_i</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">);</span>
                            <span class="n">axs</span><span class="p">[</span><span class="n">_</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">[</span><span class="n">_</span><span class="p">]</span><span class="o">.</span><span class="n">tTrack</span><span class="p">,</span> <span class="n">wavef</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_i</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="s2">&quot;mid&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">);</span>

                        <span class="n">axs</span><span class="p">[</span><span class="n">_</span><span class="p">]</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">color_sequence</span><span class="p">);</span> 
                        <span class="n">axs</span><span class="p">[</span><span class="n">_</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">[</span><span class="n">_</span><span class="p">]</span><span class="o">.</span><span class="n">label</span><span class="p">);</span>
                        <span class="n">axs</span><span class="p">[</span><span class="n">_</span><span class="p">]</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">();</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">);</span>
                        <span class="n">axs</span><span class="p">[</span><span class="n">_</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
                        <span class="n">_</span><span class="o">+=</span><span class="mi">1</span><span class="p">;</span>

                <span class="k">else</span><span class="p">:</span>

                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">[</span><span class="n">_</span><span class="p">],</span> <span class="n">pulse</span><span class="p">):</span>
                        <span class="n">axs</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">[</span><span class="n">_</span><span class="p">]</span><span class="o">.</span><span class="n">tbase</span><span class="p">,</span> <span class="n">wavef</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_i</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">);</span>
                        <span class="n">axs</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">[</span><span class="n">_</span><span class="p">]</span><span class="o">.</span><span class="n">tbase</span><span class="p">,</span> <span class="n">wavef</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_i</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="s2">&quot;mid&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">);</span>

                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">[</span><span class="n">_</span><span class="p">],</span> <span class="n">track</span><span class="p">):</span>
                        <span class="n">axsstep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">[</span><span class="n">_</span><span class="p">]</span><span class="o">.</span><span class="n">tTrack</span><span class="p">,</span> <span class="n">wavef</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_i</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">);</span>
                        <span class="n">axs</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">[</span><span class="n">_</span><span class="p">]</span><span class="o">.</span><span class="n">tTrack</span><span class="p">,</span> <span class="n">wavef</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_i</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="s2">&quot;mid&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">);</span>

                    <span class="n">axs</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">color_sequence</span><span class="p">);</span> 
                    <span class="n">axs</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">[</span><span class="n">_</span><span class="p">]</span><span class="o">.</span><span class="n">label</span><span class="p">);</span>
                    <span class="n">axs</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">();</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">);</span>
                    <span class="n">axs</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">rcParamsDefault</span><span class="p">);</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">plotMode</span><span class="o">==</span><span class="s1">&#39;dynamic&#39;</span><span class="p">:</span>

            <span class="c1"># Create figure</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plty</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">)):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
                        <span class="n">plty</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tTrack</span><span class="p">,</span>
                                   <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">digiWaveform</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Re{&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">label</span><span class="o">+</span><span class="s2">&quot;}&quot;</span><span class="p">))</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
                        <span class="n">plty</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tTrack</span><span class="p">,</span>
                                   <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">digiWaveform</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Im{&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">label</span><span class="o">+</span><span class="s2">&quot;}&quot;</span><span class="p">))</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
                        <span class="n">plty</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tbase</span><span class="p">,</span>
                                     <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">digiWaveform</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Re{&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">label</span><span class="o">+</span><span class="s2">&quot;}&quot;</span><span class="p">))</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
                        <span class="n">plty</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tbase</span><span class="p">,</span>
                                     <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">digiWaveform</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Im{&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">label</span><span class="o">+</span><span class="s2">&quot;}&quot;</span><span class="p">))</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>

                <span class="c1"># Set title</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
                    <span class="n">title_text</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span>
                <span class="p">)</span>

                <span class="c1"># Add range slider</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
                    <span class="n">xaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                        <span class="n">rangeselector</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                            <span class="n">buttons</span><span class="o">=</span><span class="nb">list</span><span class="p">([])</span>
                        <span class="p">),</span>
                        <span class="n">rangeslider</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                            <span class="n">visible</span><span class="o">=</span><span class="kc">True</span>
                        <span class="p">),</span>
                <span class="c1">#         type=&quot;date&quot;</span>
                    <span class="p">)</span>
                <span class="p">)</span>

            <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getLabel</span><span class="p">())</span>

            <span class="k">if</span> <span class="n">dashboard</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">fig</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">plotMode</span><span class="o">==</span><span class="s1">&#39;dynamic-subplots&#39;</span><span class="p">:</span>
            
            <span class="kn">from</span> <span class="nn">plotly.subplots</span> <span class="kn">import</span> <span class="n">make_subplots</span>

            <span class="c1"># Create figure</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">make_subplots</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">)),</span> <span class="n">cols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                <span class="n">shared_xaxes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                <span class="n">vertical_spacing</span><span class="o">=</span><span class="mf">0.5</span><span class="o">/</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">)))</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">track</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
                            <span class="n">plty</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tTrack</span><span class="p">,</span>
                                         <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">digiWaveform</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Re{&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">label</span><span class="o">+</span><span class="s2">&quot;}&quot;</span><span class="p">),</span>
                                         <span class="n">row</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
                            <span class="n">plty</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tTrack</span><span class="p">,</span>
                                         <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">digiWaveform</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Im{&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">label</span><span class="o">+</span><span class="s2">&quot;}&quot;</span><span class="p">),</span>
                                         <span class="n">row</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">pass</span>

                    <span class="c1"># fig.add_trace(</span>
                    <span class="c1">#     plty.Scatter(x=self._Stack[i-1].tTrack,</span>
                    <span class="c1">#                  y=self._Stack[i-1].digiWaveform, name=self._Stack[i-1].label),</span>
                    <span class="c1">#     row=i, col=1)</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">pulse</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
                            <span class="n">plty</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tbase</span><span class="p">,</span>
                                         <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">digiWaveform</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Re{&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">label</span><span class="o">+</span><span class="s2">&quot;}&quot;</span><span class="p">),</span>
                            <span class="n">row</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
                            <span class="n">plty</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tbase</span><span class="p">,</span>
                                         <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">digiWaveform</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Im{&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">label</span><span class="o">+</span><span class="s2">&quot;}&quot;</span><span class="p">),</span>
                            <span class="n">row</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">pass</span>
                
                    <span class="c1"># fig.add_trace(</span>
                    <span class="c1">#     plty.Scatter(x=self._Stack[i-1].tbase,</span>
                    <span class="c1">#                  y=self._Stack[i-1].digiWaveform, name=self._Stack[i-1].label),</span>
                    <span class="c1">#     row=i, col=1)</span>

                

                <span class="c1">#Add range slider                </span>
                <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">rangeslider</span><span class="o">=</span> <span class="p">{</span><span class="s1">&#39;visible&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">},</span> <span class="n">row</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Stack</span><span class="p">)),</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
            
            <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getLabel</span><span class="p">())</span>

            <span class="k">if</span> <span class="n">dashboard</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">fig</span>
            
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>
</div>


<span class="c1">###################################################################################################</span>
<span class="c1">#######################                 Backend Control                  ##########################</span>
<span class="c1">###################################################################################################</span>


<span class="c1">#####################################################################################################</span>
<span class="c1">#IAC (IntegratedAtomicChip) AQiPT class</span>
<span class="c1">#####################################################################################################</span>

<span class="k">class</span> <span class="nc">IAC</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">HWgrid</span><span class="p">,</span> <span class="n">substrate_size</span><span class="o">=</span><span class="p">(</span><span class="mi">800</span><span class="p">,</span><span class="mi">800</span><span class="p">)):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_HWgeometry</span> <span class="o">=</span> <span class="n">HWgrid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filledArray</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_emptyArray</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_HW4dynamics</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_HW4statics</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_HW4gates</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_historical_sites</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_site_params</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_site</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_historical_arrays</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_array_params</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_geometry</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_nr_of_qudits</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_qudit_map</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nr_of_registers</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_qregisters</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_historical_drags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_drag_params</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_drags</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_substrate_size</span> <span class="o">=</span> <span class="n">substrate_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_substrate</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_realSubstrate</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_cmap</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_center_frequency</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_center_position</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resolution</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resolution_r</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resolution_f</span> <span class="o">=</span> <span class="kc">None</span>


    <span class="k">def</span> <span class="nf">_set_site</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">bitdepth</span><span class="p">,</span> <span class="n">profile_type</span><span class="o">=</span><span class="s1">&#39;flat&#39;</span><span class="p">,</span> <span class="n">profile_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Generates a 2D matrix with values with a given bitdepth, following a gradient profile.</span>

<span class="sd">            Parameters:</span>

<span class="sd">            size (tuple): A tuple (height, width) specifying the size of the matrix to generate.</span>
<span class="sd">            bitdepth (int): The bitdepth of the matrix, i.e., the number of bits used to represent each value.</span>
<span class="sd">            profile_type (str): The type of gradient profile to use. Can be one of &#39;flat&#39; or &#39;gaussian&#39;.</span>
<span class="sd">            profile_params (dict): A dictionary of additional parameters for the gradient profile.</span>
<span class="sd">                                   If profile_type is &#39;gaussian&#39;, this dictionary should contain the mean, covariance, and standard deviation of the Gaussian.</span>
<span class="sd">                                   It can also optionally contain the maximum number of pixels allowed in the Gaussian region (max_pixels).</span>

<span class="sd">            Returns:</span>

<span class="sd">            ndarray: A 2D matrix of shape (height, width) with values of the specified bitdepth, following the selected gradient profile.</span>
<span class="sd">        </span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1">#create an array of coordinates for the matrix</span>
        <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">);</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">));</span>
        <span class="n">pos</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span>
        <span class="n">pos</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>

        <span class="c1">#create the gradient profile</span>
        <span class="k">if</span> <span class="n">profile_type</span> <span class="o">==</span> <span class="s1">&#39;flat&#39;</span><span class="p">:</span>
            <span class="n">max_value</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="n">bitdepth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
            
            <span class="k">if</span> <span class="s1">&#39;center&#39;</span> <span class="ow">in</span> <span class="n">profile_params</span> <span class="ow">and</span> <span class="s1">&#39;radius&#39;</span> <span class="ow">in</span> <span class="n">profile_params</span><span class="p">:</span>
                
                <span class="n">center</span> <span class="o">=</span> <span class="n">profile_params</span><span class="p">[</span><span class="s1">&#39;center&#39;</span><span class="p">];</span>
                <span class="n">radius</span> <span class="o">=</span> <span class="n">profile_params</span><span class="p">[</span><span class="s1">&#39;radius&#39;</span><span class="p">];</span>
                <span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">y</span> <span class="o">-</span> <span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">);</span>
                <span class="n">gradient</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dist</span> <span class="o">&lt;=</span> <span class="n">radius</span><span class="p">,</span> <span class="n">max_value</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
                
            <span class="k">else</span><span class="p">:</span>
                
                <span class="n">gradient</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="o">*</span> <span class="n">max_value</span><span class="p">;</span>
                
        <span class="k">elif</span> <span class="n">profile_type</span> <span class="o">==</span> <span class="s1">&#39;gaussian&#39;</span><span class="p">:</span>
            
            <span class="n">center</span> <span class="o">=</span> <span class="n">profile_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">));</span>
            <span class="n">cov</span> <span class="o">=</span> <span class="n">profile_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cov&#39;</span><span class="p">,</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]);</span>
            <span class="n">std</span> <span class="o">=</span> <span class="n">profile_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;std&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]);</span>
            <span class="n">cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cov</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">std</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">;</span>
            <span class="n">rv</span> <span class="o">=</span> <span class="n">multivariate_normal</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="n">cov</span><span class="p">);</span>
            <span class="n">gaussian</span> <span class="o">=</span> <span class="n">rv</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">pos</span><span class="p">);</span>
            <span class="n">max_pixels</span> <span class="o">=</span> <span class="n">profile_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;max_pixels&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">);</span>
            
            <span class="k">if</span> <span class="n">max_pixels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                
                <span class="n">num_pixels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">gaussian</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">gaussian</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="o">**</span><span class="n">bitdepth</span><span class="p">);</span>
                
                <span class="k">if</span> <span class="n">num_pixels</span> <span class="o">&gt;</span> <span class="n">max_pixels</span><span class="p">:</span>
                    
                    <span class="n">gaussian</span> <span class="o">*=</span> <span class="n">max_pixels</span> <span class="o">/</span> <span class="n">num_pixels</span><span class="p">;</span>
                    
            <span class="n">max_value</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="n">bitdepth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">max_gaussian</span> <span class="o">=</span> <span class="n">rv</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">center</span><span class="p">);</span>
            <span class="n">scale_factor</span> <span class="o">=</span> <span class="n">max_value</span> <span class="o">/</span> <span class="n">max_gaussian</span><span class="p">;</span>
            <span class="n">gradient</span> <span class="o">=</span> <span class="n">gaussian</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">;</span>

        <span class="n">__site</span> <span class="o">=</span> <span class="n">gradient</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">PYTHON_VERSION</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;3&#39;</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">PYTHON_VERSION</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">&gt;=</span><span class="mi">9</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_site_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="n">size</span><span class="p">,</span> <span class="s1">&#39;bitdepth&#39;</span><span class="p">:</span> <span class="n">bitdepth</span><span class="p">,</span> <span class="s1">&#39;profile_type&#39;</span><span class="p">:</span><span class="n">profile_type</span><span class="p">}</span> <span class="o">|</span> <span class="n">profile_params</span>
        <span class="k">elif</span> <span class="n">PYTHON_VERSION</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;3&#39;</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">PYTHON_VERSION</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">&gt;=</span><span class="mi">5</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_site_params</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="n">size</span><span class="p">,</span> <span class="s1">&#39;bitdepth&#39;</span><span class="p">:</span> <span class="n">bitdepth</span><span class="p">,</span> <span class="s1">&#39;profile_type&#39;</span><span class="p">:</span><span class="n">profile_type</span><span class="p">},</span> <span class="o">**</span><span class="n">profile_params</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_site</span> <span class="o">=</span> <span class="n">__site</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_historical_sites</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">__site</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">output</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">__site</span>

    <span class="k">def</span> <span class="nf">_rectangular_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">mesh_dim</span><span class="p">,</span> <span class="n">sep_x</span><span class="p">,</span> <span class="n">sep_y</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Generates a list of 2D coordinate tuples (x, y) for a rectangular array of sites,</span>
<span class="sd">            given the dimensions m by n number of sites, the total dimension size of the hypothetical mesh,</span>
<span class="sd">            the constant separation in X and Y between points of the array, and the origin point.</span>

<span class="sd">            Parameters:</span>
<span class="sd">                - m (int): number of rows in the rectangular array</span>
<span class="sd">                - n (int): number of columns in the rectangular array</span>
<span class="sd">                - mesh_dim (int): total dimension size of the hypothetical mesh (assumes square mesh)</span>
<span class="sd">                - sep_x (float): constant separation in X between points of the array</span>
<span class="sd">                - sep_y (float): constant separation in Y between points of the array</span>
<span class="sd">                - origin (tuple of floats): starting point (x, y) for the first point in the array (default: (0, 0))</span>

<span class="sd">            Returns:</span>
<span class="sd">                - coords (list of tuples): list of 2D coordinate tuples (x, y)</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">origin</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">j</span> <span class="o">*</span> <span class="n">sep_x</span> <span class="o">+</span> <span class="n">x0</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">sep_y</span> <span class="o">+</span> <span class="n">y0</span>
                
                <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">mesh_dim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">y</span> <span class="o">&gt;</span> <span class="n">mesh_dim</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generated coordinate (</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s2">) is outside the mesh dimensions (</span><span class="si">{</span><span class="n">mesh_dim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">mesh_dim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">).&quot;</span><span class="p">)</span>
                
                <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_array_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dimension m&#39;</span><span class="p">:</span> <span class="n">m</span><span class="p">,</span> <span class="s1">&#39;dimension n&#39;</span><span class="p">:</span> <span class="n">n</span><span class="p">,</span> <span class="s1">&#39;full mesh&#39;</span><span class="p">:</span><span class="n">mesh_dim</span><span class="p">,</span> 
                              <span class="s1">&#39;x resolution&#39;</span><span class="p">:</span> <span class="n">sep_x</span><span class="p">,</span> <span class="s1">&#39;y resolution&#39;</span><span class="p">:</span> <span class="n">sep_y</span><span class="p">,</span> <span class="s1">&#39;origin&#39;</span><span class="p">:</span> <span class="n">origin</span><span class="p">,</span> 
                              <span class="s1">&#39;geometry type&#39;</span><span class="p">:</span> <span class="s1">&#39;rectangular&#39;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_geometry</span> <span class="o">=</span> <span class="n">coords</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_historical_arrays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">output</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">coords</span>

    <span class="k">def</span> <span class="nf">_triangular_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">mesh_dim</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Generates a list of 2D coordinate tuples (x, y) for a honeycomb lattice,</span>
<span class="sd">            given the dimensions m by n number of sites, the total dimension size of the hypothetical mesh,</span>
<span class="sd">            the separation between points of the lattice, and the origin point.</span>

<span class="sd">            Parameters:</span>
<span class="sd">            - m (int): number of rows in the honeycomb lattice</span>
<span class="sd">            - n (int): number of columns in the honeycomb lattice</span>
<span class="sd">            - mesh_dim (tuple of floats): total dimension size of the hypothetical mesh (mesh_dim_x, mesh_dim_y)</span>
<span class="sd">            - sep (float): separation between points of the lattice</span>
<span class="sd">            - origin (tuple of floats): starting point (x, y) for the first point in the lattice (default: (0, 0))</span>

<span class="sd">            Returns:</span>
<span class="sd">            - coords (list of tuples): list of 2D coordinate tuples (x, y)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">n</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">n</span><span class="p">);</span>
        <span class="n">mesh_dim_x</span><span class="p">,</span> <span class="n">mesh_dim_y</span> <span class="o">=</span> <span class="n">mesh_dim</span>
        <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">origin</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">sep</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">sep</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">x0</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">3</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sep</span> <span class="o">+</span> <span class="n">y0</span>
                <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">mesh_dim_x</span> <span class="ow">or</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">y</span> <span class="o">&gt;</span> <span class="n">mesh_dim_y</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generated coordinate (</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s2">) is outside the mesh dimensions (</span><span class="si">{</span><span class="n">mesh_dim_x</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">mesh_dim_y</span><span class="si">}</span><span class="s2">).&quot;</span><span class="p">)</span>
                <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_array_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dimension m&#39;</span><span class="p">:</span> <span class="n">m</span><span class="p">,</span> <span class="s1">&#39;dimension n&#39;</span><span class="p">:</span> <span class="n">n</span><span class="p">,</span> <span class="s1">&#39;full mesh&#39;</span><span class="p">:</span><span class="n">mesh</span><span class="p">,</span> 
                              <span class="s1">&#39;resolution&#39;</span><span class="p">:</span> <span class="n">sep</span><span class="p">,</span> <span class="s1">&#39;origin&#39;</span><span class="p">:</span> <span class="n">origin</span><span class="p">,</span> 
                              <span class="s1">&#39;geometry type&#39;</span><span class="p">:</span> <span class="s1">&#39;triangular&#39;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_geometry</span> <span class="o">=</span> <span class="n">coords</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_historical_arrays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">output</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">coords</span>

    <span class="k">def</span> <span class="nf">_honeycomb_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">r</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">a</span><span class="o">=</span><span class="n">b</span><span class="o">/</span><span class="mi">2</span>

        <span class="n">coords</span> <span class="o">=</span> <span class="n">create_hex_grid</span><span class="p">(</span><span class="n">nx</span><span class="o">=</span><span class="n">m</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">min_diam</span><span class="o">=</span><span class="n">r</span><span class="o">/</span><span class="mf">0.5776</span><span class="p">,</span> <span class="n">do_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># Create 5x5 grid with no gaps</span>

        <span class="k">def</span> <span class="nf">generate_hexagon_points</span><span class="p">(</span><span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span><span class="p">,</span> <span class="n">radius</span><span class="p">):</span>
            <span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
                <span class="n">angle_deg</span> <span class="o">=</span> <span class="p">(</span><span class="mi">60</span><span class="p">)</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span><span class="mi">90</span>
                <span class="n">angle_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">angle_deg</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">center_x</span> <span class="o">+</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle_rad</span><span class="p">)</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">center_y</span> <span class="o">+</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle_rad</span><span class="p">)</span>
                <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">points</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
        
        <span class="n">v_values</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="o">+</span><span class="n">m</span><span class="o">*</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="o">+</span><span class="n">n</span><span class="o">*</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;violet&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
                <span class="n">vertexes</span> <span class="o">=</span> <span class="n">generate_hexagon_points</span><span class="p">(</span><span class="n">center_x</span><span class="o">=</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="o">+</span><span class="n">m</span><span class="o">*</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">j</span><span class="p">),</span> 
                                                   <span class="n">center_y</span><span class="o">=</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="o">+</span><span class="n">n</span><span class="o">*</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">j</span><span class="p">),</span> 
                                                   <span class="n">radius</span><span class="o">=</span><span class="n">r</span><span class="p">)</span>
                <span class="n">v_values</span><span class="o">+=</span><span class="n">vertexes</span><span class="p">;</span>
                
                <span class="k">for</span> <span class="n">vertex</span> <span class="ow">in</span> <span class="n">vertexes</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">vertex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vertex</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">_array_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dimension m&#39;</span><span class="p">:</span> <span class="n">m</span><span class="p">,</span> <span class="s1">&#39;dimension n&#39;</span><span class="p">:</span> <span class="n">n</span><span class="p">,</span> <span class="s1">&#39;radius&#39;</span><span class="p">:</span><span class="n">r</span><span class="p">,</span> 
                              <span class="s1">&#39;geometry type&#39;</span><span class="p">:</span> <span class="s1">&#39;honeycomb&#39;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_geometry</span> <span class="o">=</span> <span class="n">v_values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_historical_arrays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v_values</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">output</span><span class="p">:</span>            
            <span class="k">return</span> <span class="n">v_values</span>

    <span class="k">def</span> <span class="nf">_ring_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mesh_dim</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">alpha_0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plotON</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Generates a list of 2D coordinate tuples (x, y) for a ring array of N sites,</span>
<span class="sd">            over a circumference of radius R, equally spaced over the circunference line </span>
<span class="sd">            (2pi/N) starting at angle alpha_0.</span>

<span class="sd">            Parameters:</span>
<span class="sd">                - N (float): number of points along the ring</span>
<span class="sd">                - R (float): radius of the ring</span>
<span class="sd">                - alpha_0 (float): initial angle for placing the points</span>
<span class="sd">            Returns:</span>
<span class="sd">                - coords (list of tuples): list of 2D coordinate tuples (x, y)</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">alpha_0</span><span class="p">,</span> <span class="n">alpha_0</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">x_coords</span> <span class="o">=</span> <span class="p">[</span><span class="n">R</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span> <span class="o">+</span> <span class="n">origin</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">angle</span> <span class="ow">in</span> <span class="n">angles</span><span class="p">]</span>
        <span class="n">y_coords</span> <span class="o">=</span> <span class="p">[</span><span class="n">R</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span> <span class="o">+</span> <span class="n">origin</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">angle</span> <span class="ow">in</span> <span class="n">angles</span><span class="p">]</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">x_coords</span><span class="p">,</span> <span class="n">y_coords</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_array_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coordinates&#39;</span><span class="p">:</span><span class="n">coords</span><span class="p">,</span>
                              <span class="s1">&#39;full mesh&#39;</span><span class="p">:</span> <span class="n">mesh_dim</span><span class="p">,</span>
                              <span class="s1">&#39;nr of sites&#39;</span><span class="p">:</span> <span class="n">N</span><span class="p">,</span>
                              <span class="s1">&#39;radius&#39;</span><span class="p">:</span> <span class="n">R</span><span class="p">,</span> 
                              <span class="s1">&#39;initial angle&#39;</span><span class="p">:</span> <span class="n">alpha_0</span><span class="p">,</span> 
                              <span class="s1">&#39;rotations&#39;</span><span class="p">:</span> <span class="p">[],</span>
                              <span class="s1">&#39;origin&#39;</span><span class="p">:</span> <span class="n">origin</span><span class="p">,</span>
                              <span class="s1">&#39;geometry type&#39;</span><span class="p">:</span> <span class="s1">&#39;ring&#39;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_geometry</span> <span class="o">=</span> <span class="n">coords</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_historical_arrays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">plotON</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_coords</span><span class="p">,</span> <span class="n">y_coords</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Original Points&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x_coords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">x_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">y_coords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">y_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coords</span><span class="p">):</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Ring with </span><span class="si">{</span><span class="n">N</span><span class="si">}</span><span class="s1"> Points and Radius </span><span class="si">{</span><span class="n">R</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">output</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">coords</span>
    
    <span class="k">def</span> <span class="nf">_expand_ring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plotON</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Expand the ring coordinates by a distance d.</span>

<span class="sd">            Parameters:</span>
<span class="sd">                - coordinates (array): initial coordinates</span>
<span class="sd">                - d (float): distance displaced summed to the original radius</span>
<span class="sd">            Returns:</span>
<span class="sd">                - coords (list of tuples): list of 2D coordinate tuples (x, y)</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_array_params</span><span class="p">[</span><span class="s1">&#39;radius&#39;</span><span class="p">]</span>
        <span class="n">new_radius</span> <span class="o">=</span> <span class="n">R</span> <span class="o">+</span> <span class="n">d</span>
        <span class="n">angles</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_array_params</span><span class="p">[</span><span class="s1">&#39;origin&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_array_params</span><span class="p">[</span><span class="s1">&#39;origin&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">coordinates</span><span class="p">]</span>
        <span class="n">expanded_coordinates</span> <span class="o">=</span> <span class="p">[(</span><span class="n">new_radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_array_params</span><span class="p">[</span><span class="s1">&#39;origin&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">new_radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_array_params</span><span class="p">[</span><span class="s1">&#39;origin&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">angle</span> <span class="ow">in</span> <span class="n">angles</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_array_params</span><span class="p">[</span><span class="s1">&#39;radius&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_radius</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_geometry</span> <span class="o">=</span> <span class="n">expanded_coordinates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_historical_arrays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">expanded_coordinates</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">plotON</span><span class="p">:</span>
            <span class="n">original_x</span><span class="p">,</span> <span class="n">original_y</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">coordinates</span><span class="p">)</span>
            <span class="n">expanded_x</span><span class="p">,</span> <span class="n">expanded_y</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">expanded_coordinates</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">original_x</span><span class="p">,</span> <span class="n">original_y</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Original Points&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">original_x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">original_x</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">original_y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">original_y</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coordinates</span><span class="p">):</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">expanded_x</span><span class="p">,</span> <span class="n">expanded_y</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Expanded Points&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">expanded_x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">expanded_x</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">expanded_y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">expanded_y</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="s1">&#39;g--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">expanded_coordinates</span><span class="p">):</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Original and Expanded Points&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">output</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">expanded_coordinates</span>

    <span class="k">def</span> <span class="nf">_rotate_ring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plotON</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Rotate the ring coordinates by an angle beta.</span>

<span class="sd">            Parameters:</span>
<span class="sd">                - coordinates (array): initial coordinates</span>
<span class="sd">                - beta (float): rotation angle performed over the original radius</span>
<span class="sd">            Returns:</span>
<span class="sd">                - coords (list of tuples): list of 2D coordinate tuples (x, y)</span>
<span class="sd">        &#39;&#39;&#39;</span>



        <span class="n">rotation_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">beta</span><span class="p">),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">beta</span><span class="p">)],[</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">beta</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">beta</span><span class="p">)]</span> <span class="p">])</span>
        <span class="n">rotated_coordinates</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="n">coordinates</span><span class="p">:</span>
            <span class="n">rotated_point</span> <span class="o">=</span> <span class="n">rotation_matrix</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_array_params</span><span class="p">[</span><span class="s1">&#39;origin&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_array_params</span><span class="p">[</span><span class="s1">&#39;origin&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]])</span>
            <span class="n">rotated_coordinates</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">rotated_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_array_params</span><span class="p">[</span><span class="s1">&#39;origin&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">rotated_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_array_params</span><span class="p">[</span><span class="s1">&#39;origin&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_array_params</span><span class="p">[</span><span class="s1">&#39;rotations&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_geometry</span> <span class="o">=</span> <span class="n">rotated_coordinates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_historical_arrays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rotated_coordinates</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">plotON</span><span class="p">:</span>
            <span class="n">original_x</span><span class="p">,</span> <span class="n">original_y</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">coordinates</span><span class="p">)</span>
            <span class="n">rotated_x</span><span class="p">,</span> <span class="n">rotated_y</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">rotated_coordinates</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">original_x</span><span class="p">,</span> <span class="n">original_y</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Original Points&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">original_x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">original_x</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">original_y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">original_y</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coordinates</span><span class="p">):</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rotated_x</span><span class="p">,</span> <span class="n">rotated_y</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Rotated Points&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">rotated_x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">rotated_x</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">rotated_y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">rotated_y</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="s1">&#39;r--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rotated_coordinates</span><span class="p">):</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Original and Rotated Points&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">output</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">rotated_coordinates</span>

    <span class="k">def</span> <span class="nf">_drag_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">gtype</span><span class="o">=</span><span class="s1">&#39;ring&#39;</span><span class="p">,</span> <span class="n">gif_filename</span><span class="o">=</span><span class="s2">&quot;sweep.gif&quot;</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Rotate the ring coordinates by an angle beta.</span>

<span class="sd">            Parameters:</span>
<span class="sd">                - coordinates (array): initial coordinates</span>
<span class="sd">                - beta (float): rotation angle performed over the original radius</span>
<span class="sd">            Returns:</span>
<span class="sd">                - coords (list of tuples): list of 2D coordinate tuples (x, y)</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">gtype</span><span class="o">==</span><span class="s1">&#39;ring&#39;</span><span class="p">:</span>
            <span class="n">frames</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">M</span><span class="p">):</span>
                <span class="n">intermediate_coordinates</span> <span class="o">=</span> <span class="p">[(</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="n">x2</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="n">y2</span> <span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)]</span>
                <span class="n">frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">intermediate_coordinates</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_drag_params</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;initial coordinates&#39;</span><span class="p">:</span> <span class="n">A</span><span class="p">,</span> <span class="s1">&#39;final coordinates&#39;</span><span class="p">:</span> <span class="n">B</span><span class="p">,</span> <span class="s1">&#39;number of frames&#39;</span><span class="p">:</span> <span class="n">M</span><span class="p">,</span> <span class="s1">&#39;geometry type&#39;</span><span class="p">:</span> <span class="n">gtype</span><span class="p">,</span> <span class="s1">&#39;file name GIF&#39;</span><span class="p">:</span> <span class="n">gif_filename</span><span class="p">})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_historical_drags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_drags</span> <span class="o">=</span> <span class="n">frames</span>

            <span class="k">if</span> <span class="n">output</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">frames</span>

            <span class="n">images</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">frames</span><span class="p">:</span>
                <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
                <span class="n">A_x</span><span class="p">,</span> <span class="n">A_y</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">A</span><span class="p">)</span>
                <span class="n">frame_x</span><span class="p">,</span> <span class="n">frame_y</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">frame</span><span class="p">)</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">A_x</span><span class="p">,</span> <span class="n">A_y</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Start Points&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">A_x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">A_x</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">A_y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">A_y</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">frame_x</span><span class="p">,</span> <span class="n">frame_y</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Sweep Points&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">frame_x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">frame_x</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">frame_y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">frame_y</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="s1">&#39;b--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Sweep Frame&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

                <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;frame_</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">images</span><span class="p">)</span><span class="si">}</span><span class="s2">.png&quot;</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                <span class="n">images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

            <span class="k">with</span> <span class="n">imageio</span><span class="o">.</span><span class="n">get_writer</span><span class="p">(</span><span class="n">gif_filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">loop</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">as</span> <span class="n">writer</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">images</span><span class="p">:</span>
                    <span class="n">writer</span><span class="o">.</span><span class="n">append_data</span><span class="p">(</span><span class="n">imageio</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">image</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">images</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;GIF saved as </span><span class="si">{</span><span class="n">gif_filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_arbitrary_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">,</span> <span class="n">mesh_dim</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_array_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;coordinates&#39;</span><span class="p">:</span><span class="n">coordinates</span><span class="p">,</span>
                              <span class="s1">&#39;full mesh&#39;</span><span class="p">:</span> <span class="n">mesh_dim</span><span class="p">,</span>
                              <span class="s1">&#39;nr of sites&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">coordinates</span><span class="p">),</span>
                              <span class="s1">&#39;geometry type&#39;</span><span class="p">:</span> <span class="s1">&#39;arbitrary&#39;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_geometry</span> <span class="o">=</span> <span class="n">coordinates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_historical_arrays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_geometry_assembler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figure_size</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="n">plotON</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Generates the geometry assemble of the substrate if integrated Atomic Chip (IAC).</span>

<span class="sd">            sets the image to give to the wavefront light modulator for generating the patterns for</span>
<span class="sd">            the array of optical tweezers.</span>

<span class="sd">            plotON (bool) : boolean for plotting or not.</span>
<span class="sd">            cmap (str) : matplotlib color map of the showed figure of the substrate</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">_substrate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_substrate_size</span><span class="p">)</span>

        <span class="n">site_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_site</span>

        <span class="c1">#substitute the site generate for the IAC in the respectivatly coordinate of the image.</span>
        <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geometry</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;=</span><span class="bp">self</span><span class="o">.</span><span class="n">_array_params</span><span class="p">[</span><span class="s1">&#39;full mesh&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span> 
                <span class="k">if</span> <span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;=</span><span class="bp">self</span><span class="o">.</span><span class="n">_array_params</span><span class="p">[</span><span class="s1">&#39;full mesh&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                    
                    <span class="n">_x</span><span class="p">,</span> <span class="n">_y</span> <span class="o">=</span> <span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>            
                    <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span> <span class="o">=</span> <span class="n">site_path</span><span class="o">.</span><span class="n">shape</span>
                    <span class="n">cx</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">cx</span><span class="p">)</span> <span class="p">;</span> <span class="n">cy</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">cy</span><span class="p">);</span>
                    
                    <span class="n">_substrate</span><span class="p">[</span> <span class="nb">int</span><span class="p">(</span><span class="n">_y</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="n">cy</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="n">_y</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="n">cy</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">_x</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="n">cx</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="n">_x</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="n">cx</span><span class="p">)]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_site</span>
                    
        <span class="bp">self</span><span class="o">.</span><span class="n">_substrate</span> <span class="o">=</span> <span class="n">_substrate</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_qudit_map</span><span class="p">()</span> <span class="c1">#set the qudit map with the coordinates of each qubit</span>

        <span class="k">if</span> <span class="n">plotON</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">showSubstrate</span><span class="p">(</span><span class="n">figure_size</span><span class="o">=</span> <span class="n">figure_size</span><span class="p">,</span> <span class="n">color_map</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">combine_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coordinates_A</span><span class="p">,</span> <span class="n">coordinates_B</span><span class="p">):</span>

        <span class="n">combined_array</span> <span class="o">=</span> <span class="n">coordinates_A</span><span class="o">+</span><span class="n">coordinates_B</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_geometry</span> <span class="o">=</span> <span class="n">combined_array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_historical_arrays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">combined_array</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_qregister</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qregisters</span><span class="p">:</span><span class="nb">dict</span><span class="p">,</span> <span class="n">center_frequency</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">center_position</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Set the quantum registers with their index and the coordinates from the geometry. It does</span>
<span class="sd">            require to have set a qudit map with _set_qudit_map().</span>

<span class="sd">            qregisters (dict) : dictionary containing the qregister number and a list of indexes, link</span>
<span class="sd">                                to the indexes from the coordinates of the geometry. e.g., {&#39;qr0&#39;: [0, 3, 4], ...}</span>

<span class="sd">            Returns:</span>

<span class="sd">            A dictionary with indexes and coordinates. e.g., {&#39;qr0&#39;: [ [index 1, index 2, ...], [coordinate 1, coordinate 2, ...] ], }</span>
<span class="sd">        &#39;&#39;&#39;</span>


        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">qregisters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># print(key, val)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_qregisters</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_geometry</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">val</span><span class="p">]</span> <span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_nr_of_registers</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">qregisters</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_qudit_map</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">center_frequency</span><span class="o">!=</span><span class="kc">None</span> <span class="ow">and</span> <span class="n">resolution</span><span class="o">!=</span><span class="kc">None</span> <span class="ow">and</span> <span class="n">center_position</span><span class="o">!=</span><span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_freq_map</span><span class="p">(</span> <span class="n">center_frequency</span><span class="p">,</span> <span class="n">center_position</span><span class="p">,</span> <span class="n">resolution</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_qudit_map</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Set the qudit map with the assigned coordinate to the correspondant qubit label.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_nr_of_qudits</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_geometry</span><span class="p">)</span>        
        
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nr_of_qudits</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_qudit_map</span><span class="p">[</span><span class="s1">&#39;q_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">_</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geometry</span><span class="p">[</span><span class="n">_</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">set_freq_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">center_frequency</span><span class="p">,</span> <span class="n">center_position</span><span class="p">,</span> <span class="n">resolution</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Function to transform from the position coordinates to frequency map coordinates</span>

<span class="sd">            center_frequency (tuple) : horizontal (X) and vertical (Y) origin/reference points</span>
<span class="sd">            resolution (tuple) : position and frequency resolution if 1 element is given then is given in </span>
<span class="sd">                                units of px/MHz or similar units, if two are given, then the ratio is cal-</span>
<span class="sd">                                culated (1px, 0.5MHz)-&gt; 0.5MHz/px resolution</span>
<span class="sd">            centerposition (tuple) : </span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_center_frequency</span> <span class="o">=</span> <span class="n">center_frequency</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_center_position</span> <span class="o">=</span> <span class="n">center_position</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">resolution</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_resolution_f</span> <span class="o">=</span> <span class="n">resolution</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_resolution_r</span> <span class="o">=</span> <span class="n">resolution</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_resolution</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolution_f</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">_resolution_r</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_resolution</span> <span class="o">=</span> <span class="n">resolution</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>


        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nr_of_registers</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_qudit_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

                <span class="n">_xposition_reg_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rint</span><span class="p">(</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_qudit_map</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_center_position</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_resolution</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_center_frequency</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_resolution_f</span><span class="p">)</span> <span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_resolution_f</span><span class="p">)</span>
                <span class="n">_yposition_reg_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rint</span><span class="p">(</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_qudit_map</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_center_position</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_resolution</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_center_frequency</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_resolution_f</span><span class="p">)</span> <span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_resolution_f</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_qudit_map</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;positions [px]&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_qudit_map</span><span class="p">[</span><span class="n">key</span><span class="p">]),</span> <span class="s1">&#39;frequencies&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">_xposition_reg_i</span><span class="p">,</span> <span class="n">_yposition_reg_i</span><span class="p">]}</span>

    <span class="k">def</span> <span class="nf">get_freq_qreg_map</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">_map</span> <span class="o">=</span><span class="s1">&#39;frequencies&#39;</span>

        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_qudit_map</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">_map</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">vals</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_qudit_map</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>

    <span class="k">def</span> <span class="nf">get_pos_qreg_map</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">_map</span> <span class="o">=</span><span class="s1">&#39;positions [px]&#39;</span>
        
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_qudit_map</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">_map</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">vals</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_qudit_map</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>

    <span class="k">def</span> <span class="nf">showCoordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figure_size</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">)):</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figure_size</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geometry</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">facecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">linewidths</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Integrated Atomic Circuit (geometry)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;dimension X&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;dimension Y&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span> 

    <span class="k">def</span> <span class="nf">showSubstrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figure_size</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="n">color_map</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_cmap</span> <span class="o">=</span> <span class="n">color_map</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figure_size</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_substrate</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">color_map</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Integrated Atomic Circuit (substrate)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;dimension X&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;dimension Y&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>            

    <span class="k">def</span> <span class="nf">showSite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figure_size</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="n">DPI</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">color_map</span><span class="o">=</span><span class="s1">&#39;bone&#39;</span><span class="p">):</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figure_size</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">DPI</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_site</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">color_map</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Tweezer site (substrate)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;dimension X&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;dimension Y&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span> 

    <span class="k">def</span> <span class="nf">get_GIF</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">temp_fname</span><span class="p">,</span> <span class="n">frames</span><span class="p">,</span> <span class="n">mesh_dim</span><span class="p">,</span> <span class="n">DPI</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">figure_size</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="n">color_map</span><span class="o">=</span><span class="s1">&#39;bone&#39;</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;xlabel&#39;</span><span class="p">:</span> <span class="s1">&#39;Dimension X [pixel]&#39;</span><span class="p">,</span> <span class="s1">&#39;ylabel&#39;</span><span class="p">:</span> <span class="s1">&#39;Dimension Y [pixel]&#39;</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Drag movements&#39;</span><span class="p">},</span> <span class="n">duration</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="n">images</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_arbitrary_array</span><span class="p">(</span><span class="n">frames</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">mesh_dim</span><span class="o">=</span><span class="n">mesh_dim</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_geometry_assembler</span><span class="p">(</span><span class="n">plotON</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> 
            
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figure_size</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">DPI</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">noise</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">noisify</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_substrate</span><span class="p">,</span><span class="mi">180</span><span class="p">),</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">color_map</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_substrate</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">color_map</span><span class="p">)</span>

                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="s1">&#39;xlabel&#39;</span><span class="p">])</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="s1">&#39;ylabel&#39;</span><span class="p">])</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">])</span>

                <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">temp_fname</span><span class="p">)</span>
                
                <span class="n">image</span> <span class="o">=</span> <span class="n">imageio</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">temp_fname</span><span class="p">)</span>
                <span class="n">images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>

        <span class="n">imageio</span><span class="o">.</span><span class="n">mimsave</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="n">duration</span><span class="p">,</span> <span class="n">loop</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1">#generate a target configuration as a k x j grid</span>
    <span class="k">def</span> <span class="nf">generate_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">x_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">IMAGE_SIZE</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
        <span class="n">y_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">IMAGE_SIZE</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
        <span class="n">target_positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x_coords</span><span class="p">,</span> <span class="n">y_coords</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">target_positions</span>

    <span class="c1">#function for assigning each agent to the optimal target based on distance distribution</span>
    <span class="k">def</span> <span class="nf">assign_targets_optimal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial_positions</span><span class="p">,</span> <span class="n">target_positions</span><span class="p">):</span>
        
        <span class="c1">#compute distance matrix (agents x target positions)</span>
        <span class="n">distance_matrix</span> <span class="o">=</span> <span class="n">cdist</span><span class="p">(</span><span class="n">initial_positions</span><span class="p">,</span> <span class="n">target_positions</span><span class="p">)</span>
        
        <span class="c1">#solve the assignment problem to minimize the total distance</span>
        <span class="n">row_ind</span><span class="p">,</span> <span class="n">col_ind</span> <span class="o">=</span> <span class="n">linear_sum_assignment</span><span class="p">(</span><span class="n">distance_matrix</span><span class="p">)</span>
        
        <span class="c1">#yields assigned target positions for each agent</span>
        <span class="n">assigned_targets</span> <span class="o">=</span> <span class="n">target_positions</span><span class="p">[</span><span class="n">col_ind</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">assigned_targets</span>

    <span class="k">def</span> <span class="nf">optimize_agent_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial_positions</span><span class="p">,</span><span class="n">assigned_targets</span><span class="p">,</span><span class="n">NUM_AGENTS</span><span class="p">,</span><span class="n">CONVERGENCE_THRESHOLD</span><span class="p">,</span><span class="n">MAX_STEP_SIZE</span><span class="p">,</span><span class="n">COLLISION_DISTANCE</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Optimizes the positions of agents towards their assigned targets with collision avoidance.</span>

<span class="sd">            INPUTS:</span>
<span class="sd">            ------</span>
<span class="sd">            initial_positions (np.ndarray): Initial positions of agents.</span>
<span class="sd">            assigned_targets (np.ndarray): Target positions assigned to agents.</span>
<span class="sd">            NUM_AGENTS (int): Number of agents.</span>
<span class="sd">            CONVERGENCE_THRESHOLD (float): Distance threshold to consider an agent has reached its target.</span>
<span class="sd">            MAX_STEP_SIZE (float): Maximum step size an agent can move in one iteration.</span>
<span class="sd">            COLLISION_DISTANCE (float): Minimum allowable distance between agents to avoid collisions.</span>

<span class="sd">            OUTPUT:</span>
<span class="sd">            ------</span>
<span class="sd">            list: A list of position arrays for each generation.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#check if each agent has reached its target</span>
        <span class="n">converged_agents</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NUM_AGENTS</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>

        <span class="c1">#initialize arrays to store positions for each generation</span>
        <span class="n">positions_per_generation</span> <span class="o">=</span> <span class="p">[</span><span class="n">initial_positions</span><span class="o">.</span><span class="n">copy</span><span class="p">()]</span>

        <span class="c1">#optimization loop: move agents towards assigned targets with limited step size and collision avoidance</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">converged_agents</span><span class="p">):</span>
            <span class="n">current_positions</span> <span class="o">=</span> <span class="n">positions_per_generation</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NUM_AGENTS</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">converged_agents</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="c1">#compute distance and direction to target</span>
                    <span class="n">distance_to_target</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">assigned_targets</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">current_positions</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

                    <span class="c1">#check if the agent has reached its target</span>
                    <span class="k">if</span> <span class="n">distance_to_target</span> <span class="o">&lt;</span> <span class="n">CONVERGENCE_THRESHOLD</span><span class="p">:</span>
                        <span class="n">converged_agents</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">continue</span>

                    <span class="c1">#move towards the target with limited step size</span>
                    <span class="n">direction</span> <span class="o">=</span> <span class="p">(</span><span class="n">assigned_targets</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">current_positions</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">distance_to_target</span>
                    <span class="n">step</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">MAX_STEP_SIZE</span><span class="p">,</span> <span class="n">distance_to_target</span><span class="p">)</span>
                    <span class="n">new_position</span> <span class="o">=</span> <span class="n">current_positions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">direction</span> <span class="o">*</span> <span class="n">step</span>

                    <span class="c1">#check for collisions with other agents</span>
                    <span class="k">for</span> <span class="n">j_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NUM_AGENTS</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j_idx</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">converged_agents</span><span class="p">[</span><span class="n">j_idx</span><span class="p">]:</span>
                            <span class="c1">#calculate distance to the other agent</span>
                            <span class="n">distance_to_other</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">new_position</span> <span class="o">-</span> <span class="n">current_positions</span><span class="p">[</span><span class="n">j_idx</span><span class="p">])</span>
                            <span class="k">if</span> <span class="n">distance_to_other</span> <span class="o">&lt;</span> <span class="n">COLLISION_DISTANCE</span><span class="p">:</span>
                                <span class="c1">#adjust movement to avoid collision</span>
                                <span class="n">direction_to_other</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_positions</span><span class="p">[</span><span class="n">j_idx</span><span class="p">]</span> <span class="o">-</span> <span class="n">current_positions</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">distance_to_other</span>
                                <span class="n">avoidance_step</span> <span class="o">=</span> <span class="p">(</span><span class="n">COLLISION_DISTANCE</span> <span class="o">-</span> <span class="n">distance_to_other</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
                                <span class="n">new_position</span> <span class="o">-=</span> <span class="n">direction_to_other</span> <span class="o">*</span> <span class="n">avoidance_step</span>

                    <span class="c1">#update the agent&#39;s position</span>
                    <span class="n">current_positions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_position</span>

            <span class="c1">#store new positions for this generation</span>
            <span class="n">positions_per_generation</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_positions</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">positions_per_generation</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame_tuple</span><span class="p">):</span>
        <span class="n">frame_num</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">frame_tuple</span>
        <span class="n">ax_move</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">ax_dist</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="c1">#tracks </span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NUM_AGENTS</span><span class="p">):</span>
            <span class="n">track</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tracks</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="n">frame_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">ax_move</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">track</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">track</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

        <span class="c1">#initial and target positions</span>
        <span class="n">ax_move</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">target_positions</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">target_positions</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Target Positions&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">ax_move</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">frame</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">frame</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Moving Agents&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">ax_move</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">IMAGE_SIZE</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="n">ax_move</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">IMAGE_SIZE</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">ax_move</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
        <span class="n">ax_move</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Agents Moving with Optimal Target Assignment (Frame </span><span class="si">{</span><span class="n">frame_num</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>

        <span class="c1">#cummulative distances</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NUM_AGENTS</span><span class="p">):</span>
            <span class="n">ax_dist</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">frame_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">cumulative_distances</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="n">frame_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
                         <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Agent </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

        <span class="n">ax_dist</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Distance Traveled vs Frame # for Each Agent&#39;</span><span class="p">)</span>
        <span class="n">ax_dist</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frame #&#39;</span><span class="p">)</span>
        <span class="n">ax_dist</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Distance Traveled&#39;</span><span class="p">)</span>
        <span class="n">ax_dist</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>

    <span class="c1">#track positions and cumulative distances</span>
    <span class="k">def</span> <span class="nf">track_agent_movements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">positions_per_generation</span><span class="p">,</span> <span class="n">NUM_AGENTS</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Tracks the movements of agents across generations and calculates cumulative distances.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        positions_per_generation (list): List of position arrays for each generation.</span>
<span class="sd">        NUM_AGENTS (int): Number of agents.</span>

<span class="sd">        Returns:</span>
<span class="sd">        tuple: A list of tracks for each agent and a numpy array of cumulative distances.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#initialize tracks and cumulative distances</span>
        <span class="n">tracks</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NUM_AGENTS</span><span class="p">)]</span>
        <span class="n">cumulative_distances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">NUM_AGENTS</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">positions_per_generation</span><span class="p">)))</span>

        <span class="c1">#iterate over each generation of positions</span>
        <span class="k">for</span> <span class="n">frame_num</span><span class="p">,</span> <span class="n">frame</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">positions_per_generation</span><span class="p">):</span>
            <span class="c1">#calculate distances from the previous frame</span>
            <span class="k">if</span> <span class="n">frame_num</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">distances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">frame</span> <span class="o">-</span> <span class="n">positions_per_generation</span><span class="p">[</span><span class="n">frame_num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">cumulative_distances</span><span class="p">[:,</span> <span class="n">frame_num</span><span class="p">]</span> <span class="o">=</span> <span class="n">cumulative_distances</span><span class="p">[:,</span> <span class="n">frame_num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">distances</span>
            <span class="c1">#append positions to tracks</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NUM_AGENTS</span><span class="p">):</span>
                <span class="n">tracks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frame</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">tracks</span><span class="p">,</span> <span class="n">cumulative_distances</span>


<span class="c1">#####################################################################################################</span>
<span class="c1">#Grid AQiPT class</span>
<span class="c1">#####################################################################################################</span>
<span class="k">class</span> <span class="nc">Grid</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A class representing a grid for managing coordinates, amplitudes, frequencies, phases, and configurations.</span>

<span class="sd">    Attributes:</span>

<span class="sd">        grid_type (str) : </span>
<span class="sd">        _nrLines (int) : The number of lines in the grid.</span>
<span class="sd">        _resolution (float) : </span>
<span class="sd">        _dimensions (tuple) : </span>
<span class="sd">        _coordinates (dict) : </span>
<span class="sd">        _amplitudes (None) : The amplitudes of the grid points.</span>
<span class="sd">        _frequencies (None) : The frequencies of the grid points.</span>
<span class="sd">        _phases (None) : The phases of the grid points.</span>
<span class="sd">        _sequenceSweeps (None) : The sequence of sweeps for each grid point.</span>
<span class="sd">        initialConfiguration (None) : The initial configuration of the grid.</span>
<span class="sd">        finalConfiguration (None) : The final configuration of the grid.</span>
<span class="sd">        currentConfiguration (None) : The current configuration of the grid.</span>
<span class="sd">    </span>
<span class="sd">    Methods:</span>

<span class="sd">        _mapper :</span>
<span class="sd">        showMap :</span>
<span class="sd">        get_amplitudes :</span>
<span class="sd">        get_coordinates :</span>
<span class="sd">        get_frequencies :</span>
<span class="sd">        get_phases :</span>
<span class="sd">        get_nrLines :</span>
<span class="sd">        get_sequenceSweeps :</span>
<span class="sd">        get_initialConfiguration :</span>
<span class="sd">        get_currentConfiguration :</span>
<span class="sd">        get_finalConfiguration :</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid_type</span><span class="o">=</span><span class="s1">&#39;square&#39;</span><span class="p">,</span> <span class="n">nr_Lines</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Initialize a Grid object with default attributes.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_type</span> <span class="o">=</span> <span class="n">grid_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nrLines</span> <span class="o">=</span> <span class="n">nr_Lines</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_resolution</span> <span class="o">=</span> <span class="n">resolution</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_type</span><span class="o">==</span><span class="s1">&#39;square&#39;</span><span class="p">:</span> 

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nrLines</span><span class="o">%</span><span class="mi">2</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_dimensions</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nrLines</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nrLines</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_nrLines</span> <span class="o">=</span> <span class="n">nr_Lines</span><span class="o">+</span><span class="mi">1</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Only odd numbers of devices/lines&#39;</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_dimensions</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nrLines</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nrLines</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_coordinates</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;frequency_map&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dimensions</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">),</span>
                                 <span class="s1">&#39;phase_map&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dimensions</span><span class="p">),</span>
                                 <span class="s1">&#39;amplitude_map&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dimensions</span><span class="p">),</span>
                                 <span class="s1">&#39;sweep_map&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dimensions</span><span class="p">),</span>
                                 <span class="s1">&#39;position&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dimensions</span><span class="p">)}</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolution</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mapper</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mapper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_resolution</span><span class="p">)</span>


        <span class="k">elif</span> <span class="n">grid_type</span><span class="o">==</span><span class="s1">&#39;rectangular&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Not implemented, sorry&#39;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">grid_type</span><span class="o">==</span><span class="s1">&#39;Hexagonal&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Not implemented, sorry&#39;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">grid_type</span><span class="o">==</span><span class="s1">&#39;Triangular&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Not implemented, sorry&#39;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">grid_type</span><span class="o">==</span><span class="s1">&#39;Arbitrary&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Not implemented, sorry&#39;</span><span class="p">)</span>

        <span class="c1"># deprecated (?)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_amplitudes</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_frequencies</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_phases</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sequenceSweeps</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialConfiguration</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finalConfiguration</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currentConfiguration</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_mapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mf">0.5e6</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Mapper to define the grid that works as LUT mapping the indexes with the frequencies [MHz]</span>
<span class="sd">            for each position with index (x,y).</span>

<span class="sd">            resolution (float) : frequency spacing [MHz] between sites 3.5um &lt;--&gt; 0.5MHz</span>

<span class="sd">            Note: all the maps are stored in self._coordinates e.g., frequency, phase, amplitude, sweep and positions</span>

<span class="sd">            TODO: other maps, only frequency map has been made</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="o">=</span> <span class="n">resolution</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_type</span> <span class="o">==</span> <span class="s1">&#39;square&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">x_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nrLines</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">y_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_nrLines</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_coordinates</span><span class="p">[</span><span class="s1">&#39;frequency_map&#39;</span><span class="p">][</span><span class="n">mt</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nrLines</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">y_idx</span><span class="p">,</span> <span class="n">x_idx</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="o">*</span><span class="n">y_idx</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_coordinates</span><span class="p">[</span><span class="s1">&#39;frequency_map&#39;</span><span class="p">][</span><span class="n">mt</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nrLines</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">y_idx</span><span class="p">,</span> <span class="n">x_idx</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coordinates</span><span class="p">[</span><span class="s1">&#39;frequency_map&#39;</span><span class="p">][</span><span class="n">mt</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nrLines</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">y_idx</span><span class="p">,</span> <span class="n">x_idx</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">showMap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typeMap</span><span class="o">=</span><span class="s1">&#39;frequency&#39;</span><span class="p">,</span> <span class="n">fig_size</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span> <span class="n">fig_dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">colomarp</span><span class="o">=</span><span class="s1">&#39;bone&#39;</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Maps plotter, it does show the map correspondency used for configuring oscillators (i.e., NCOs)</span>

<span class="sd">            typeMap (str) : define which maps are shown</span>
<span class="sd">            fig_size (tuple) : size of the figure</span>
<span class="sd">            fig_dpi (int) : value of the density of pixel per inch in the figure</span>
<span class="sd">            labels (bool) : if sites values are shown</span>
<span class="sd">            colormap (str) : colormap for showing the plot</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">typeMap</span><span class="o">==</span><span class="s1">&#39;frequency&#39;</span><span class="p">:</span>

            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">fig_size</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">fig_dpi</span><span class="p">)</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_coordinates</span><span class="p">[</span><span class="s1">&#39;frequency_map&#39;</span><span class="p">]),</span> <span class="n">cmap</span><span class="o">=</span><span class="n">colomarp</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_coordinates</span><span class="p">[</span><span class="s1">&#39;frequency_map&#39;</span><span class="p">])),</span> <span class="n">vmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_coordinates</span><span class="p">[</span><span class="s1">&#39;frequency_map&#39;</span><span class="p">])))</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_coordinates</span><span class="p">[</span><span class="s1">&#39;frequency_map&#39;</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">labels</span><span class="p">:</span>
                <span class="c1"># Add text annotations on top of each pixel</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="nb">str</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span> <span class="s1">&#39;</span><span class="si">{0:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span><span class="o">*</span><span class="mf">1e-6</span><span class="p">)</span><span class="o">+</span> <span class="s2">&quot;[MHz]&quot;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">),</span>
                                     <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                                     <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Line index x-axis&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Site index y-axis&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Frequency map&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">35</span><span class="p">)</span>
            <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Frequency [MHz]&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_amplitudes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get the amplitudes of the grid points.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: The list of amplitudes.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_amplitudes</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get the coordinates of the grid points.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: The list of coordinates.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coordinates</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_frequencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get the frequencies of the grid points.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: The list of frequencies.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frequencies</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_phases</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get the phases of the grid points.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: The list of phases.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phases</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_nrLines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get the number of lines in the grid.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: The number of lines.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nrLines</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_sequenceSweeps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get the sequence of sweeps for each grid point.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: The list of sweep sequences.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sequenceSweeps</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_initialConfiguration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get the initial configuration of the grid.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: The initial configuration.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialConfiguration</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_currentConfiguration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get the current configuration of the grid.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: The current configuration.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentConfiguration</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_finalConfiguration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get the final configuration of the grid.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: The final configuration.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">finalConfiguration</span>


<span class="c1">#####################################################################################################</span>
<span class="c1">#Sweep AQiPT class</span>
<span class="c1">#####################################################################################################</span>

<span class="k">class</span> <span class="nc">Sweep</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A class representing a sweep for configuring an instrument.</span>

<span class="sd">    Attributes:</span>

<span class="sd">        _initialConfiguration: The initial configuration before the sweep.</span>
<span class="sd">        _finalConfiguration: The final configuration after the sweep.</span>
<span class="sd">        _ampModulation: The amplitude modulation for the sweep.</span>
<span class="sd">        _freqModulation: The frequency modulation for the sweep.</span>
<span class="sd">        _phaseModulation: The phase modulation for the sweep.</span>
<span class="sd">        _calibration: The calibration data for the sweep.</span>

<span class="sd">    Methods:</span>

<span class="sd">        get_initialConfiguration ():</span>
<span class="sd">        get_finalConfiguration ():</span>
<span class="sd">        get_modulation ():</span>
<span class="sd">        get_calibration ():</span>
<span class="sd">        calibrate ():</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial_config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">final_config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">calibration</span><span class="o">=</span><span class="mf">3.5e-6</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Initialize a Sweep object with default attributes.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initialConfiguration</span> <span class="o">=</span> <span class="n">initial_config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_finalConfiguration</span> <span class="o">=</span> <span class="n">final_config</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_sweepTime</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sweepTbase</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_ampModulation</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_freqModulation</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_phaseModulation</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_calibration</span> <span class="o">=</span> <span class="n">calibration</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_initialConfiguration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get the initial configuration before the sweep.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Any: The initial configuration.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialConfiguration</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_finalConfiguration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get the final configuration after the sweep.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Any: The final configuration.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_finalConfiguration</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_modulation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get the modulation parameters for the sweep.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: The modulation parameters (amplitude, frequency, phase).</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;amplitude&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ampModulation</span><span class="p">,</span> <span class="s1">&#39;frequency&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_freqModulation</span><span class="p">,</span> <span class="s1">&#39;phase&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phaseModulation</span><span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_calibration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get the calibration data for the sweep.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Any: The calibration data.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calibration</span>

    <span class="k">def</span> <span class="nf">calibrate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Perform calibration for the sweep.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">pass</span>

<span class="k">class</span> <span class="nc">quadratic_sweep</span><span class="p">(</span><span class="n">Sweep</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Quadratic sweep subclass</span>

<span class="sd">        Attributes:</span>

<span class="sd">            _coef (list): List of coefficients for the parabolic sweep</span>
<span class="sd">            amp_function (): Amplitude python function for the sweep in the Amplitude parameter</span>
<span class="sd">            freq_function (): Frequency python function for the sweep in the Frequency parameter</span>
<span class="sd">            phase_function (): Phase python function for the sweep in the Phase parameter</span>
<span class="sd">            _sweep (): Full sweep</span>

<span class="sd">        Methods:</span>
<span class="sd">            </span>
<span class="sd">            _set_sweep () :</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coef</span><span class="p">,</span> <span class="n">sweep_steps</span><span class="o">=</span><span class="mf">1e3</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">);</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_coef</span> <span class="o">=</span> <span class="n">coef</span><span class="p">;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">amp_function</span> <span class="o">=</span> <span class="n">constant</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freq_function</span> <span class="o">=</span> <span class="n">xquare</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase_function</span> <span class="o">=</span> <span class="n">constant</span><span class="p">;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_sweep</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sweepSteps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sweep_steps</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_sweep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_sweepTime</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_coef</span><span class="p">[</span><span class="s1">&#39;frequency&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coef</span><span class="p">[</span><span class="s1">&#39;frequency&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">4</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_coef</span><span class="p">[</span><span class="s1">&#39;frequency&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_coef</span><span class="p">[</span><span class="s1">&#39;frequency&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]))</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_coef</span><span class="p">[</span><span class="s1">&#39;frequency&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sweepTbase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sweepTime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sweepSteps</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_ampModulation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">amp_function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sweepTbase</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coef</span><span class="p">[</span><span class="s1">&#39;amplitude&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_freqModulation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sweepTbase</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coef</span><span class="p">[</span><span class="s1">&#39;frequency&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_phaseModulation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase_function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sweepTbase</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coef</span><span class="p">[</span><span class="s1">&#39;phase&#39;</span><span class="p">])</span>

        <span class="c1"># return _amplitude*np.sin(2*np.pi*_frequency + _phase)</span>

    <span class="k">def</span> <span class="nf">showSweep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">15</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ampModulation</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;dodgerblue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Amplitude [V]&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_freqModulation</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency [MHz]&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

        <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_phaseModulation</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Phase [º]&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

        <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Time [$\mu$s]&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">title</span><span class="o">!=</span><span class="kc">None</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="c1">#####################################################################################################</span>
<span class="c1">#NCO AQiPT class</span>
<span class="c1">#####################################################################################################</span>
<span class="k">class</span> <span class="nc">NCO</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A Numerically Controlled Oscillator (NCO) representing a tone generator.</span>

<span class="sd">    Attributes:</span>

<span class="sd">        number (int): The identifier number of the NCO.</span>
<span class="sd">        frequency (float): The frequency of the generated tone.</span>
<span class="sd">        phase (float): The phase of the generated tone.</span>
<span class="sd">        amplitude (float): The amplitude of the generated tone.</span>
<span class="sd">        sweep_type (str): The type of sweep for frequency modulation.</span>
<span class="sd">        sweep (tuple): The parameters for frequency sweep (start, end, step).</span>
<span class="sd">        busy (bool): Indicates whether the NCO is currently in use.</span>

<span class="sd">    Methods:</span>

<span class="sd">        set_configuration ():</span>
<span class="sd">        update_attribute ():</span>
<span class="sd">        release ():</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">frequency</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">amplitude</span><span class="p">,</span> <span class="n">sweep_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sweep_params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Initialize an NCO object with specified attributes.</span>

<span class="sd">        Args:</span>
<span class="sd">            number (int): The identifier number of the NCO.</span>
<span class="sd">            frequency (float): The frequency of the generated tone.</span>
<span class="sd">            phase (float): The phase of the generated tone.</span>
<span class="sd">            amplitude (float): The amplitude of the generated tone.</span>
<span class="sd">            sweep_type (str, optional): The type of sweep for frequency modulation.</span>
<span class="sd">            sweep (tuple, optional): The parameters for frequency sweep (start, end, step).</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number</span> <span class="o">=</span> <span class="n">number</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">=</span> <span class="n">frequency</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">phase</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">amplitude</span> <span class="o">=</span> <span class="n">amplitude</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span> <span class="o">=</span> <span class="n">sweep_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sweep_params</span> <span class="o">=</span> <span class="n">sweep_params</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sweep_params</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sweep_params</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sweep</span> <span class="o">=</span> <span class="n">quadratic_sweep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sweep_params</span><span class="p">)</span> 
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">busy</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">set_configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sweep_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sweep</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set the configuration attributes of the NCO.</span>

<span class="sd">        Args:</span>
<span class="sd">            frequency (float, optional): The frequency of the generated tone.</span>
<span class="sd">            phase (float, optional): The phase of the generated tone.</span>
<span class="sd">            amplitude (float, optional): The amplitude of the generated tone.</span>
<span class="sd">            sweep_type (str, optional): The type of sweep for frequency modulation.</span>
<span class="sd">            sweep (tuple, optional): The parameters for frequency sweep (start, end, step).</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">frequency</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">=</span> <span class="n">frequency</span>
        <span class="k">if</span> <span class="n">phase</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">phase</span>
        <span class="k">if</span> <span class="n">amplitude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">amplitude</span> <span class="o">=</span> <span class="n">amplitude</span>
        <span class="k">if</span> <span class="n">sweep_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sweep_type</span> <span class="o">=</span> <span class="n">sweep_type</span>
        <span class="k">if</span> <span class="n">sweep</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sweep</span> <span class="o">=</span> <span class="n">sweep</span>

    <span class="k">def</span> <span class="nf">update_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Update a specific attribute of the NCO.</span>

<span class="sd">        Args:</span>
<span class="sd">            attribute (str): The name of the attribute to update.</span>
<span class="sd">            value: The new value of the attribute.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute</span><span class="p">):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;NCO has no attribute &#39;</span><span class="si">{</span><span class="n">attribute</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">release</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Release the NCO, marking it as not in use.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">busy</span> <span class="o">=</span> <span class="kc">False</span>


<span class="k">class</span> <span class="nc">Device</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A device containing multiple Numerically Controlled Oscillators (NCOs) for tone generation.</span>

<span class="sd">    Attributes:</span>

<span class="sd">        device_id (int) : The identifier number of the device.</span>
<span class="sd">        _num_ncos () : Number of NCOs in the device</span>
<span class="sd">        nco_pool (list) : The pool of NCOs belonging to the device.</span>
<span class="sd">        initial_frequency (): Initial value of the frequency</span>
<span class="sd">        initial_amplitude (): Inital value of the Amplitude</span>
<span class="sd">        initial_phase (): Initial value of the phase</span>
<span class="sd">        initial_configuration (dict) : The initial configuration of NCOs in the device.</span>

<span class="sd">    Methods:</span>

<span class="sd">        get_available_nco () : Retrieve the fist available NCO following index sorting</span>
<span class="sd">        get_available_ncos () : Retrieve a list of available NCOs</span>
<span class="sd">        release_nco () : Release NCO. i.e., change busy status from True to False</span>
<span class="sd">        flush () : Reset sweep schedule of NCOs</span>
<span class="sd">        execute () : Execute NCOs sweeps</span>
<span class="sd">        queue () : Add to scheduler NCO&#39;s sweeps</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device_id</span><span class="p">,</span> <span class="n">num_nco</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">initial_frequency</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">initial_phase</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">initial_amplitude</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Initialize a Device object with specified attributes.</span>

<span class="sd">        Args:</span>
<span class="sd">            device_id (int): The identifier number of the device.</span>
<span class="sd">            num_nco (int, optional): The number of NCOs in the device. Default is 64.</span>
<span class="sd">            initial_frequency (float, optional): The initial frequency for NCOs. Default is 1000.</span>
<span class="sd">            initial_phase (float, optional): The initial phase for NCOs. Default is 0.</span>
<span class="sd">            initial_amplitude (float, optional): The initial amplitude for NCOs. Default is 1.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_device_id</span> <span class="o">=</span> <span class="n">device_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_num_ncos</span> <span class="o">=</span> <span class="n">num_nco</span>

        <span class="k">if</span> <span class="n">initial_frequency</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initial_frequency</span> <span class="o">=</span> <span class="n">INITIAL_FREQUENCY_NCOS</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_ncos</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initial_frequency</span> <span class="o">=</span> <span class="n">initial_frequency</span>

        <span class="k">if</span> <span class="n">initial_amplitude</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initial_amplitude</span> <span class="o">=</span> <span class="n">INITIAL_AMPLITUDE_NCOS</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_ncos</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initial_amplitude</span> <span class="o">=</span> <span class="n">initial_amplitude</span>

        <span class="k">if</span> <span class="n">initial_phase</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initial_phase</span> <span class="o">=</span> <span class="n">INITIAL_PHASE_NCOS</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_ncos</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initial_phase</span> <span class="o">=</span> <span class="n">initial_phase</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nco_pool</span> <span class="o">=</span> <span class="p">[</span><span class="n">NCO</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_frequency</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_phase</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_amplitude</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_ncos</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_configuration</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;frequency&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_frequency</span><span class="p">,</span> <span class="s1">&#39;phase&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_phase</span><span class="p">,</span> <span class="s1">&#39;amplitude&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_amplitude</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">get_available_nco</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get an available NCO from the device&#39;s pool.</span>

<span class="sd">        Returns:</span>
<span class="sd">            NCO: An available NCO object, or None if all NCOs are busy.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">nco</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nco_pool</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">nco</span><span class="o">.</span><span class="n">busy</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">nco</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">get_available_ncos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get an available NCO from the device&#39;s pool.</span>

<span class="sd">        Returns:</span>
<span class="sd">            NCO: An available NCO object, or None if all NCOs are busy.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">_dNCOs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">nco</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nco_pool</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">nco</span><span class="o">.</span><span class="n">busy</span><span class="p">:</span>
                <span class="n">_dNCOs</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">_dNCOs</span>

    <span class="k">def</span> <span class="nf">release_nco</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nco_number</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Release an NCO back to the pool based on its number.</span>

<span class="sd">        Args:</span>
<span class="sd">            nco_number (int): The number of the NCO to release.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">nco</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nco_pool</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nco</span><span class="o">.</span><span class="n">number</span> <span class="o">==</span> <span class="n">nco_number</span><span class="p">:</span>
                <span class="n">nco</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">flush</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Reset all NCOs in the device to their initial configuration.&#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">nco</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nco_pool</span><span class="p">:</span>
            <span class="n">nco</span><span class="o">.</span><span class="n">set_configuration</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_configuration</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">queue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>





<span class="c1">#####################################################################################################</span>
<span class="c1">#Experiment AQiPT class</span>
<span class="c1">#####################################################################################################</span>

<span class="k">def</span> <span class="nf">extract_tracks</span><span class="p">(</span><span class="n">waveformLST</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        INPUT: </span>
<span class="sd">        ------</span>
<span class="sd">            waveformLST (list) : list of AQiPT control module objects e.g., functions, pulses, tracks, sequences.</span>

<span class="sd">        OUTPUT:</span>
<span class="sd">        ------</span>
<span class="sd">            list of waveforms (AQiPT control object)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">waveformLST</span><span class="p">,</span> <span class="n">sequence</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">waveformLST</span><span class="o">.</span><span class="n">_Stack</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">waveformLST</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">wavef</span> <span class="k">for</span> <span class="n">wavef</span> <span class="ow">in</span> <span class="n">waveformLST</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wavef</span><span class="p">,</span> <span class="n">track</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wavef</span><span class="p">,</span> <span class="n">pulse</span><span class="p">)]</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Not possible to extract waveforms.&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">extract_sequences</span><span class="p">(</span><span class="n">waveformLST</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        INPUT: </span>
<span class="sd">        ------</span>
<span class="sd">            waveformLST (list) : list of AQiPT control module objects e.g., functions, pulses, tracks, sequences.</span>

<span class="sd">        OUTPUT:</span>
<span class="sd">        ------</span>
<span class="sd">            list of waveforms (AQiPT control object)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">wavef</span> <span class="k">for</span> <span class="n">wavef</span> <span class="ow">in</span> <span class="n">waveformLST</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wavef</span><span class="p">,</span> <span class="n">sequence</span><span class="p">)]</span>

<div class="viewcode-block" id="experiment">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.experiment">[docs]</a>
<span class="k">class</span> <span class="nc">experiment</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        A class for containing the general experiment: hardware, software(protocols), database, models, producers and</span>
<span class="sd">        metadata. Requires a pre-loaded director-object with the Hardware and Software specifications to match the</span>
<span class="sd">        experimental sequences (via JSON file or AQiPT formalism of waveforms) with physical hardware channels. </span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tbase : array_like</span>
<span class="sd">            Data for vector/matrix representation of the quantum object.</span>
<span class="sd">        res : list</span>
<span class="sd">            Dimensions of object used for tensor products.</span>
<span class="sd">        args : list</span>
<span class="sd">            Shape of underlying data structure (matrix shape).</span>

<span class="sd">        Methods</span>
<span class="sd">        -------</span>
<span class="sd">        function : array_like</span>
<span class="sd">            Sparse matrix characterizing the quantum object.</span>
<span class="sd">        function_plot : list</span>
<span class="sd">            List of dimensions keeping track of the tensor structure.</span>
<span class="sd">        step()</span>
<span class="sd">            Conjugate of quantum object.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">waveforms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hardware</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">director</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">operationMode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">producer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="si">:</span><span class="s2">%Y-%m-%d | %T</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>

        <span class="c1">#atributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_creation</span> <span class="o">=</span> <span class="n">date</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operationMode</span> <span class="o">=</span> <span class="n">operationMode</span><span class="p">;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_cmdMapperType</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cmdMapper</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cmdMapperFile</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span>

        <span class="k">if</span> <span class="n">director</span><span class="o">!=</span><span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="n">director</span><span class="o">.</span><span class="n">atom_specs</span><span class="p">;</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">producer</span><span class="o">!=</span><span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="n">producer</span><span class="o">.</span><span class="n">atom_specs</span><span class="p">;</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="n">atom</span><span class="p">;</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">director</span> <span class="o">=</span> <span class="n">director</span><span class="p">;</span>

        <span class="k">if</span> <span class="n">hardware</span><span class="o">!=</span><span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hardware</span> <span class="o">=</span> <span class="n">hardware</span><span class="p">;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hardware</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">director</span><span class="o">.</span><span class="n">_HW_specs</span><span class="p">;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">producer</span> <span class="o">=</span> <span class="n">producer</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="n">database</span><span class="p">;</span>



        <span class="k">if</span> <span class="n">waveforms</span><span class="o">!=</span><span class="kc">None</span> <span class="ow">and</span> <span class="n">director</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">waveforms</span> <span class="o">=</span> <span class="n">waveforms</span><span class="p">;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cmdMapperType</span> <span class="o">=</span> <span class="s1">&#39;WTYPE&#39;</span><span class="p">;</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operationMode</span><span class="o">==</span><span class="s1">&#39;sequence&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span> <span class="o">=</span> <span class="n">extract_sequences</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">waveforms</span><span class="p">);</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tracks</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operationMode</span><span class="o">==</span><span class="s1">&#39;track&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tracks</span> <span class="o">=</span> <span class="n">extract_tracks</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">waveforms</span><span class="p">);</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Incompatible operation mode, please choose: &#39;sequence&#39; or &#39;track&#39;.&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">waveforms</span><span class="o">==</span><span class="kc">None</span> <span class="ow">and</span> <span class="n">director</span><span class="o">!=</span><span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">waveforms</span> <span class="o">=</span> <span class="n">waveforms</span><span class="p">;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cmdMapperType</span> <span class="o">=</span> <span class="s1">&#39;FTYPE&#39;</span><span class="p">;</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operationMode</span><span class="o">==</span><span class="s1">&#39;sequence&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">director</span><span class="o">.</span><span class="n">_SW_specs</span><span class="o">.</span><span class="n">specifications</span><span class="p">[</span><span class="s1">&#39;sequences&#39;</span><span class="p">];</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tracks</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operationMode</span><span class="o">==</span><span class="s1">&#39;track&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tracks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">director</span><span class="o">.</span><span class="n">_SW_specs</span><span class="o">.</span><span class="n">specifications</span><span class="p">[</span><span class="s1">&#39;tracks&#39;</span><span class="p">];</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sequences</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Incompatible operation mode, please choose: &#39;sequence&#39; or &#39;track&#39;.&quot;</span><span class="p">)</span>


        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Ambiguity in giving waveforms and director simultaneously.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_executeIFexist</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">method_name</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">method_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)):</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">method_name</span><span class="p">)()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">method_name</span><span class="si">}</span><span class="s2"> is not a valid method of the class.&quot;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_assembler</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Assemble the primitive device commands located in the hardware list device with</span>
<span class="sd">            the argumentes given in the quantum assembly commands located in the software map.</span>
<span class="sd">            Returns a command+argument map with time-flag ready to be executed by execute()</span>
<span class="sd">            method.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">_scheduler</span> <span class="o">=</span> <span class="n">scheduler</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">);</span>

        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">director</span><span class="o">.</span><span class="n">_SWmap</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hardware</span><span class="o">.</span><span class="n">hardwareTypes</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">idx_dv</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hardware</span><span class="o">.</span><span class="n">hardwareLST</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">device</span><span class="p">)])):</span>
                    
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">_hex_hardware_id</span> <span class="o">=</span> <span class="n">aqipt</span><span class="o">.</span><span class="n">DFsearch</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">director</span><span class="o">.</span><span class="n">_HW_specs</span><span class="o">.</span><span class="n">_IDs_bench</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">director</span><span class="o">.</span><span class="n">_SWmap</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">instruction_realCH</span><span class="p">)[</span><span class="s1">&#39;python_memory_alloc&#39;</span><span class="p">][</span><span class="n">aqipt</span><span class="o">.</span><span class="n">DFsearch</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">director</span><span class="o">.</span><span class="n">_HW_specs</span><span class="o">.</span><span class="n">_IDs_bench</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">director</span><span class="o">.</span><span class="n">_SWmap</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">instruction_realCH</span><span class="p">)[</span><span class="s1">&#39;python_memory_alloc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> 
                        
                        <span class="k">if</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span> <span class="nb">int</span><span class="p">(</span><span class="n">_hex_hardware_id</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">py_object</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;EXT_CHANNEL&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hardware</span><span class="o">.</span><span class="n">hardwareLST</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">device</span><span class="p">)][</span><span class="n">idx_dv</span><span class="p">]</span><span class="o">.</span><span class="n">specs</span><span class="p">[</span><span class="s1">&#39;properties&#39;</span><span class="p">][</span><span class="s1">&#39;channels_IDs&#39;</span><span class="p">]:</span>
                            <span class="c1"># print(True, device, idx)</span>

                            <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hardware</span><span class="o">.</span><span class="n">hardwareLST</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">device</span><span class="p">)][</span><span class="n">idx_dv</span><span class="p">]</span><span class="o">.</span><span class="n">driver</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">director</span><span class="o">.</span><span class="n">_SWmap</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">command</span><span class="p">,</span> <span class="kc">None</span><span class="p">)):</span>
                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">director</span><span class="o">.</span><span class="n">_SWmap</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">instruction_type</span> <span class="o">==</span> <span class="s1">&#39;DIGITAL&#39;</span><span class="p">:</span>
                                    <span class="n">_scheduler</span><span class="o">.</span><span class="n">enterabs</span><span class="p">(</span><span class="n">time</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">director</span><span class="o">.</span><span class="n">_SWmap</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">instruction_timeflag</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hardware</span><span class="o">.</span><span class="n">hardwareLST</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">device</span><span class="p">)][</span><span class="n">idx_dv</span><span class="p">]</span><span class="o">.</span><span class="n">driver</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">director</span><span class="o">.</span><span class="n">_SWmap</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">command</span><span class="p">),</span> <span class="n">argument</span><span class="o">=</span><span class="p">(),</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{});</span>
                                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">director</span><span class="o">.</span><span class="n">_SWmap</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">instruction_type</span> <span class="o">==</span> <span class="s1">&#39;ANALOG&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">director</span><span class="o">.</span><span class="n">_SWmap</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">instruction_type</span> <span class="o">==</span> <span class="s1">&#39;ANALOGS&#39;</span><span class="p">:</span>
                                    <span class="n">_instruction_name</span> <span class="o">=</span> <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">director</span><span class="o">.</span><span class="n">_SWmap</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">instruction_name</span><span class="p">;</span>
                                    <span class="n">cmd_waveform</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">director</span><span class="o">.</span><span class="n">_SW_specs</span><span class="o">.</span><span class="n">specifications</span><span class="p">[</span><span class="s1">&#39;instructions&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">][</span><span class="n">_instruction_name</span><span class="p">][</span><span class="s1">&#39;WAVEFORM&#39;</span><span class="p">],</span> <span class="p">[]);</span>
                                    <span class="n">_scheduler</span><span class="o">.</span><span class="n">enterabs</span><span class="p">(</span><span class="n">time</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">director</span><span class="o">.</span><span class="n">_SWmap</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">instruction_timeflag</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hardware</span><span class="o">.</span><span class="n">hardwareLST</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">device</span><span class="p">)][</span><span class="n">idx_dv</span><span class="p">]</span><span class="o">.</span><span class="n">driver</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">director</span><span class="o">.</span><span class="n">_SWmap</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">command</span><span class="p">),</span> <span class="n">argument</span><span class="o">=</span><span class="p">(</span><span class="n">cmd_waveform</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">director</span><span class="o">.</span><span class="n">_SWmap</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">instruction_type</span><span class="p">),</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{});</span>
                                
                                <span class="c1"># print(&#39;time= &#39;,self.director._SWmap[idx].instruction_timeflag, &#39;priority=&#39;,1, &#39;action=&#39;,getattr(self.hardware.hardwareLST[str(device)][idx_dv].driver, self.director._SWmap[idx].command))</span>
                            <span class="c1"># _scheduler.enter(_executeIFexist(self.hardware.hardwareLST[str(device)][idx_dv].driver, self.director._SWmap[idx].command)) # maybe too slow by calling the exeIFexist</span>
                            <span class="c1"># print(&#39;here is the queue&#39;,_scheduler.queue)</span>

                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">pass</span>
        
        <span class="k">return</span> <span class="n">_scheduler</span>

<div class="viewcode-block" id="experiment.compile">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.experiment.compile">[docs]</a>
    <span class="k">def</span> <span class="nf">compile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Compile the quantum assembly primitives into the hardware by creating two mappers, one</span>
<span class="sd">            for the primitives that will serve as argument of the command list from the second mapper.</span>
<span class="sd">            This retrieve a pair command,argument after the </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">director</span><span class="o">.</span><span class="n">_mapperHW</span><span class="p">(</span><span class="n">hardware</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hardware</span><span class="p">);</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operationMode</span><span class="o">==</span><span class="s1">&#39;sequence&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">director</span><span class="o">.</span><span class="n">_mapperSW</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sequences</span><span class="p">);</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operationMode</span><span class="o">==</span><span class="s1">&#39;track&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">director</span><span class="o">.</span><span class="n">_mapperSW</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tracks</span><span class="p">);</span>

        <span class="c1">#pre-configuring the devices</span>


        <span class="c1">#compiling the command mapper as schedule object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cmdMapper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assembler</span><span class="p">();</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="experiment.recompile">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.experiment.recompile">[docs]</a>
    <span class="k">def</span> <span class="nf">recompile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">director</span><span class="o">.</span><span class="n">load_drivers</span><span class="p">();</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">director</span><span class="o">.</span><span class="n">load_HWspecs</span><span class="p">();</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compile</span><span class="p">();</span></div>


<div class="viewcode-block" id="experiment.execute">
<a class="viewcode-back" href="../../../source/modules.html#modules.control.AQiPTcontrol.experiment.execute">[docs]</a>
    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cmdMapper</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">None</span></div>
</div>


<span class="c1">#####################################################################################################</span>
<span class="c1">#Director AQiPT class</span>
<span class="c1">#####################################################################################################</span>
<span class="k">class</span> <span class="nc">director</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        A class for coordinating the Software specificiations (protocol specifications) that defines</span>
<span class="sd">        the waveforms for the experiment from specification file and the Hardware specification (setup </span>
<span class="sd">        specifications) with the devices&#39; drivers.</span>

<span class="sd">        At the master level (experiment class) does compile the instructions or waveforms into the</span>
<span class="sd">        physical channels in the experiment, setting the channel ready to run the instruction/waveform</span>
<span class="sd">        when the experiment class is executed e.g., experiment.execute()</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tbase : array_like</span>
<span class="sd">            Data for vector/matrix representation of the quantum object.</span>
<span class="sd">        res : list</span>
<span class="sd">            Dimensions of object used for tensor products.</span>
<span class="sd">        args : list</span>
<span class="sd">            Shape of underlying data structure (matrix shape).</span>

<span class="sd">        Methods</span>
<span class="sd">        -------</span>
<span class="sd">        function : array_like</span>
<span class="sd">            Sparse matrix characterizing the quantum object.</span>
<span class="sd">        function_plot : list</span>
<span class="sd">            List of dimensions keeping track of the tensor structure.</span>
<span class="sd">        step()</span>
<span class="sd">            Conjugate of quantum object.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">HW_specs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">SW_specs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">atom_specs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">calibration</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="c1">#atributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_HW_specs</span> <span class="o">=</span> <span class="n">HW_specs</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_SW_specs</span> <span class="o">=</span> <span class="n">SW_specs</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_atom_specs</span> <span class="o">=</span> <span class="n">atom_specs</span><span class="p">;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_calibration</span> <span class="o">=</span> <span class="n">calibration</span><span class="p">;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_drivers</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ID</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_SWmap</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iscompiled</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span>

    <span class="k">def</span> <span class="nf">load_HWspecs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">file</span><span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_hw_specs</span> <span class="o">=</span> <span class="n">kernel</span><span class="o">.</span><span class="n">hardwareSpecs</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">file</span><span class="p">);</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_hw_specs</span> <span class="o">=</span> <span class="n">kernel</span><span class="o">.</span><span class="n">hardwareSpecs</span><span class="p">();</span>
        <span class="n">_hw_specs</span><span class="o">.</span><span class="n">loadSpecs</span><span class="p">(</span><span class="n">printON</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span>
        <span class="n">_hw_specs</span><span class="o">.</span><span class="n">initSetup</span><span class="p">();</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_HW_specs</span> <span class="o">=</span> <span class="n">_hw_specs</span><span class="p">;</span>

    <span class="k">def</span> <span class="nf">load_SWspecs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">file</span><span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_sw_specs</span> <span class="o">=</span> <span class="n">kernel</span><span class="o">.</span><span class="n">softwareSpecs</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">file</span><span class="p">);</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_sw_specs</span> <span class="o">=</span> <span class="n">kernel</span><span class="o">.</span><span class="n">softwareSpecs</span><span class="p">();</span>
        <span class="n">_sw_specs</span><span class="o">.</span><span class="n">loadSpecs</span><span class="p">(</span><span class="n">printON</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_SW_specs</span> <span class="o">=</span> <span class="n">_sw_specs</span><span class="p">;</span>

    <span class="k">def</span> <span class="nf">load_drivers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c1">#loading virtual devices</span>
        <span class="kn">import</span> <span class="nn">AQiPT.hardware.drivers.AQiPTvd</span> <span class="k">as</span> <span class="nn">__vdrivers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_drivers</span><span class="p">[</span><span class="s1">&#39;virtual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">__vdrivers</span><span class="p">;</span>

        <span class="c1">#loading real devices </span>
        <span class="kn">from</span> <span class="nn">AQiPT.hardware.drivers.AQiPTrd</span> <span class="kn">import</span> <span class="n">drivers</span> <span class="k">as</span> <span class="n">__rdrivers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_drivers</span><span class="p">[</span><span class="s1">&#39;real&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">__rdrivers</span><span class="p">;</span>

    <span class="k">def</span> <span class="nf">_mapperHW</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hardware</span><span class="p">):</span>

        <span class="n">_drivables</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;laser&#39;</span><span class="p">,</span> <span class="s1">&#39;laser-aux&#39;</span><span class="p">,</span> <span class="s1">&#39;camera&#39;</span><span class="p">,</span> <span class="s1">&#39;awg&#39;</span><span class="p">,</span> <span class="s1">&#39;dds&#39;</span><span class="p">,</span> <span class="s1">&#39;dmd&#39;</span><span class="p">,</span> <span class="s1">&#39;shutter&#39;</span><span class="p">,</span> <span class="s1">&#39;oscilloscope&#39;</span><span class="p">,</span> <span class="s1">&#39;camera&#39;</span><span class="p">];</span>

        <span class="c1">#check if HW specs in director match with specs in experiment.hardware.specs, show error otherwise</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_HW_specs</span><span class="o">.</span><span class="n">specifications</span> <span class="o">==</span> <span class="n">hardware</span><span class="o">.</span><span class="n">specifications</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Specifications in director and experiment do not match.&quot;</span><span class="p">)</span>


        <span class="k">for</span> <span class="n">_HWtype</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_HW_specs</span><span class="o">.</span><span class="n">hardwareLST</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">_HWtype</span> <span class="ow">in</span> <span class="n">_drivables</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_HW_specs</span><span class="o">.</span><span class="n">hardwareLST</span><span class="p">[</span><span class="n">_HWtype</span><span class="p">]:</span>

                    <span class="k">if</span> <span class="s1">&#39;virtual&#39;</span> <span class="ow">in</span> <span class="n">element</span><span class="o">.</span><span class="n">driver</span><span class="p">:</span>
                        
                        <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">driver</span><span class="p">[</span><span class="s1">&#39;virtual&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;DMD&#39;</span><span class="p">:</span>
                            <span class="n">element</span><span class="o">.</span><span class="n">driver</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_drivers</span><span class="p">[</span><span class="s1">&#39;virtual&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">DMD</span><span class="p">();</span>

                        <span class="k">elif</span> <span class="n">element</span><span class="o">.</span><span class="n">driver</span><span class="p">[</span><span class="s1">&#39;virtual&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;DDS&#39;</span><span class="p">:</span>
                            <span class="n">element</span><span class="o">.</span><span class="n">driver</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_drivers</span><span class="p">[</span><span class="s1">&#39;virtual&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">DDS</span><span class="p">();</span>

                        <span class="k">elif</span> <span class="n">element</span><span class="o">.</span><span class="n">driver</span><span class="p">[</span><span class="s1">&#39;virtual&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;camera&#39;</span><span class="p">:</span>
                            <span class="n">element</span><span class="o">.</span><span class="n">driver</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_drivers</span><span class="p">[</span><span class="s1">&#39;virtual&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">camera</span><span class="p">();</span>

                        <span class="k">elif</span> <span class="n">element</span><span class="o">.</span><span class="n">driver</span><span class="p">[</span><span class="s1">&#39;virtual&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;AWG&#39;</span><span class="p">:</span>
                            <span class="n">element</span><span class="o">.</span><span class="n">driver</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_drivers</span><span class="p">[</span><span class="s1">&#39;virtual&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">AWG</span><span class="p">();</span>

                        <span class="k">elif</span> <span class="n">element</span><span class="o">.</span><span class="n">driver</span><span class="p">[</span><span class="s1">&#39;virtual&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;laser&#39;</span><span class="p">:</span>
                            <span class="n">element</span><span class="o">.</span><span class="n">driver</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_drivers</span><span class="p">[</span><span class="s1">&#39;virtual&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">laser</span><span class="p">();</span>

                        <span class="k">elif</span> <span class="n">element</span><span class="o">.</span><span class="n">driver</span><span class="p">[</span><span class="s1">&#39;virtual&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;laser-aux&#39;</span><span class="p">:</span>
                            <span class="n">element</span><span class="o">.</span><span class="n">driver</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_drivers</span><span class="p">[</span><span class="s1">&#39;virtual&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">laser</span><span class="p">();</span>
                        
                        <span class="k">elif</span> <span class="n">element</span><span class="o">.</span><span class="n">driver</span><span class="p">[</span><span class="s1">&#39;virtual&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;shutter&#39;</span><span class="p">:</span>
                            <span class="n">element</span><span class="o">.</span><span class="n">driver</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_drivers</span><span class="p">[</span><span class="s1">&#39;virtual&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shutter</span><span class="p">();</span>
                        
                        <span class="k">elif</span> <span class="n">element</span><span class="o">.</span><span class="n">driver</span><span class="p">[</span><span class="s1">&#39;virtual&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;oscilloscope&#39;</span><span class="p">:</span>
                            <span class="n">element</span><span class="o">.</span><span class="n">driver</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_drivers</span><span class="p">[</span><span class="s1">&#39;virtual&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">oscilloscope</span><span class="p">();</span>

                    <span class="k">elif</span> <span class="s1">&#39;real&#39;</span> <span class="ow">in</span> <span class="n">element</span><span class="o">.</span><span class="n">driver</span><span class="p">:</span>
                        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_mapperSW</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iscompiled</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">_variables</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_SW_specs</span><span class="o">.</span><span class="n">specifications</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]);</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="n">_assembly</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">config</span><span class="p">);</span>
            <span class="n">_instructions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SW_specs</span><span class="o">.</span><span class="n">specifications</span><span class="p">[</span><span class="s1">&#39;instructions&#39;</span><span class="p">];</span>

            <span class="c1">#for tracks</span>
            <span class="c1">#not implemented yet</span>

            <span class="c1">#for sequences</span>
            <span class="n">_seq_idx</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">_instruction_idx</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
            <span class="k">for</span> <span class="n">sequence</span> <span class="ow">in</span> <span class="n">_assembly</span><span class="p">:</span>

                
                <span class="k">for</span> <span class="n">instruction</span> <span class="ow">in</span> <span class="n">_assembly</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">sequence</span><span class="p">)][</span><span class="n">_seq_idx</span><span class="p">][</span><span class="s1">&#39;INSTRUCTIONS&#39;</span><span class="p">]:</span>

                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_assembly</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">sequence</span><span class="p">)][</span><span class="n">_seq_idx</span><span class="p">][</span><span class="s1">&#39;INSTRUCTIONS&#39;</span><span class="p">],</span><span class="nb">list</span><span class="p">):</span>

                        <span class="k">try</span><span class="p">:</span>

                            <span class="n">_instructions</span><span class="p">[</span><span class="n">_instruction_idx</span><span class="p">][</span><span class="n">instruction</span><span class="p">][</span><span class="s1">&#39;TIME_FLAG&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">_variables</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">_instructions</span><span class="p">[</span><span class="n">_instruction_idx</span><span class="p">][</span><span class="n">instruction</span><span class="p">][</span><span class="s1">&#39;TIME_FLAG&#39;</span><span class="p">])][</span><span class="s1">&#39;value&#39;</span><span class="p">];</span>

                        <span class="k">except</span><span class="p">:</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">_instructions</span><span class="p">[</span><span class="n">_instruction_idx</span><span class="p">][</span><span class="n">instruction</span><span class="p">][</span><span class="s1">&#39;TIME_FLAG&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">_instructions</span><span class="p">[</span><span class="n">_instruction_idx</span><span class="p">][</span><span class="n">instruction</span><span class="p">][</span><span class="s1">&#39;TIME_FLAG&#39;</span><span class="p">];</span>
                            <span class="k">except</span><span class="p">:</span>
                                <span class="k">pass</span>

                        <span class="k">try</span><span class="p">:</span>

                            <span class="n">_instructions</span><span class="p">[</span><span class="n">_instruction_idx</span><span class="p">][</span><span class="n">instruction</span><span class="p">][</span><span class="s1">&#39;TIME_FLAGS&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">_variables</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">_instructions</span><span class="p">[</span><span class="n">_instruction_idx</span><span class="p">][</span><span class="n">instruction</span><span class="p">][</span><span class="s1">&#39;TIME_FLAGS&#39;</span><span class="p">])][</span><span class="s1">&#39;value&#39;</span><span class="p">];</span>
                        
                        <span class="k">except</span><span class="p">:</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">_instructions</span><span class="p">[</span><span class="n">_instruction_idx</span><span class="p">][</span><span class="n">instruction</span><span class="p">][</span><span class="s1">&#39;TIME_FLAGS&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">_instructions</span><span class="p">[</span><span class="n">_instruction_idx</span><span class="p">][</span><span class="n">instruction</span><span class="p">][</span><span class="s1">&#39;TIME_FLAGS&#39;</span><span class="p">];</span>
                        
                            <span class="k">except</span><span class="p">:</span>
                                <span class="k">pass</span>
                        

                        <span class="k">try</span><span class="p">:</span>
                            
                            <span class="k">if</span> <span class="n">_instructions</span><span class="p">[</span><span class="n">_instruction_idx</span><span class="p">][</span><span class="n">instruction</span><span class="p">][</span><span class="s1">&#39;SPECS&#39;</span><span class="p">][</span><span class="s1">&#39;args&#39;</span><span class="p">]</span> <span class="o">!=</span><span class="s1">&#39;None&#39;</span><span class="p">:</span>
                                
                                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">_instructions</span><span class="p">[</span><span class="n">_instruction_idx</span><span class="p">][</span><span class="n">instruction</span><span class="p">][</span><span class="s1">&#39;SPECS&#39;</span><span class="p">][</span><span class="s1">&#39;args&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

                                        <span class="k">try</span><span class="p">:</span>
                                            <span class="n">_instructions</span><span class="p">[</span><span class="n">_instruction_idx</span><span class="p">][</span><span class="n">instruction</span><span class="p">][</span><span class="s1">&#39;SPECS&#39;</span><span class="p">][</span><span class="s1">&#39;args&#39;</span><span class="p">][</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span><span class="o">=</span><span class="n">_variables</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)][</span><span class="s1">&#39;value&#39;</span><span class="p">];</span>
                                        <span class="k">except</span><span class="p">:</span>
                                            <span class="n">_instructions</span><span class="p">[</span><span class="n">_instruction_idx</span><span class="p">][</span><span class="n">instruction</span><span class="p">][</span><span class="s1">&#39;SPECS&#39;</span><span class="p">][</span><span class="s1">&#39;args&#39;</span><span class="p">][</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span><span class="o">=</span><span class="n">value</span><span class="p">;</span>

                                                     
                        <span class="k">except</span><span class="p">:</span>
                            <span class="k">pass</span>

                        <span class="c1">#SW map</span>
                        <span class="k">if</span> <span class="n">_instructions</span><span class="p">[</span><span class="n">_instruction_idx</span><span class="p">][</span><span class="n">instruction</span><span class="p">][</span><span class="s1">&#39;TYPE&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;DIGITAL&#39;</span> <span class="ow">or</span> <span class="n">_instructions</span><span class="p">[</span><span class="n">_instruction_idx</span><span class="p">][</span><span class="n">instruction</span><span class="p">][</span><span class="s1">&#39;TYPE&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;ANALOG&#39;</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_SWmap</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mapSW</span><span class="p">(</span><span class="n">sequence_name</span> <span class="o">=</span> <span class="n">sequence</span><span class="p">,</span> 
                                                     <span class="n">sequence_id</span> <span class="o">=</span> <span class="n">_assembly</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">sequence</span><span class="p">)][</span><span class="n">_seq_idx</span><span class="p">][</span><span class="s1">&#39;ID&#39;</span><span class="p">],</span> 
                                                     <span class="n">instruction_name</span> <span class="o">=</span> <span class="n">instruction</span><span class="p">,</span> 
                                                     <span class="n">instruction_id</span> <span class="o">=</span> <span class="n">_instructions</span><span class="p">[</span><span class="n">_instruction_idx</span><span class="p">][</span><span class="n">instruction</span><span class="p">][</span><span class="s1">&#39;ID&#39;</span><span class="p">],</span> 
                                                     <span class="n">instruction_type</span> <span class="o">=</span> <span class="n">_instructions</span><span class="p">[</span><span class="n">_instruction_idx</span><span class="p">][</span><span class="n">instruction</span><span class="p">][</span><span class="s1">&#39;TYPE&#39;</span><span class="p">],</span> 
                                                     <span class="n">instruction_specs</span> <span class="o">=</span> <span class="n">_instructions</span><span class="p">[</span><span class="n">_instruction_idx</span><span class="p">][</span><span class="n">instruction</span><span class="p">][</span><span class="s1">&#39;SPECS&#39;</span><span class="p">],</span> 
                                                     <span class="n">instruction_realCH</span> <span class="o">=</span> <span class="n">_instructions</span><span class="p">[</span><span class="n">_instruction_idx</span><span class="p">][</span><span class="n">instruction</span><span class="p">][</span><span class="s1">&#39;CHANNEL&#39;</span><span class="p">],</span> 
                                                     <span class="n">instruction_timeflag</span> <span class="o">=</span> <span class="n">_instructions</span><span class="p">[</span><span class="n">_instruction_idx</span><span class="p">][</span><span class="n">instruction</span><span class="p">][</span><span class="s1">&#39;TIME_FLAG&#39;</span><span class="p">],</span>
                                                     <span class="n">command</span> <span class="o">=</span> <span class="n">_instructions</span><span class="p">[</span><span class="n">_instruction_idx</span><span class="p">][</span><span class="n">instruction</span><span class="p">][</span><span class="s1">&#39;COMMAND&#39;</span><span class="p">]));</span>
                        
                        <span class="k">if</span> <span class="n">_instructions</span><span class="p">[</span><span class="n">_instruction_idx</span><span class="p">][</span><span class="n">instruction</span><span class="p">][</span><span class="s1">&#39;TYPE&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;DIGITALS&#39;</span> <span class="ow">or</span> <span class="n">_instructions</span><span class="p">[</span><span class="n">_instruction_idx</span><span class="p">][</span><span class="n">instruction</span><span class="p">][</span><span class="s1">&#39;TYPE&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;ANALOGS&#39;</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_SWmap</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mapSW</span><span class="p">(</span><span class="n">sequence_name</span> <span class="o">=</span> <span class="n">sequence</span><span class="p">,</span> 
                                                     <span class="n">sequence_id</span> <span class="o">=</span> <span class="n">_assembly</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">sequence</span><span class="p">)][</span><span class="n">_seq_idx</span><span class="p">][</span><span class="s1">&#39;ID&#39;</span><span class="p">],</span> 
                                                     <span class="n">instruction_name</span> <span class="o">=</span> <span class="n">instruction</span><span class="p">,</span> 
                                                     <span class="n">instruction_id</span> <span class="o">=</span> <span class="n">_instructions</span><span class="p">[</span><span class="n">_instruction_idx</span><span class="p">][</span><span class="n">instruction</span><span class="p">][</span><span class="s1">&#39;ID&#39;</span><span class="p">],</span> 
                                                     <span class="n">instruction_type</span> <span class="o">=</span> <span class="n">_instructions</span><span class="p">[</span><span class="n">_instruction_idx</span><span class="p">][</span><span class="n">instruction</span><span class="p">][</span><span class="s1">&#39;TYPE&#39;</span><span class="p">],</span> 
                                                     <span class="n">instruction_specs</span> <span class="o">=</span> <span class="n">_instructions</span><span class="p">[</span><span class="n">_instruction_idx</span><span class="p">][</span><span class="n">instruction</span><span class="p">][</span><span class="s1">&#39;SPECS&#39;</span><span class="p">],</span> 
                                                     <span class="n">instruction_realCH</span> <span class="o">=</span> <span class="n">_instructions</span><span class="p">[</span><span class="n">_instruction_idx</span><span class="p">][</span><span class="n">instruction</span><span class="p">][</span><span class="s1">&#39;CHANNEL&#39;</span><span class="p">],</span> 
                                                     <span class="n">instruction_timeflags</span> <span class="o">=</span> <span class="n">_instructions</span><span class="p">[</span><span class="n">_instruction_idx</span><span class="p">][</span><span class="n">instruction</span><span class="p">][</span><span class="s1">&#39;TIME_FLAGS&#39;</span><span class="p">],</span>
                                                     <span class="n">command</span> <span class="o">=</span> <span class="n">_instructions</span><span class="p">[</span><span class="n">_instruction_idx</span><span class="p">][</span><span class="n">instruction</span><span class="p">][</span><span class="s1">&#39;COMMAND&#39;</span><span class="p">]));</span>

                        <span class="n">_instruction_idx</span><span class="o">+=</span><span class="mi">1</span><span class="p">;</span>
                <span class="n">_seq_idx</span><span class="o">+=</span><span class="mi">1</span><span class="p">;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_iscompiled</span><span class="o">=</span><span class="kc">True</span><span class="p">;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Already compiled.&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_calibration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>

<span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">mapSW</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Special dataclass of AQiPT that stores the quantum assembly commands with the low level arguments</span>
<span class="sd">        for the classical control.</span>
<span class="sd">        </span>
<span class="sd">        ATTRIBUTES/FIELDS:</span>
<span class="sd">        ------------------</span>
<span class="sd">        </span>
<span class="sd">            sequence_name : name of the sequence </span>
<span class="sd">            sequence_id : ID of the sequence</span>
<span class="sd">            sequence_active : sequence active?</span>
<span class="sd">            instruction_name : name of instruction</span>
<span class="sd">            instruction_id : ID of the instruction</span>
<span class="sd">            instruction_type : type of instruction</span>
<span class="sd">            instruction_specs : set of arguments for command</span>
<span class="sd">            instruction_realCH : channel&#39;s ID of hardware</span>
<span class="sd">            instruction_timeflag : value of time when it will be executed</span>
<span class="sd">            command : command to device from driver</span>
<span class="sd">            </span>
<span class="sd">        </span>
<span class="sd">        METHODS:</span>
<span class="sd">        --------</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">    &#39;&#39;&#39;</span>
        
    <span class="c1">#fields</span>
    <span class="n">sequence_name</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;Default&quot;</span><span class="p">)</span>
    <span class="n">sequence_id</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;0x0&quot;</span><span class="p">)</span>
    <span class="n">instruction_name</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;Default&quot;</span><span class="p">)</span>
    <span class="n">instruction_id</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;0x0&quot;</span><span class="p">)</span>
    <span class="n">instruction_type</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;Default&quot;</span><span class="p">)</span>
    <span class="n">instruction_specs</span> <span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="s2">&quot;Default&quot;</span><span class="p">)</span>
    <span class="n">instruction_realCH</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;0x0&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;hardware_ID&#39;</span><span class="p">:</span> <span class="s2">&quot;0x0&quot;</span><span class="p">})</span>
    <span class="n">instruction_timeflag</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;TIME_UNIT&#39;</span><span class="p">})</span>
    <span class="n">instruction_timeflags</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;TIME_UNIT&#39;</span><span class="p">})</span>
    <span class="n">command</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="s2">&quot;Driver required&quot;</span><span class="p">)</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, AQiPT developers and contributors. Last updated on Oct 27, 2022. .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-XXXXXXXXXX', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>